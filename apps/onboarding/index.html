<!DOCTYPE html>
<html lang="en">

<head>
 <script src="js/modal-inspector.js"></script>
 <script src="js/direct-button-fix.js"></script>
<script src="js/direct-modal-fix.js"></script>
<script src="js/modal-close-fix-v2.js"></script>
<script src="js/modal-close-fix.js"></script>
        <!-- Other content -->
    <link rel="stylesheet" href="../../mobile_optimization.css">
    <link rel="stylesheet" href="../../chat_widget_improvements.css">
    <link rel="stylesheet" href="../../text_spacing.css">
    <link rel="stylesheet" href="../../improved_hamburger_fix.css">
</head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TurnClicksToClients.com - Onboarding</title>
    <!-- Tailwind CSS (fix: use script, not link) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Supabase Client -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
      const supabaseUrl = 'https://ehveemvdrzmnernsuuxv.supabase.co';
      const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVodmVlbXZkcnptbmVybnN1dXh2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ0NjA2NTEsImV4cCI6MjA2MDAzNjY1MX0.A43KWW3G0kE_NgptszpaqC2-wFDGVPzGfcS7LFskV1E';
      window.supabase = supabase.createClient(supabaseUrl, supabaseKey);
      window.supabaseClient = window.supabase;
      
      // Set up auth state change listener
      window.supabase.auth.onAuthStateChange((event, session) => {
        console.log('Auth state changed:', event, session ? 'User logged in' : 'No user');
        if (event === 'SIGNED_IN') {
          // User has logged in, show dashboard
          const loginSection = document.getElementById('login-section');
          const dashboardSection = document.getElementById('dashboard-section');
          if (loginSection) loginSection.style.display = 'none';
          if (dashboardSection) dashboardSection.style.display = 'block';
          
          // Set current user email
          if (session && session.user) {
            window.currentUserEmail = session.user.email;
            updateUserNameDisplay();
          }
        } else if (event === 'SIGNED_OUT') {
          // User has logged out, show login section
          const loginSection = document.getElementById('login-section');
          const dashboardSection = document.getElementById('dashboard-section');
          if (loginSection) loginSection.style.display = 'flex';
          if (dashboardSection) dashboardSection.style.display = 'none';
          
          // Clear current user email
          window.currentUserEmail = null;
        }
      });
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script>
        // Initialize global variables at the top level
        window.urlParams = new URLSearchParams(window.location.search);
        window.currentUserEmail = null;
        window.isPageLoaded = false;
        window.currentInProgressStep = null;

        // Function to capitalize first letter of each word
        function capitalizeName(name) {
            return name.split(' ').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
            ).join(' ');
        }
       // Function to handle logout
       async function handleLogout() {
          console.log('[handleLogout] Attempting logout...'); // Added log
          try {
            console.log('[handleLogout] Calling Supabase signOut...'); // Added log
            // Ensure supabaseClient is used if defined, otherwise fallback to supabase
            const client = window.supabaseClient || window.supabase;
            if (!client || !client.auth) { // Also check if auth exists
                 console.error('[handleLogout] Supabase client or auth module not available!');
                 // Still attempt redirect in finally block
                 return;
            }
            const { error } = await client.auth.signOut();
            if (error) {
                // Log the error but don't throw, let finally handle redirect
                console.error('[handleLogout] Error during signOut:', error.message);
            } else {
                console.log('[handleLogout] signOut successful.'); // Added log
            }
          } catch (error) {
            // Catch any unexpected errors during the signOut process
            console.error('[handleLogout] Unexpected error during logout attempt:', error.message);
          } finally {
            // This block executes regardless of success or failure
            console.log('[handleLogout] Executing finally block - Redirecting to /'); // Added log
            // Use a minimal timeout to ensure any async operations settle
            setTimeout(() => {
                // Double check we aren't already there
                if (window.location.pathname !== '/') {
                   console.log('[handleLogout] Performing redirect now.');
                   window.location.href = '/';
                } else {
                   console.log('[handleLogout] Already on root page, redirect skipped.');
                }
            }, 50); // Reduced timeout
          }
        }

        // Add event listener for logout button
        document.addEventListener('DOMContentLoaded', function() {
            const logoutButton = document.getElementById('logout-button');
            if (logoutButton) {
                logoutButton.addEventListener('click', handleLogout);
            }
            
            // Check authentication state and show the correct section
            // checkAuthState(); // <-- Commented out this line
        });
        
        // Function to check authentication state and show appropriate section
        async function checkAuthState() {
            try {
                const { data: { user } } = await window.supabase.auth.getUser();
                const loginSection = document.getElementById('login-section');
                const dashboardSection = document.getElementById('dashboard-section');
                
                if (user) {
                    // User is logged in, show dashboard
                    console.log('User is logged in:', user.email);
                    if (loginSection) loginSection.style.display = 'none';
                    if (dashboardSection) dashboardSection.style.display = 'block';
                    
                    // Set currentUserEmail for other parts of the application
                    window.currentUserEmail = user.email;
                    
                    // Update user name display
                    updateUserNameDisplay();

                    // Load and apply the saved onboarding status from Supabase
                    await loadAndApplyOnboardingStatus(); 

                } else {
                    // User is not logged in, show login section
                    console.log('User is not logged in');
                    if (loginSection) loginSection.style.display = 'flex';
                    if (dashboardSection) dashboardSection.style.display = 'none';
                }
            } catch (error) {
                console.error('Error checking auth state:', error);
                // Default to showing login section on error
                const loginSection = document.getElementById('login-section');
                const dashboardSection = document.getElementById('dashboard-section');
                if (loginSection) loginSection.style.display = 'flex';
                if (dashboardSection) dashboardSection.style.display = 'none';
            }
        }

        // Simple direct toggle function for the Learn More button
        function toggleLearnMore() {
            var content = document.getElementById('learn-more-content');
            var icon = document.getElementById('learn-more-icon');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.add('transform', 'rotate-180');
            } else {
                content.classList.add('hidden');
                icon.classList.remove('transform', 'rotate-180');
            }
        }

        // Function to update the UI of a specific onboarding step card
        function updateStepUICard(cardId, statusId, statusValue) {
            console.log(`Updating UI for ${cardId} to status: ${statusValue}`);
            const stepCard = document.getElementById(cardId);
            const statusSpan = document.getElementById(statusId);
            const completeIcon = stepCard?.querySelector('.complete-icon'); // Assuming a checkmark icon exists

            if (!stepCard || !statusSpan) {
                console.warn(`Could not find elements for card ${cardId} or status ${statusId}`);
                return;
            }

            // Reset classes first
            stepCard.classList.remove('not-started', 'in-progress', 'completed', 'completed-step');
            statusSpan.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium'; // Reset base class
            statusSpan.innerHTML = ''; // Clear previous content (like dots)

            // Apply new classes and text based on status
            switch (statusValue) {
                case 'Completed':
                    stepCard.classList.add('completed', 'completed-step');
                    statusSpan.classList.add('completed-status'); // Use the specific completed class
                    statusSpan.textContent = 'Completed';
                    // Add green dot (or checkmark, adjust as needed)
                    const greenDot = document.createElement('span');
                    greenDot.className = 'h-2 w-2 mr-1 rounded-full bg-green-500'; // Example dot
                    statusSpan.prepend(greenDot);
                    if (completeIcon) completeIcon.classList.remove('hidden');
                    break;
                case 'In Progress':
                    stepCard.classList.add('in-progress');
                    statusSpan.classList.add('bg-blue-100', 'text-blue-800');
                    statusSpan.textContent = 'In Progress';
                     const blueDot = document.createElement('span');
                    blueDot.className = 'h-2 w-2 mr-1 rounded-full bg-blue-500';
                    statusSpan.prepend(blueDot);
                    if (completeIcon) completeIcon.classList.add('hidden');
                    break;
                case 'Not Started':
                default:
                    stepCard.classList.add('not-started');
                    statusSpan.classList.add('bg-gray-100', 'text-gray-800');
                    statusSpan.textContent = 'Not Started';
                    const grayDot = document.createElement('span');
                    grayDot.className = 'h-2 w-2 mr-1 rounded-full bg-gray-400';
                    statusSpan.prepend(grayDot);
                    if (completeIcon) completeIcon.classList.add('hidden');
                    break;
            }
        }

        // Function to load status from Supabase and update UI
        async function loadAndApplyOnboardingStatus() {
            console.log('Loading onboarding status from Supabase...');
            const { data: { user } } = await window.supabaseClient.auth.getUser();

            if (!user) {
                console.log('User not logged in, cannot load status.');
                return;
            }

            try {
                const { data: onboardingData, error } = await window.supabaseClient
                    .from('new_client_onboarding')
                    .select('guide_status, verification_status, authorization_status, slack_status, domain_status, a2p_status, social_status') // Added authorization_status back
                    .eq('user_id', user.id)
                    .maybeSingle(); // Use maybeSingle() in case the row doesn't exist yet

                if (error) {
                    console.error('Error fetching onboarding status:', error);
                    return;
                }

                if (!onboardingData) {
                    console.log('No onboarding record found for this user yet.');
                    // Optionally reset all steps to Not Started if needed
                    // updateStepUICard('guide-card', 'guide-status', 'Not Started');
                    // ... etc for all steps
                    return;
                }

                console.log('Onboarding data loaded:', onboardingData);

                // Map Supabase columns to Card and Status IDs
                const stepMapping = {
                    guide_status: { cardId: 'guide-card', statusId: 'guide-status' },
                    verification_status: { cardId: 'verification-card', statusId: 'verification-status' },
                    authorization_status: { cardId: 'authorization-card', statusId: 'authorization-status' }, // Uncommented authorization mapping
                    slack_status: { cardId: 'slack-card', statusId: 'slack-status' },
                    domain_status: { cardId: 'domain-card', statusId: 'domain-status' },
                    a2p_status: { cardId: 'a2p-card', statusId: 'a2p-form-status' }, // Note the different statusId
                    social_status: { cardId: 'social-card', statusId: 'social-card-status' },
                };

                // Apply statuses from data
                for (const [statusColumn, ids] of Object.entries(stepMapping)) {
                    const statusValue = onboardingData[statusColumn] || 'Not Started'; // Default to Not Started if column is null/undefined
                    updateStepUICard(ids.cardId, ids.statusId, statusValue);
                }

            } catch (err) {
                console.error('Unexpected error in loadAndApplyOnboardingStatus:', err);
            }
        }
    </script>
    <style>
        .document-card {
            transition: all 0.2s ease;
        }
        .document-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .progress-bar {
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            transition: width 0.3s ease;
        }
        .quiz-complete-top {
            display: none;
        }
        .quiz-complete-button {
            display: none !important;
        }

        /* Fixed Signature pad styles */
        #signature-pad {
            touch-action: none;
            background-color: #fff;
        }

        #clear-signature {
            position: absolute;
            bottom: 8px;
            right: 8px;
            z-index: 2;
            background-color: white;
            border: 1px solid #e2e8f0;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        #clear-signature:hover {
            background-color: #f7fafc;
            border-color: #cbd5e0;
        }
        
        /* Required styles for Learn More button */
        .hidden {
            display: none !important;
        }
        .transform.rotate-180 {
            transform: rotate(180deg);
        }

        /* Add/replace the following CSS in the <style> section for the new visual style */
        .step-card {
            transition: all 0.3s ease;
        }
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .step-card.completed {
            border-left: 4px solid #22c55e; /* Tailwind's green-500 */
            box-shadow: 0 0 0 2px #22c55e33; /* subtle green glow for emphasis */
        }
        .step-card.in-progress {
            border-left: 4px solid #FBBF24;
        }
        .step-card.not-started {
            border-left: 4px solid #E5E7EB;
        }
        .step-number {
            height: 32px;
            width: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        .progress-line {
            position: absolute;
            left: 16px;
            top: 32px;
            bottom: 0;
            width: 2px;
            background-color: #E5E7EB;
            z-index: 0;
        }
        .step-card.completed .step-number {
            background-color: #10B981;
            color: white;
        }
        .step-card.in-progress .step-number {
            background-color: #FBBF24;
            color: white;
        }
        .step-card.not-started .step-number {
            background-color: #E5E7EB;
            color: #4B5563;
        }
        .btn-sleek {
            background: linear-gradient(to right, #3B82F6, #2563EB);
            border: none;
            padding: 0.5rem 1.25rem;
            border-radius: 0.375rem;
            font-weight: 500;
            letter-spacing: 0.025em;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2), 0 2px 4px -1px rgba(37, 99, 235, 0.1);
            transition: all 0.2s ease;
        }
        .btn-sleek:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 10px -1px rgba(37, 99, 235, 0.25), 0 3px 6px -1px rgba(37, 99, 235, 0.15);
            background: linear-gradient(to right, #2563EB, #1D4ED8);
        }
        .btn-sleek:focus {
            outline: none;
            ring-color: rgba(37, 99, 235, 0.5);
        }
        @media (max-width: 768px) {
            .step-card {
                padding-left: 3.5rem !important;
            }
            .card-content {
                flex-direction: column;
                align-items: flex-start !important;
            }
            .card-content button {
                margin-top: 1rem;
                align-self: flex-start;
            }
        }
        /* Add verification modal styles */
        .signature-pad {
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .signature-pad canvas {
            width: 100%;
            height: 200px;
        }
        .verification-form {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        .verification-form .form-label {
            font-weight: 500;
            color: #495057;
        }
        .verification-form .form-control {
            border-radius: 4px;
            border: 1px solid #ced4da;
            padding: 8px 12px;
        }
        .verification-form .form-control:focus {
            border-color: #80bdff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }
        .verification-form .btn {
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 500;
        }
        .verification-form .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }
        .verification-form .btn-secondary {
            background-color: #6c757d;
            border-color: #6c757d;
        }
        .verification-form .form-check {
            margin-top: 20px;
        }
        .verification-form .form-check-input {
            margin-top: 0.3rem;
        }
        .verification-form .form-check-label {
            color: #495057;
        }

        /* Add more prominent completed status styles */
        .completed-step {
          background-color: #f0fdf4 !important; /* Light green background */
          border: 2px solid #22c55e !important; /* Thicker green border */
          box-shadow: 0 4px 10px rgba(34, 197, 94, 0.3) !important;
          transition: all 0.3s ease-in-out !important;
          position: relative;
          overflow: visible;
        }

        .completed-step:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 15px rgba(34, 197, 94, 0.4) !important;
        }

        .completed-step::before {
          content: '';
          position: absolute;
          left: 0;
          top: 0;
          height: 100%;
          width: 6px;
          background-color: #16a34a;
        }

        .completed-step .step-number {
          background-color: #22c55e !important;
          color: white !important;
          border: 2px solid #15803d !important;
          transition: all 0.3s ease !important;
          transform: scale(1.1);
        }

        .completed-status {
          background-color: #dcfce7 !important; /* Lighter green background */
          color: #15803d !important; /* Darker green text */
          font-weight: 600 !important;
          padding: 4px 10px !important;
          border: 1px solid #22c55e !important;
          border-radius: 20px !important;
          display: inline-flex !important;
          align-items: center !important;
          box-shadow: 0 2px 4px rgba(34, 197, 94, 0.2) !important;
          animation: pulseGreen 2s infinite;
        }

        .completed-status span {
          background-color: #22c55e !important;
          width: 8px !important;
          height: 8px !important;
        }

        .completed-indicator {
          position: absolute;
          top: -8px;
          right: -8px;
          background-color: #16a34a;
          color: white;
          border-radius: 50%;
          width: 28px;
          height: 28px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 14px;
          border: 2px solid white;
          box-shadow: 0 2px 4px rgba(0,0,0,0.2);
          z-index: 10;
          animation: bounceIn 0.5s ease-out;
        }

        /* Add confetti-like background to completed steps */
        .completed-step::after {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-image: 
            radial-gradient(circle, #22c55e 1px, transparent 1px),
            radial-gradient(circle, #86efac 1px, transparent 1px);
          background-size: 20px 20px;
          background-position: 0 0, 10px 10px;
          opacity: 0.05;
          pointer-events: none;
        }

        /* Change the verify button style for completed steps */
        .completed-step .btn-sleek {
          background-color: #16a34a !important;
          border-color: #15803d !important;
          transition: all 0.3s ease !important;
        }

        .completed-step .btn-sleek:hover {
          background-color: #15803d !important;
          transform: translateY(-1px);
        }

        /* Add animations */
        @keyframes pulseGreen {
          0% {
            box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
          }
          70% {
            box-shadow: 0 0 0 6px rgba(34, 197, 94, 0);
          }
          100% {
            box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
          }
        }

        @keyframes bounceIn {
          0% {
            opacity: 0;
            transform: scale(0.3);
          }
          50% {
            opacity: 1;
            transform: scale(1.1);
          }
          70% {
            transform: scale(0.9);
          }
          100% {
            transform: scale(1);
          }
        }

        /* Add a special label for completed steps */
        .completed-label {
          position: absolute;
          right: 10px;
          top: 10px;
          background-color: #16a34a;
          color: white;
          padding: 2px 8px;
          border-radius: 4px;
          font-size: 12px;
          font-weight: bold;
          display: flex;
          align-items: center;
          gap: 4px;
          z-index: 5;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Add prominently styled completed text */
        .completed-text {
          color: #15803d !important;
          font-weight: 700 !important;
          text-transform: uppercase !important;
          letter-spacing: 0.05em !important;
          font-size: 1.1em !important;
          text-shadow: 0 1px 0 rgba(255,255,255,0.8) !important;
          position: relative;
          display: inline-block;
        }

        .completed-text::after {
          content: '';
          position: absolute;
          bottom: -2px;
          left: 0;
          width: 100%;
          height: 2px;
          background-color: #22c55e;
        }

        /* Add a prominent banner for completed verification modal */
        .verified-banner {
          background: linear-gradient(135deg, #16a34a, #22c55e);
          color: white;
          text-align: center;
          padding: 10px;
          margin: -16px -16px 16px -16px;
          border-radius: 8px 8px 0 0;
          font-weight: 600;
          letter-spacing: 0.05em;
          text-transform: uppercase;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
        }

        /* Style the main step status to be more visible */
        #verification-status.completed-status,
        #guide-status.completed-status,
        #slack-status.completed-status,
        #domain-status.completed-status,
        #a2p-form-status.completed-status,
        #social-card-status.completed-status {
          font-size: 0.875rem !important;
          padding: 4px 12px !important;
          letter-spacing: 0.05em !important;
        }
    </style>
    <link rel="stylesheet" href="../../mobile_optimization.css">
    <link rel="stylesheet" href="../../chat_widget_improvements.css">
    <link rel="stylesheet" href="../../text_spacing.css">
    <link rel="stylesheet" href="../../improved_hamburger_fix.css">
</head>
<body class="bg-gray-100 min-h-screen m-0 p-0">
    <!-- Debug Tools - VERY OBVIOUS -->
    <!-- Removing debug toolbar from production site -->

    <script>
    // Debug functions
    </script>

    <!-- Navigation Bar -->
    <nav class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <!-- <h1 class="text-xl font-bold text-gray-800">The Connector Group</h1> --> <!-- REMOVED THIS LINE -->
                            </div>
                        </div>
                <div class="flex items-center">
                    <div class="flex items-center space-x-4">
                        <span id="user-name" class="text-gray-700 font-medium"></span>
                        <button id="logout-button" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200">
                            Logout
                    </button>
        </div>
        </div>
                                    </div>
        </div>
    </nav>
    <div id="login-section"
         class="fixed inset-0 min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100 px-4 py-8"
         style="display:flex;" >
      <div class="w-full max-w-md md:w-auto bg-white rounded-2xl shadow-xl p-8 md:p-10 flex flex-col items-center">
        <!-- Universal Avatar Icon -->
        <div class="mb-6">
          <div class="mx-auto mb-4 text-center text-blue-600 font-bold text-2xl">TurnClicksToClients.com</div>
        </div>
        <h2 class="text-2xl font-bold text-gray-800 mb-2 text-center">Onboarding Portal</h2>
        <p class="text-gray-500 mb-6 text-center">Sign up or log in to access your onboarding portal</p>
               <!-- Tabs for Login / Sign Up -->
               <div class="flex w-full mb-6">
                <!-- Login Tab (Now first and active by default) -->
                <button id="tab-login" type="button" class="flex-1 py-2 text-center rounded-l-lg border border-blue-600 text-white font-semibold bg-blue-600 hover:bg-blue-700 focus:outline-none">Login</button>
                <!-- Sign Up Tab (Now second and inactive by default) -->
                <button id="tab-signup" type="button" class="flex-1 py-2 text-center rounded-r-lg border border-blue-600 text-blue-600 font-semibold bg-white hover:bg-blue-100 focus:outline-none">
                  Sign Up
                  <span class="block text-xs text-gray-500 font-normal">(New User)</span>
                </button>
              </div>
      
              <!-- Login Form (Now displayed by default) -->
              <form id="login-form" class="w-full space-y-4" style="display: block;">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Email or Username</label>
                  <input type="text" id="login-email" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Email or username">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                  <input type="password" id="login-password" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Your password">
                </div>
                <div class="flex justify-end -mt-2 mb-2">
                  <a href="#" id="forgot-password-link" class="text-blue-600 text-sm hover:underline focus:outline-none">Forgot password?</a>
                </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg shadow transition duration-200">Login</button>
              </form>
      
              <!-- Sign Up Form (Now hidden by default) -->
              <form id="signup-form" class="w-full space-y-4" style="display: none;">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                  <input type="text" id="signup-first-name" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="First name">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                  <input type="text" id="signup-last-name" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Last name">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                  <input type="tel" id="signup-phone" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Phone number">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Business Name</label>
                  <input type="text" id="signup-business-name" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Business name">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                  <input type="text" id="signup-username" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Choose a username">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                  <input type="email" id="signup-email" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="you@email.com">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                  <input type="password" id="signup-password" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Create a password">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                  <input type="password" id="signup-confirm-password" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Confirm your password">
                </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg shadow transition duration-200">Sign Up</button>
              </form>
        <!-- Reset Confirmation Message (hidden by default) -->
        <div id="reset-confirmation" class="w-full text-center text-green-600 text-sm py-4" style="display: none;">
          If an account with that email exists, a password reset link has been sent.
          <div class="mt-4">
            <a href="#" id="reset-confirmation-back" class="text-blue-600 hover:underline">Back to Login</a>
                    </div>
                    </div>
        <div id="login-error" class="text-red-600 mt-4 text-sm w-full text-center"></div>
        <div class="mt-8 text-xs text-gray-400 text-center w-full">
          &copy; 2024 The Connector Group. All rights reserved.copy; 2024 TurnClicksToClients.com. All rights reserved.copy; 2024 TurnClicksToClients.com. All rights reserved.copy; 2024 TurnClicksToClients.com. All rights reserved.
                </div>
                    </div>
                            </div>
    <div id="dashboard-section" style="display:none;">
      <!-- Header -->
      <header class="bg-white shadow">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex justify-between items-center">
            <h1 id="portal-title" class="text-2xl font-bold text-gray-800">TurnClicksToClients.com Onboarding Portal</h1>
            <div class="flex items-center space-x-4">
              <span class="text-gray-600" id="client-name"></span>
                            </div>
                            </div>
                            </div>
      </header>
      <!-- Main Content -->
      <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Welcome Banner -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8 border-l-4 border-blue-500">
          <div class="flex items-start flex-wrap md:flex-nowrap">
            <div class="flex-shrink-0 text-blue-500 mb-3 md:mb-0">
              <i class="fas fa-info-circle text-2xl"></i>
                            </div>
            <div class="ml-0 md:ml-4 w-full">
              <h2 class="text-xl font-semibold text-gray-800">Welcome to Your Onboarding Portal</h2>
              <p class="text-gray-600 mt-1">
                Complete the steps below to set up your account with TurnClicksToClients.com. We recommend following these steps in order.
              </p>
              <p class="text-sm text-gray-500 mt-2">
                <i class="fas fa-save mr-2"></i>
                Don't worry - your progress is automatically saved. You can safely log out or leave the portal and continue where you left off when you return.
                        </p>
                            </div>
                            </div>
                            </div>
        <!-- Progress Overview -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
          <h2 class="text-xl font-semibold text-gray-800 mb-4">Your Onboarding Journey</h2>
          <div class="space-y-4 relative">
            <!-- Step 1: Getting Started Guide -->
            <div id="guide-card" class="step-card not-started p-6 rounded-lg border bg-white relative pl-16">
              <div class="progress-line"></div>
              <div class="step-number absolute left-4 top-6">1</div>
              <div class="flex justify-between items-center card-content">
                <div>
                  <h3 class="text-lg font-medium text-gray-900">Getting Started Guide</h3>
                  <p class="text-gray-500 mt-1">Learn how TurnClicksToClients.com will help elevate your business</p>
                  <div class="mt-2">
                    <span id="guide-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      <span class="h-2 w-2 mr-1 rounded-full bg-gray-400"></span>
                      Not Started
                    </span>
                    <span class="text-sm text-gray-500 ml-2">Estimated time: 5 min</span>
                        </div>
                  <div class="complete-icon hidden absolute right-5 top-2">
                    <i class="fas fa-check-circle text-green-500 text-xl"></i>
                    </div>
                    </div>
                <button onclick="showGuideModal()" class="btn-sleek inline-flex items-center text-sm font-medium text-white">
                  <i class="fas fa-book-reader mr-2"></i>
                  Read Guide
                        </button>
                    </div>
                </div>
            
            <!-- Step 2: Information Verification -->
            <div id="verification-card" class="step-card not-started p-6 rounded-lg border bg-white relative pl-16">
              <div class="progress-line"></div>
              <div class="step-number absolute left-4 top-6">2</div>
              <div class="flex justify-between items-center card-content">
                <div>
                  <h3 class="text-lg font-medium text-gray-900">Information Verification</h3>
                  <p class="text-gray-500 mt-1">Verify your account information to get started</p>
                  <div class="mt-2">
                    <span id="verification-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      <span class="h-2 w-2 mr-1 rounded-full bg-gray-400"></span>
                      Not Started
                    </span>
                    <span class="text-sm text-gray-500 ml-2">Estimated time: 2 min</span>
        </div>
                  <div class="complete-icon hidden absolute right-5 top-2">
                    <i class="fas fa-check-circle text-green-500 text-xl"></i>
    </div>
                </div>
                <button onclick="showVerificationModal()" class="btn-sleek inline-flex items-center text-sm font-medium text-white">
                  <i class="fas fa-check-circle mr-2"></i>
                  Verify Now
                    </button>
                </div>
            </div>

            <!-- Step 3: Authorization Form (New) -->
            <div id="authorization-card" class="step-card not-started p-6 rounded-lg border bg-white relative pl-16">
              <div class="progress-line"></div>
              <div class="step-number absolute left-4 top-6">3</div>
              <div class="flex justify-between items-center card-content">
                        <div>
                  <h3 class="text-lg font-medium text-gray-900">Authorization Form</h3>
                  <p class="text-gray-500 mt-1">Complete the credit card authorization form</p>
                  <div class="mt-2">
                    <span id="authorization-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      <span class="h-2 w-2 mr-1 rounded-full bg-gray-400"></span>
                      Not Started
                    </span>
                    <span class="text-sm text-gray-500 ml-2">Estimated time: 30 seconds</span>
                        </div>
                  <div class="complete-icon hidden absolute right-5 top-2">
                    <i class="fas fa-check-circle text-green-500 text-xl"></i>
                        </div>
                </div>
                <button onclick="showAuthorizationModal()" class="btn-sleek inline-flex items-center text-sm font-medium text-white">
                  <i class="fas fa-credit-card mr-2"></i>
                  Authorize Now
                </button>
                    </div>
                </div>

            <!-- Step 4: Join Slack Support Group -->
            <div id="slack-card" class="step-card not-started p-6 rounded-lg border bg-white relative pl-16">
              <div class="progress-line"></div>
              <div class="step-number absolute left-4 top-6">4</div>
              <div class="flex justify-between items-center card-content">
                        <div>
                  <h3 class="text-lg font-medium text-gray-900">Join Support Group</h3>
                  <p class="text-gray-500 mt-1">Connect with your dedicated team via Slack for personalized support</p>
                  <div class="mt-2">
                    <span id="slack-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      <span class="h-2 w-2 mr-1 rounded-full bg-gray-400"></span>
                      Not Started
                    </span>
                    <span class="text-sm text-gray-500 ml-2">Estimated time: 30 seconds</span>
                        </div>
                        <div class="complete-icon hidden absolute right-5 top-2">
                          <i class="fas fa-check-circle text-green-500 text-xl"></i>
                        </div>
                    </div>
                <button onclick="showSlackModal()" class="btn-sleek inline-flex items-center text-sm font-medium text-white">
                  <i class="fab fa-slack mr-2"></i>
                  Join Group
                        </button>
                </div>
                        </div>
            <!-- Step 5: Campaign Domain Selection -->
            <div id="domain-card" class="step-card not-started p-6 rounded-lg border bg-white relative pl-16">
              <div class="progress-line"></div>
              <div class="step-number absolute left-4 top-6">5</div>
              <div class="flex justify-between items-center card-content">
                        <div>
                  <h3 class="text-lg font-medium text-gray-900">Select Campaign Domain</h3>
                  <p class="text-gray-500 mt-1">Choose a domain name for your marketing campaigns</p>
                  <div class="mt-2">
                    <span id="domain-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      <span class="h-2 w-2 mr-1 rounded-full bg-gray-400"></span>
                      Not Started
                    </span>
                    <span class="text-sm text-gray-500 ml-2">Estimated time: 5 min</span>
                        </div>
                        <div class="complete-icon hidden absolute right-5 top-2">
                          <i class="fas fa-check-circle text-green-500 text-xl"></i>
                        </div>
                        </div>
                <button onclick="showDomainModal()" class="btn-sleek inline-flex items-center text-sm font-medium text-white">
                  <i class="fas fa-globe mr-2"></i>
                  Select Domain
                        </button>
                        </div>
                    </div>
            <!-- Step 6: A2P Registration -->
            <div id="a2p-card" class="step-card not-started p-6 rounded-lg border bg-white relative pl-16">
              <div class="progress-line"></div>
              <div class="step-number absolute left-4 top-6">6</div>
              <div class="flex justify-between items-center card-content">
                        <div>
                  <h3 class="text-lg font-medium text-gray-900">A2P Registration</h3>
                  <p class="text-gray-500 mt-1">Complete the A2P registration to get started with SMS marketing</p>
                  <div class="mt-2">
                    <span id="a2p-form-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      <span class="h-2 w-2 mr-1 rounded-full bg-gray-400"></span>
                      Not Started
                    </span>
                    <span class="text-sm text-gray-500 ml-2">Estimated time: 10 min</span>
                        </div>
                        <div class="complete-icon hidden absolute right-5 top-2">
                          <i class="fas fa-check-circle text-green-500 text-xl"></i>
                        </div>
                        </div>
                <button onclick="showA2PModal()" class="btn-sleek inline-flex items-center text-sm font-medium text-white">
                  <i class="fas fa-file-alt mr-2"></i>
                  Start Registration
                        </button>
                        </div>
                    </div>
            <!-- Step 7: Social Media Setup -->
            <div id="social-card" class="step-card not-started p-6 rounded-lg border bg-white relative pl-16">
              <div class="step-number absolute left-4 top-6">7</div>
              <div class="flex justify-between items-center card-content">
                        <div>
                  <h3 class="text-lg font-medium text-gray-900">Social Media Setup</h3>
                  <p class="text-gray-500 mt-1">Connect your social media accounts for seamless campaign management</p>
                  <div class="mt-2">
                    <span id="social-card-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      <span class="h-2 w-2 mr-1 rounded-full bg-gray-400"></span>
                      Not Started
                    </span>
                    <span class="text-sm text-gray-500 ml-2">Estimated time: 5 min</span>
                </div>
                        <div class="complete-icon hidden absolute right-5 top-2">
                          <i class="fas fa-check-circle text-green-500 text-xl"></i>
                    </div>
                    </div>
                <button onclick="showSocialModal()" class="btn-sleek inline-flex items-center text-sm font-medium text-white">
                  <i class="fas fa-share-alt mr-2"></i>
                  Connect Accounts
                        </button>
                    </div>
                    </div>
                    </div>
                    </div>

          
                </div>

        <!-- Support Card -->
        <div class="bg-white rounded-lg shadow p-6 flex flex-col md:flex-row items-center justify-between border border-blue-100">
          <div class="flex items-center mb-4 md:mb-0">
            <div class="flex-shrink-0">
              <i class="fas fa-info-circle text-blue-500 text-2xl mr-4"></i>
                        </div>
                        <div>
              <h3 class="text-lg font-semibold text-gray-800 mb-1">Need Assistance?</h3>
              <p class="text-gray-600 text-sm">If you have any questions or need help, our support team is here for you. Reach out anytime and we'll respond as soon as possible.</p>
                        </div>
                    </div>
          <button class="btn-sleek flex items-center px-6 py-2 text-white font-semibold rounded-lg shadow hover:bg-blue-700 transition duration-200" onclick="showHelpModal(event)">
            <i class="fas fa-envelope mr-2"></i>
            Send Us An Instant Message
          </button>
                    </div>
      </main>
                </div>
                <script>
      // Tab switching logic
                    document.addEventListener('DOMContentLoaded', function() {
        const tabSignup = document.getElementById('tab-signup');
        const tabLogin = document.getElementById('tab-login');
        const signupForm = document.getElementById('signup-form');
        const loginForm = document.getElementById('login-form');
        const resetForm = document.getElementById('reset-form');
        const resetConfirmation = document.getElementById('reset-confirmation');
        const forgotPasswordLink = loginForm.querySelector('a[href="#"]');
        const backToLogin = document.getElementById('back-to-login');
        const resetConfirmationBack = document.getElementById('reset-confirmation-back');
        const loginError = document.getElementById('login-error');

        function activateTab(tab) {
          resetForm.style.display = 'none';
          resetConfirmation.style.display = 'none';
          loginError.textContent = '';

          // Define active/inactive classes (Tailwind)
          const activeClasses = ['bg-white', 'text-blue-600', 'font-semibold']; // Active: White BG, Blue Text
          const inactiveClasses = ['bg-blue-50', 'text-blue-600', 'font-semibold', 'hover:bg-blue-100']; // Inactive: Light Blue BG, Blue Text

          // Reset both tabs to inactive state first
          tabLogin.classList.remove(...activeClasses);
          tabLogin.classList.add(...inactiveClasses);
          tabSignup.classList.remove(...activeClasses);
          tabSignup.classList.add(...inactiveClasses);

          if (tab === 'signup') {
            // Activate Signup Tab
            tabSignup.classList.remove(...inactiveClasses);
            tabSignup.classList.add(...activeClasses);
            signupForm.style.display = 'block';
            loginForm.style.display = 'none';
          } else { // Login Tab
            // Activate Login Tab
            tabLogin.classList.remove(...inactiveClasses);
            tabLogin.classList.add(...activeClasses);
            signupForm.style.display = 'none';
            loginForm.style.display = 'block';
          }
        }

        tabSignup.addEventListener('click', function() { activateTab('signup'); });
        tabLogin.addEventListener('click', function() { activateTab('login'); });

        // Set Login as the default active tab on initial load
        activateTab('login'); // Changed default from 'signup' to 'login'

        // Forgot password link
        forgotPasswordLink.addEventListener('click', function(e) {
                            e.preventDefault();
          signupForm.style.display = 'none';
          loginForm.style.display = 'none';
          resetForm.style.display = 'block';
          resetConfirmation.style.display = 'none';
          loginError.textContent = '';
        });

        // Back to login from reset form
        backToLogin.addEventListener('click', function(e) {
                            e.preventDefault();
          resetForm.style.display = 'none';
          resetConfirmation.style.display = 'none';
          activateTab('login');
        });

        // Back to login from confirmation
        resetConfirmationBack.addEventListener('click', function(e) {
                            e.preventDefault();
          resetForm.style.display = 'none';
          resetConfirmation.style.display = 'none';
          activateTab('login');
        });

        // --- Supabase Auth Logic ---
        // Sign Up
        signupForm.addEventListener('submit', async function(e) {
                            e.preventDefault();
          loginError.textContent = '';
          const btn = signupForm.querySelector('button[type="submit"]');
          btn.disabled = true;
          btn.textContent = 'Signing Up...';
          const firstName = document.getElementById('signup-first-name').value.trim();
          const lastName = document.getElementById('signup-last-name').value.trim();
          const phone = document.getElementById('signup-phone').value.trim();
          const businessName = document.getElementById('signup-business-name').value.trim();
          const username = document.getElementById('signup-username').value.trim();
          const email = document.getElementById('signup-email').value.trim();
          const password = document.getElementById('signup-password').value;
          const confirmPassword = document.getElementById('signup-confirm-password').value;
          if (!firstName || !lastName || !phone || !businessName || !username || !email || !password || !confirmPassword) {
            loginError.textContent = 'Please fill in all fields.';
            btn.disabled = false;
            btn.textContent = 'Sign Up';
                                return;
                            }
          if (password !== confirmPassword) {
            loginError.textContent = 'Passwords do not match.';
            btn.disabled = false;
            btn.textContent = 'Sign Up';
                                return;
                            }
                            try {
            const { data, error } = await window.supabase.auth.signUp({
              email,
              password,
              options: {
                data: {
                  username,
                  first_name: firstName,
                  last_name: lastName,
                  phone,
                  business_name: businessName
                }
              }
            });
            if (error) {
              loginError.textContent = error.message || JSON.stringify(error);
            // --- START OF CHANGE ---
            } else if (data && data.user && data.user.identities && data.user.identities.length > 0) {
              // Use alert for the confirmation message
              alert('Sign up successful! Please check your email and click on the Confirm Your Email button to activate your account.'); // <-- THIS LINE IS CHANGED
              signupForm.reset();
              // Optionally switch to the login tab
              // activateTab('login');
            } else {
              // Handle cases where user might exist but is unconfirmed, or other issues
              if (data && data.user && (!data.user.identities || data.user.identities.length === 0)) {
                 alert('Sign up started! Please check your email and click on the Confirm Your Email button to complete registration.'); // Also alert here for unconfirmed user
                 signupForm.reset();
              } else {
                 loginError.textContent = 'An unexpected issue occurred during sign up. Please try again or contact support.';
              }
            // --- END OF CHANGE ---
            }
          } catch (err) {
           loginError.textContent = err.message || err.toString();
          }
            // Log the full error object for more details
            console.error('[SignUp Error] Detailed error:', err);
            loginError.textContent = err.message || 'An unknown error occurred during sign up.'; // Display user-friendly message
          }
          btn.disabled = false;
          btn.textContent = 'Sign Up';
        });

        // Login
        loginForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          loginError.textContent = '';
          const btn = loginForm.querySelector('button[type="submit"]');
          btn.disabled = true;
          btn.textContent = 'Logging In...';
          const emailOrUsername = document.getElementById('login-email').value.trim();
          const password = document.getElementById('login-password').value;
          let email = emailOrUsername;
          // If username, look up email in Supabase (optional, requires a 'profiles' table)
          if (emailOrUsername.includes('@')) {
            email = emailOrUsername;
          } else {
            // Try to fetch email by username from 'profiles' table
            try {
              const { data: profile, error: profileError } = await window.supabase
                .from('profiles')
                .select('email')
                .eq('username', emailOrUsername)
                .single();
              if (profile && profile.email) {
                email = profile.email;
              } else {
                loginError.textContent = 'No account found for that username.';
                btn.disabled = false;
                btn.textContent = 'Login';
                return;
              }
            } catch (err) {
              loginError.textContent = 'Error looking up username.';
              btn.disabled = false;
              btn.textContent = 'Login';
                            return;
                        }
          }
          try {
            const { data, error } = await window.supabase.auth.signInWithPassword({ email, password });
            if (error) {
              loginError.textContent = error.message;
            } else {
              loginError.textContent = 'Login successful!';
              
              // Manually show dashboard instead of reloading
              const loginSection = document.getElementById('login-section');
              const dashboardSection = document.getElementById('dashboard-section');
              
              if (loginSection) loginSection.style.display = 'none';
              if (dashboardSection) dashboardSection.style.display = 'block';
              
              // Set currentUserEmail for other parts of the application
              if (data.user) {
                currentUserEmail = data.user.email;
                // Update user name display
                updateUserNameDisplay();
              }
            }
          } catch (err) {
            loginError.textContent = 'An error occurred. Please try again.';
          }
          btn.disabled = false;
          btn.textContent = 'Login';
        });

        // Forgot Password
        resetForm.addEventListener('submit', async function(e) {
                            e.preventDefault();
          const btn = resetForm.querySelector('button[type="submit"]');
          btn.disabled = true;
          btn.textContent = 'Sending...';
          const email = document.getElementById('reset-email').value.trim();
          if (!email) {
            btn.disabled = false;
            btn.textContent = 'Send Reset Link';
                            return;
                        }
          try {
            const { data, error } = await window.supabase.auth.resetPasswordForEmail(email);
            if (error) {
              resetConfirmation.textContent = error.message;
            } else {
              resetConfirmation.textContent = 'If an account with that email exists, a password reset link has been sent.';
            }
          } catch (err) {
            resetConfirmation.textContent = 'An error occurred. Please try again.';
          }
          resetForm.style.display = 'none';
          resetConfirmation.style.display = 'block';
          btn.disabled = false;
          btn.textContent = 'Send Reset Link';
        });

                </script>

    <!-- Getting Started Guide Modal -->
    <div id="guide-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50" style="display: none;">
        <div class="relative top-10 mx-auto p-5 border w-3/4 max-w-4xl shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white z-10 pb-4 border-b mb-4">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800" id="guide-title">TurnClicksToClients.com Welcome Guide</h3>
                    <button onclick="closeModal('guide-modal')" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <!-- Help Section -->
                <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                    <p class="text-sm text-yellow-800">
                        <i class="fas fa-info-circle mr-2"></i>
                        Please read through the instructions carefully before proceeding. Most questions can be answered by following the steps provided. If you still need assistance after trying the steps, our team can help. <button onclick="showHelpModal(event)" class="text-blue-600 hover:text-blue-800">Request assistance</button>
                    </p>
                </div>
            </div>
            
            <div class="space-y-6">
                <!-- Download Guide Section - Centered -->
                <div class="flex justify-center mb-8">
                    <div class="text-center">
                        <h4 class="text-2xl font-bold text-gray-800 mb-4">TurnClicksToClients.com Getting Started Guide</h4>
                        <p class="text-lg text-gray-600 mb-4">Click Here To View The Welcome Guide</p>
                        <button onclick="downloadGuide()" class="inline-flex items-center px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 text-lg">
                            <i class="fas fa-file-pdf mr-2"></i>
                            View Onboarding Guide
                        </button>
                    </div>
                </div>

                <!-- Rest of the content -->
                <div class="bg-white p-6 rounded-lg border">
                    <h4 class="text-lg font-semibold text-gray-800 mb-8">How to Complete This Onboarding Step</h4>
                    <div class="space-y-6">
                        <div class="bg-blue-50 border-l-4 border-blue-400 p-5 rounded">
                            <h5 class="text-base font-medium text-gray-800 mb-4">Complete These Actions:</h5>
                            <ol class="space-y-4 ml-2">
                                <li class="flex items-start">
                                    <div class="flex-shrink-0 h-6 w-6 rounded-full bg-blue-100 flex items-center justify-center mr-3 mt-0.5">
                                <span class="text-blue-600 font-medium">1</span>
                            </div>
                                    <div>
                                        <p class="text-sm text-gray-700"><span class="font-medium">View the Guide:</span> Click the "View Onboarding Guide" button at the top of this page to open the guide in a new tab.</p>
                                </div>
                                </li>
                                <li class="flex items-start">
                                    <div class="flex-shrink-0 h-6 w-6 rounded-full bg-blue-100 flex items-center justify-center mr-3 mt-0.5">
                                <span class="text-blue-600 font-medium">2</span>
                            </div>
                                    <div>
                                        <p class="text-sm text-gray-700"><span class="font-medium">Read Thoroughly:</span> Take the time to read and understand all the information in the guide.</p>
                                </div>
                                </li>
                                <li class="flex items-start">
                                    <div class="flex-shrink-0 h-6 w-6 rounded-full bg-blue-100 flex items-center justify-center mr-3 mt-0.5">
                                <span class="text-blue-600 font-medium">3</span>
                            </div>
                                    <div>
                                        <p class="text-sm text-gray-700"><span class="font-medium">Return to This Page:</span> After reading the guide, return to this page to continue your onboarding.</p>
                                </div>
                                </li>
                                <li class="flex items-start">
                                    <div class="flex-shrink-0 h-6 w-6 rounded-full bg-blue-100 flex items-center justify-center mr-3 mt-0.5">
                                <span class="text-blue-600 font-medium">4</span>
                            </div>
                                    <div>
                                        <p class="text-sm text-gray-700"><span class="font-medium">Complete the Quiz:</span> Answer the questions in the quiz section below to verify your understanding.</p>
                                </div>
                                </li>
                                <li class="flex items-start">
                                    <div class="flex-shrink-0 h-6 w-6 rounded-full bg-blue-100 flex items-center justify-center mr-3 mt-0.5">
                                        <span class="text-blue-600 font-medium">5</span>
                            </div>
                                    <div>
                                        <p class="text-sm text-gray-700"><span class="font-medium">Submit the Quiz:</span> Click the "Submit Quiz" button at the end to mark this step as complete.</p>
                                    </div>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="sticky bottom-0 bg-white pt-4 border-t mt-4">
                <div class="flex justify-end">
                    <!-- Quiz Complete button removed -->
                </div>
            </div>

            <!-- Brand-Specific Guide Section -->
            <div class="bg-white p-6 rounded-lg border mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">TurnClicksToClients.com Guide</h3>
                    <button onclick="downloadGuide()" class="flex items-center px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 text-sm">
                        <i class="fas fa-file-pdf mr-2"></i>
                        View Onboarding Guide
                    </button>
                </div>
                <p class="text-gray-600 mb-4">Please click the "View Onboarding Guide" button to read the guide. This guide contains important information about our partnership and steps to success.</p>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-info-circle text-yellow-400"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-yellow-700">
                                <strong>Important:</strong> Please follow these steps to complete this module:
                                <ol class="mt-2 ml-4 list-decimal">
                                    <li>Click the "View Onboarding Guide" button above</li>
                                    <li>Read and understand the entire guide</li>
                                    <li>Return to this page after reviewing the guide</li>
                                    <li>Complete the understanding quiz below</li>
                                    <li>Click "Submit Quiz" to mark this step as complete</li>
                                </ol>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quiz Section -->
            <div class="bg-white p-6 rounded-lg border mt-6">
                <h4 class="text-lg font-semibold text-gray-800 mb-4">Verify Your Understanding</h4>
                <form id="quiz-form" class="space-y-6">
                    <div>
                        <p class="text-sm font-medium text-gray-800 mb-3">1. What is the primary focus of TurnClicksToClients.com's service?</p>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="q1" value="website" class="mr-2">
                                <span class="text-sm text-gray-700">Website design and development</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q1" value="consulting" class="mr-2">
                                <span class="text-sm text-gray-700">General business consulting</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q1" value="leads" class="mr-2">
                                <span class="text-sm text-gray-700">Generating leads and booking appointments through social media ads</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q1" value="training" class="mr-2">
                                <span class="text-sm text-gray-700">Employee training and development</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <p class="text-sm font-medium text-gray-800 mb-3">2. Which tasks does TurnClicksToClients.com handle for your business?</p>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="q2" value="product" class="mr-2">
                                <span class="text-sm text-gray-700">Product development and inventory management</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q2" value="followup" class="mr-2">
                                <span class="text-sm text-gray-700">Ad campaigns, lead follow-up, and conversion to bookings</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q2" value="services" class="mr-2">
                                <span class="text-sm text-gray-700">In-person client services</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q2" value="recruitment" class="mr-2">
                                <span class="text-sm text-gray-700">Staff recruitment and payroll management</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <p class="text-sm font-medium text-gray-800 mb-3">3. What makes TurnClicksToClients.com's system particularly effective?</p>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="q3" value="prices" class="mr-2">
                                <span class="text-sm text-gray-700">Low prices and aggressive marketing</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q3" value="targeted" class="mr-2">
                                <span class="text-sm text-gray-700">Targeted ads and persistent follow-up</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q3" value="seo" class="mr-2">
                                <span class="text-sm text-gray-700">SEO and content marketing</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q3" value="email" class="mr-2">
                                <span class="text-sm text-gray-700">Email marketing and cold calling</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <p class="text-sm font-medium text-gray-800 mb-3">4. TurnClicksToClients.com's system is designed to work for:</p>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="q4" value="established" class="mr-2">
                                <span class="text-sm text-gray-700">Only established businesses with large budgets</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q4" value="small" class="mr-2">
                                <span class="text-sm text-gray-700">Only small businesses just starting out</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q4" value="all" class="mr-2">
                                <span class="text-sm text-gray-700">Businesses of all sizes and experience levels</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q4" value="specific" class="mr-2">
                                <span class="text-sm text-gray-700">Only businesses in specific industries</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <p class="text-sm font-medium text-gray-800 mb-3">5. What type of freedom does TurnClicksToClients.com's system aim to provide?</p>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="q5" value="taxes" class="mr-2">
                                <span class="text-sm text-gray-700">Freedom from paying taxes</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q5" value="bookings" class="mr-2">
                                <span class="text-sm text-gray-700">Freedom from inconsistent bookings and chasing leads</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q5" value="service" class="mr-2">
                                <span class="text-sm text-gray-700">Freedom from having to provide quality service</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q5" value="clients" class="mr-2">
                                <span class="text-sm text-gray-700">Freedom from having any clients at all</span>
                            </label>
                        </div>
                    </div>

                    <div class="mt-6 text-right">
                        <button type="button" onclick="verifyQuizAnswers()" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Submit Quiz
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Domain Selection Modal -->
    <div id="domain-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50" style="display: none;">
        <div class="relative top-10 mx-auto p-5 border w-3/4 max-w-4xl shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white z-10 pb-4 border-b mb-4">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800">Select Your Campaign Domain</h3>
                    <button onclick="closeModal('domain-modal')" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <!-- Domain Modal Help Section -->
                <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                    <p class="text-sm text-yellow-800">
                        <i class="fas fa-info-circle mr-2"></i>
                        Please read through the instructions carefully before proceeding. Most questions can be answered by following the steps provided. If you still need assistance after trying the steps, our team can help. <button onclick="showHelpModal(event)" class="text-blue-600 hover:text-blue-800">Request assistance</button>
                    </p>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Information Section -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">About Campaign Domain Selection</h4>
                    <p class="text-gray-600 mb-4">
                        You'll need to select a campaign domain for your marketing:
                    </p>
                    <ul class="list-disc list-inside space-y-2 text-gray-600">
                        <li>If you don't have a domain yet, we'll help you select one for your campaigns</li>
                        <li>If you already have a domain, you'll still select a new campaign domain that will run alongside your existing one</li>
                    </ul>
                    <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                        <p class="text-sm text-yellow-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            Having a dedicated campaign domain helps improve deliverability and maintain your brand's reputation for marketing campaigns.
                        </p>
                    </div>
                </div>

                <!-- Domain Search -->
                <div class="bg-white p-6 rounded-lg border">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Search for Your Domain</h4>
                    <div class="space-y-4">
                        <div class="flex space-x-4">
                            <div class="flex-1">
                                <input type="text" id="domain-search" placeholder="Enter your desired domain name" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <button id="domain-search-btn" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Check Availability
                            </button>
                        </div>
                        <div class="text-sm text-gray-500">
                            <p><i class="fas fa-lightbulb mr-1"></i> Tip: Keep it short, memorable, and related to your business</p>
                        </div>
                    </div>

                    <!-- Search Results -->
                    <div id="domain-results" class="mt-6 space-y-4">
                        <div id="domain-loading" class="hidden">
                            <p class="text-sm text-gray-600"><i class="fas fa-spinner fa-spin mr-2"></i> Searching available domains...</p>
                        </div>
                        <div id="domain-error" class="hidden">
                            <p class="text-sm text-red-600"><i class="fas fa-exclamation-circle mr-2"></i> <span id="domain-error-message"></span></p>
                        </div>
                        <div id="domain-results-container" class="hidden">
                            <h5 class="font-medium text-gray-800 mb-3">Available Domains:</h5>
                            <div id="domain-list" class="space-y-3 border rounded-lg p-3 max-h-48 overflow-y-auto">
                            <!-- Domain results will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Selected Domain -->
                <div id="selected-domain-section" class="bg-white p-6 rounded-lg border hidden">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Selected Domain</h4>
                    <div class="p-4 bg-green-50 rounded-lg border border-green-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-medium text-green-800" id="selected-domain-name"></p>
                            </div>
                            <button id="domain-clear-btn" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="sticky bottom-0 bg-white pt-4 border-t mt-4">
                <div class="flex justify-between">
                    <button onclick="closeModal('domain-modal')" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 text-sm">
                        Cancel
                    </button>
                    <button id="confirm-domain-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm hidden">
                        Confirm Domain
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Social Media Integration Modal -->
    <div id="social-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50" style="display: none;">
        <div class="relative top-10 mx-auto p-5 border w-3/4 max-w-4xl shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white z-10 pb-4 border-b mb-4">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800">Connect Your Social Media Accounts</h3>
                    <button onclick="closeModal('social-modal')" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <!-- Social Media Modal Help Section -->
                <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                    <p class="text-sm text-yellow-800">
                        <i class="fas fa-info-circle mr-2"></i>
                        Please read through the instructions carefully before proceeding. Most questions can be answered by following the steps provided. If you still need assistance after trying the steps, our team can help. <button onclick="showHelpModal(event)" class="text-blue-600 hover:text-blue-800">Request assistance</button>
                    </p>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Information Section -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Why Connect Your Social Media?</h4>
                    <p class="text-gray-600 mb-4">
                        Connecting your social media accounts with TurnClicksToClients.com enables seamless campaign management and optimization:
                    </p>
                    <ul class="list-disc list-inside space-y-2 text-gray-600">
                        <li>Centralized campaign management across all platforms</li>
                        <li>Streamlined ad account access and permissions</li>
                        <li>Efficient budget management and optimization</li>
                        <li>Unified analytics and reporting</li>
                        <li>Enhanced targeting capabilities</li>
                    </ul>
                    <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                        <p class="text-sm text-yellow-800">
                            <i class="fas fa-shield-alt mr-2"></i>
                            Your account security is our priority. We only request necessary permissions to manage your campaigns effectively.
                        </p>
                    </div>
                </div>

                <!-- Setup Options -->
                <div class="bg-white p-6 rounded-lg border">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Do you have existing Meta business assets?</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="p-4 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="showExistingAssetsFlow()">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-check-circle text-green-600 mr-2"></i>
                                <h5 class="font-medium text-gray-800">Yes, I have existing assets</h5>
                            </div>
                            <p class="text-sm text-gray-600">I already have a Meta Business Manager, ad account, and business page set up.</p>
                        </div>
                        <div class="p-4 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="showSetupGuide()">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-plus-circle text-blue-600 mr-2"></i>
                                <h5 class="font-medium text-gray-800">No, I need to set them up</h5>
                            </div>
                            <p class="text-sm text-gray-600">I need help creating my Meta Business Manager, ad account, and business page.</p>
                        </div>
                    </div>
                </div>

                <!-- Existing Assets Flow (Hidden by default) -->
                <div id="existing-assets-flow" class="space-y-4 hidden">
                    <!-- Facebook Business Manager -->
                    <div class="bg-white p-6 rounded-lg border">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <i class="fab fa-facebook text-[#1877F2] text-3xl mr-4"></i>
                                <div>
                                    <h5 class="font-medium text-gray-800">Facebook Business Manager</h5>
                                    <p class="text-sm text-gray-600">Connect your ad accounts and business pages</p>
                                </div>
                            </div>
                            <button onclick="connectFacebookManager()" class="px-4 py-2 bg-[#1877F2] text-white rounded-md hover:bg-[#1664d9] flex items-center">
                                <i class="fas fa-plug mr-2"></i>Connect
                            </button>
                        </div>
                        <div class="text-sm text-gray-500">
                            <p><i class="fas fa-info-circle mr-1"></i> Grants access to manage ad accounts and pages</p>
                        </div>
                    </div>

                    <!-- Instagram Business -->
                    <div class="bg-white p-6 rounded-lg border">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <i class="fab fa-instagram text-[#E4405F] text-3xl mr-4"></i>
                                <div>
                                    <h5 class="font-medium text-gray-800">Instagram Business</h5>
                                    <p class="text-sm text-gray-600">Connect your Instagram business account</p>
                                </div>
                            </div>
                            <button onclick="connectInstagram()" class="px-4 py-2 bg-[#E4405F] text-white rounded-md hover:bg-[#d63851] flex items-center">
                                <i class="fas fa-plug mr-2"></i>Connect
                            </button>
                        </div>
                        <div class="text-sm text-gray-500">
                            <p><i class="fas fa-info-circle mr-1"></i> Links your Instagram business profile</p>
                        </div>
                    </div>
                </div>

                <!-- Setup Guide (Hidden by default) -->
                <div id="setup-guide" class="space-y-4 hidden">
                    <div class="bg-blue-50 p-6 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-800 mb-3">Let's Get You Set Up!</h4>
                        <p class="text-gray-600 mb-4">
                            We'll help you create your Meta business assets step by step. This process typically takes about 15-20 minutes.
                        </p>
                        <div class="space-y-4">
                            <div class="flex items-start">
                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                    <span class="text-blue-600 font-medium">1</span>
                                </div>
                                <div class="ml-4">
                                    <h5 class="text-sm font-medium text-gray-800">Create Meta Business Manager</h5>
                                    <p class="text-sm text-gray-600">Set up your business's central hub for managing assets</p>
                                    <button onclick="openMetaBusinessManager()" class="mt-2 px-4 py-2 bg-[#1877F2] text-white rounded-md hover:bg-[#1664d9] text-sm">
                                        Create Business Manager
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                    <span class="text-blue-600 font-medium">2</span>
                                </div>
                                <div class="ml-4">
                                    <h5 class="text-sm font-medium text-gray-800">Create Facebook Business Page</h5>
                                    <p class="text-sm text-gray-600">Establish your business's presence on Facebook</p>
                                    <button onclick="openFacebookPageCreation()" class="mt-2 px-4 py-2 bg-[#1877F2] text-white rounded-md hover:bg-[#1664d9] text-sm">
                                        Create Business Page
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                    <span class="text-blue-600 font-medium">3</span>
                                </div>
                                <div class="ml-4">
                                    <h5 class="text-sm font-medium text-gray-800">Create Ad Account</h5>
                                    <p class="text-sm text-gray-600">Set up your advertising account for running campaigns</p>
                                    <button onclick="openAdAccountCreation()" class="mt-2 px-4 py-2 bg-[#1877F2] text-white rounded-md hover:bg-[#1664d9] text-sm">
                                        Create Ad Account
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                    <span class="text-blue-600 font-medium">4</span>
                                </div>
                                <div class="ml-4">
                                    <h5 class="text-sm font-medium text-gray-800">Connect Instagram Business</h5>
                                    <p class="text-sm text-gray-600">Link your Instagram account to your business</p>
                                    <button onclick="openInstagramSetup()" class="mt-2 px-4 py-2 bg-[#E4405F] text-white rounded-md hover:bg-[#d63851] text-sm">
                                        Set Up Instagram
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Connected Accounts -->
                <div id="connected-accounts" class="bg-white p-6 rounded-lg border hidden">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Connected Accounts</h4>
                    <div class="space-y-3" id="accounts-list">
                        <!-- Connected accounts will be listed here -->
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="sticky bottom-0 bg-white pt-4 border-t mt-4">
                <div class="flex justify-between">
                    <button onclick="closeModal('social-modal')" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 text-sm">
                        Close
                    </button>
                    <button onclick="confirmSocialConnections()" id="confirm-social-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm hidden">
                        Confirm Connections
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Slack Integration Modal -->
    <div id="slack-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50" style="display: none;">
        <div class="relative top-10 mx-auto p-5 border w-3/4 max-w-4xl shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white z-10 pb-4 border-b mb-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">Join Our Slack Support Group</h3>
                    <button onclick="closeModal('slack-modal')" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <!-- Help Section -->
                <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                    <p class="text-sm text-yellow-800">
                        <i class="fas fa-info-circle mr-2"></i>
                        Please read through the instructions carefully before proceeding. Most questions can be answered by following the steps provided. If you still need assistance after trying the steps, our team can help. <button onclick="showHelpModal(event)" class="text-blue-600 hover:text-blue-800">Request assistance</button>
                    </p>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Information Section -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Your Dedicated Support Channel</h4>
                    <p class="text-gray-600 mb-4">
                        We'll create a private Slack channel for you and your team, where you'll have direct access to our support team for:
                    </p>
                    <ul class="list-disc list-inside space-y-2 text-gray-600 mb-4">
                        <li>One-on-one support and guidance</li>
                        <li>Quick answers to your questions</li>
                        <li>Regular check-ins and updates</li>
                        <li>Best practices and tips</li>
                        <li>Exclusive resources and training</li>
                    </ul>
                    
                    <!-- Support Team Section -->
                    <div class="mt-4 border-t pt-4">
                        <h5 class="text-md font-semibold text-gray-800 mb-2">Your Support Team</h5>
                        <p class="text-gray-600 mb-3">These team members will be added to your channel:</p>
                        <div class="flex items-center p-3 bg-white rounded-lg shadow-sm">
                            <div class="h-10 w-10 rounded-full bg-purple-100 flex items-center justify-center">
                                <span class="text-purple-600 font-medium">EA</span>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-gray-800">Eizel A</p>
                                <p class="text-xs text-gray-500">Account Manager</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Setup Steps -->
                <div class="space-y-4">
                    <!-- Step 1: Slack Account -->
                    <div class="bg-white p-6 rounded-lg border">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                <span class="text-blue-600 font-medium">1</span>
                            </div>
                            <div class="ml-4">
                                <h5 class="text-sm font-medium text-gray-800">Get Started with Slack</h5>
                                <p class="text-sm text-gray-600 mb-4">Download the Slack app and create an account if you don't have one already.</p>
                                <div class="flex space-x-4">
                                    <a href="https://slack.com/download" target="_blank" class="px-4 py-2 bg-[#4A154B] text-white rounded-md hover:bg-[#3a1038] flex items-center">
                                        <i class="fab fa-slack mr-2"></i>Download Slack
                                    </a>
                                    <a href="https://slack.com/signin" target="_blank" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 flex items-center">
                                        <i class="fas fa-user-plus mr-2"></i>Create Account
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Join Workspace -->
                    <div class="bg-white p-6 rounded-lg border">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                <span class="text-blue-600 font-medium">2</span>
                            </div>
                            <div class="ml-4">
                                <h5 class="text-sm font-medium text-gray-800">Join Our Slack Workspace</h5>
                                <p class="text-sm text-gray-600 mb-4">You'll need to join our Slack workspace first to get access to your support channel.</p>
                                <div class="flex space-x-4">
                                    <a href="https://join.slack.com/t/theconnectorgrouphq/shared_invite/zt-34k3y5ib4-fJskL59X1IeavkEx02ORtw" target="_blank" class="px-4 py-2 bg-[#4A154B] text-white rounded-md hover:bg-[#3a1038] flex items-center">
                                        <i class="fab fa-slack mr-2"></i>Join Workspace
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Channel Creation -->
                    <div class="bg-white p-6 rounded-lg border">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                <span class="text-blue-600 font-medium">3</span>
                            </div>
                            <div class="ml-4">
                                <h5 class="text-sm font-medium text-gray-800">Create Your Support Channel</h5>
                                <p class="text-sm text-gray-600 mb-4">We'll automatically create a private channel for you and add our support team.</p>
                                <div class="space-y-4">
                                    <div class="flex items-center space-x-4">
                                        <div class="flex-1">
                                            <label class="block text-sm font-medium text-gray-700">Business Name</label>
                                            <input type="text" id="business-name" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Enter your business name" required>
        </div>
                                        <div class="flex-1">
                                            <label class="block text-sm font-medium text-gray-700">Your Name</label>
                                            <input type="text" id="client-name" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Enter your name" required>
        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Slack Email</label>
                                        <input type="email" id="slack-email" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Enter your Slack email" required>
                                        <p class="mt-1 text-sm text-red-600"><i class="fas fa-exclamation-triangle mr-1"></i>Important: This must match the email you used to join the Slack workspace above!</p>
                                    </div>
                                    <button type="button" onclick="createSlackChannel()" 
                                       class="w-full px-4 py-2 bg-[#4A154B] text-white rounded-md hover:bg-[#3a1038] flex items-center justify-center">
                                        <i class="fab fa-slack mr-2"></i>Create Support Channel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Manual Confirmation Section -->
                    <div class="bg-white p-6 rounded-lg border mt-4">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                <span class="text-blue-600 font-medium">4</span>
                            </div>
                            <div class="ml-4">
                                <h5 class="text-sm font-medium text-gray-800">Confirm Your Slack Membership</h5>
                                <p class="text-sm text-gray-600 mb-4">After you've joined our Slack workspace, click the button below to complete this step in your onboarding process.</p>
                                <div class="p-4 bg-yellow-50 rounded-md border border-yellow-200 mb-4">
                                    <div class="flex items-center">
                                        <i class="fas fa-exclamation-triangle text-yellow-600 mr-2"></i>
                                        <p class="text-sm font-semibold text-yellow-800">Important: After joining the Slack channel, you MUST click the button below to complete this step!</p>
        </div>
        </div>
                                <button id="confirm-slack-joined" class="w-full mt-2 px-4 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center justify-center font-medium text-base">
                                    <i class="fas fa-check-circle mr-2"></i>Yes, I've Joined Slack
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="sticky bottom-0 bg-white pt-4 border-t mt-6">
                <div class="flex justify-between">
                    <button onclick="closeModal('slack-modal')" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 text-sm">
                        Close
                    </button>
                    <button onclick="confirmSlackSetup()" id="confirm-slack-btn" class="px-4 py-2 bg-[#4A154B] text-white rounded-md hover:bg-[#3a1038] text-sm hidden">
                        Complete Setup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Signature Modal -->
    <div id="signatureModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="modal-content bg-white p-6 rounded-lg shadow-lg relative w-full max-w-md">
            <h2 class="text-xl font-semibold mb-4">Sign Your Agreement</h2>
            <div style="border: 1px solid #ccc; width: 100%; max-width: 600px; margin: 20px 0;">
                <canvas id="modal-signature-pad" width="600" height="200" style="background: #fff;"></canvas>
            </div>
            <div class="mt-4 flex justify-between">
                <button type="button" onclick="clearModalSignature()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Clear</button>
                <button type="button" onclick="saveModalSignatureAndAgreement()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Save Signature & Confirm</button>
            </div>
            <input type="hidden" id="modal-signature-data" name="modal-signature-data">
            <button type="button" onclick="closeModal('signatureModal')" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-2xl font-bold">&times;</button>
        </div>
    </div>

    <!-- Verification Modal -->
    <div id="verification-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50" style="display: none;">
        <div class="relative top-10 mx-auto p-5 border w-3/4 max-w-4xl shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white z-10 pb-4 border-b mb-4">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800">Verify Your Information</h3>
                    <button onclick="closeModal('verification-modal')" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <!-- Verification Modal Help Section -->
                <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                    <p class="text-sm text-yellow-800">
                        <i class="fas fa-info-circle mr-2"></i>
                        Please read through the instructions carefully before proceeding. Most questions can be answered by following the steps provided. If you still need assistance after trying the steps, our team can help. <button onclick="showHelpModal(event)" class="text-blue-600 hover:text-blue-800">Request assistance</button>
                    </p>
        </div>
    </div>

            <form id="verification-form" class="space-y-6">
                <!-- Personal Information -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Personal Information</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">First Name</label>
                            <input type="text" id="first-name" name="first-name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Last Name</label>
                            <input type="text" id="last-name" name="last-name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>

                <!-- Business Information -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Business Information</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="verification-business-name" class="block text-sm font-medium text-gray-700 mb-1">Business Name *</label> <!-- Changed for attribute -->
                            <input type="text" id="verification-business-name" name="business-name" placeholder="Enter Your Business Name" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"> <!-- Changed ID -->
                        </div>
                        <div>
                            <label for="program-selected" class="block text-sm font-medium text-gray-700 mb-1">Which Program Did You Select? *</label>
                            <select id="program-selected" name="program-selected" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white">
                                <option value="">-- Please Choose --</option>
                                <option value="LashConnector">LashConnector (Clients for Lash Artists)</option>
                                <option value="BrowConnector">BrowConnector (Clients for Brow Artists)</option>
                            </select>
                        </div>
                        
                        <!-- Logo Upload -->
                        <div class="md:col-span-2 mt-3">
                            <label for="logo-upload" class="block text-sm font-medium text-gray-700 mb-1">Business Logo (Optional)</label>
                            <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                                <div class="space-y-1 text-center">
                                    <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="flex text-sm text-gray-600 justify-center">
                                        <label for="logo-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none">
                                            <span>Upload a logo</span>
                                            <input id="logo-upload" name="logo-upload" type="file" class="sr-only" accept="image/*">
                                        </label>
                                    </div>
                                    <p class="text-xs text-gray-500">PNG, JPG, GIF up to 5MB</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Marketing Images -->
                        <div class="md:col-span-2 mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Marketing Images (Optional)</label>
                            <p class="text-xs text-gray-500 mb-3">Upload up to 5 images you would like featured in your marketing campaigns</p>
                            
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
                                <!-- Image Upload 1 -->
                                <div class="border-2 border-gray-300 border-dashed rounded-md p-3 text-center">
                                    <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="mt-2">
                                        <label for="marketing-image-1" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none text-xs">
                                            <span>Upload image 1</span>
                                            <input id="marketing-image-1" name="marketing-image-1" type="file" class="sr-only" accept="image/*">
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Image Upload 2 -->
                                <div class="border-2 border-gray-300 border-dashed rounded-md p-3 text-center">
                                    <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="mt-2">
                                        <label for="marketing-image-2" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none text-xs">
                                            <span>Upload image 2</span>
                                            <input id="marketing-image-2" name="marketing-image-2" type="file" class="sr-only" accept="image/*">
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Image Upload 3 -->
                                <div class="border-2 border-gray-300 border-dashed rounded-md p-3 text-center">
                                    <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="mt-2">
                                        <label for="marketing-image-3" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none text-xs">
                                            <span>Upload image 3</span>
                                            <input id="marketing-image-3" name="marketing-image-3" type="file" class="sr-only" accept="image/*">
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Image Upload 4 -->
                                <div class="border-2 border-gray-300 border-dashed rounded-md p-3 text-center">
                                    <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="mt-2">
                                        <label for="marketing-image-4" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none text-xs">
                                            <span>Upload image 4</span>
                                            <input id="marketing-image-4" name="marketing-image-4" type="file" class="sr-only" accept="image/*">
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Image Upload 5 -->
                                <div class="border-2 border-gray-300 border-dashed rounded-md p-3 text-center">
                                    <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="mt-2">
                                        <label for="marketing-image-5" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none text-xs">
                                            <span>Upload image 5</span>
                                            <input id="marketing-image-5" name="marketing-image-5" type="file" class="sr-only" accept="image/*">
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">PNG, JPG, GIF up to 5MB each</p>
                        </div>
                    </div>
                </div>

                <!-- Business Address -->
                <div class="bg-gray-50 p-4 rounded-lg mt-4">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Business Address</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700">Street Address</label>
                            <input type="text" id="business-address" name="business-address" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">City</label>
                            <input type="text" id="city" name="city" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">State</label>
                            <select id="state" name="state" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white">
                                <option value="">Select State</option>
                                <option value="AL">Alabama</option>
                                <option value="AK">Alaska</option>
                                <option value="AZ">Arizona</option>
                                <option value="AR">Arkansas</option>
                                <option value="CA">California</option>
                                <option value="CO">Colorado</option>
                                <option value="CT">Connecticut</option>
                                <option value="DE">Delaware</option>
                                <option value="FL">Florida</option>
                                <option value="GA">Georgia</option>
                                <option value="HI">Hawaii</option>
                                <option value="ID">Idaho</option>
                                <option value="IL">Illinois</option>
                                <option value="IN">Indiana</option>
                                <option value="IA">Iowa</option>
                                <option value="KS">Kansas</option>
                                <option value="KY">Kentucky</option>
                                <option value="LA">Louisiana</option>
                                <option value="ME">Maine</option>
                                <option value="MD">Maryland</option>
                                <option value="MA">Massachusetts</option>
                                <option value="MI">Michigan</option>
                                <option value="MN">Minnesota</option>
                                <option value="MS">Mississippi</option>
                                <option value="MO">Missouri</option>
                                <option value="MT">Montana</option>
                                <option value="NE">Nebraska</option>
                                <option value="NV">Nevada</option>
                                <option value="NH">New Hampshire</option>
                                <option value="NJ">New Jersey</option>
                                <option value="NM">New Mexico</option>
                                <option value="NY">New York</option>
                                <option value="NC">North Carolina</option>
                                <option value="ND">North Dakota</option>
                                <option value="OH">Ohio</option>
                                <option value="OK">Oklahoma</option>
                                <option value="OR">Oregon</option>
                                <option value="PA">Pennsylvania</option>
                                <option value="RI">Rhode Island</option>
                                <option value="SC">South Carolina</option>
                                <option value="SD">South Dakota</option>
                                <option value="TN">Tennessee</option>
                                <option value="TX">Texas</option>
                                <option value="UT">Utah</option>
                                <option value="VT">Vermont</option>
                                <option value="VA">Virginia</option>
                                <option value="WA">Washington</option>
                                <option value="WV">West Virginia</option>
                                <option value="WI">Wisconsin</option>
                                <option value="WY">Wyoming</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ZIP Code</label>
                            <input type="text" id="zip" name="zip" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                        <div class="md:col-span-2">
                            <label for="service-city" class="block text-sm font-medium text-gray-700 mb-1">City You Service *</label>
                            <input type="text" id="service-city" name="service-city" placeholder="Enter the Main City You Service" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="bg-gray-50 p-4 rounded-lg mt-4">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Contact Information</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Personal Phone</label>
                            <input type="tel" id="personal-phone" name="personal-phone" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Business Phone</label>
                            <input type="tel" id="business-phone" name="business-phone" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Personal Email</label>
                            <input type="email" id="personal-email" name="personal-email" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Business Email</label>
                            <input type="email" id="business-email" name="business-email" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>
                
                <!-- The Connector Group Service Agreement -->
                <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg space-y-4 max-h-96 overflow-y-auto">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3 text-center">TURNCLICKSTOCLIENTS.COM SERVICE AGREEMENT</h4>

                    <p>This Service Agreement (the "Agreement") is entered into by and between TurnClicksToClients.com ("TurnClicksToClients.com" or "We") and the undersigned customer ("Customer" or "You") as of the date of signing this Agreement. By signing this Agreement, Customer agrees to all of the terms and conditions outlined below. This is a week-to-week agreement, and by continuing to make payments, you acknowledge and agree to the following terms:</p>

                    <div class="space-y-2">
                        <h5 class="font-semibold">1. Agreement Term and Payment Structure</h5>
                        <p><strong>1.1 Billing Cycle:</strong> The Customer agrees to a week-to-week service agreement. You will be billed on a weekly basis based on the plan you selected.</p>
                        <p><strong>1.2 Non-Refundable Payments:</strong> All payments made to TurnClicksToClients.com are non-refundable under any circumstances.</p>
                    </div>

                    <div class="space-y-2">
                        <h5 class="font-semibold">2. Service Description</h5>
                        <p><strong>2.1 Core Services:</strong> TurnClicksToClients.com will provide business messaging and communication services as outlined in your selected service package.</p>
                        <p><strong>2.2 Service Limitations:</strong> Services are subject to carrier and platform limitations. We do not guarantee specific results or outcomes.</p>
                    </div>

                    <div class="space-y-2">
                        <h5 class="font-semibold">3. Customer Responsibilities</h5>
                        <p><strong>3.1 Compliance:</strong> Customer agrees to comply with all applicable laws and regulations regarding business messaging.</p>
                        <p><strong>3.2 Content:</strong> Customer is responsible for providing and approving all message content and ensuring it meets legal requirements.</p>
                    </div>

                    <div class="space-y-2">
                        <h5 class="font-semibold">4. Termination</h5>
                        <p><strong>4.1 Notice Period:</strong> Either party may terminate this Agreement with 7 days written notice.</p>
                        <p><strong>4.2 Final Payment:</strong> Customer shall pay all outstanding fees for services rendered through the termination date.</p>
                    </div>

                    <div class="space-y-2">
                        <h5 class="font-semibold">5. Intellectual Property</h5>
                        <p><strong>5.1 Ownership:</strong> All intellectual property related to our services remains the property of TurnClicksToClients.com.</p>
                        <p><strong>5.2 Usage Rights:</strong> Customer receives a limited license to use our services during the agreement term.</p>
                    </div>

                    <div class="space-y-2">
                        <h5 class="font-semibold">6. Data Privacy and Security</h5>
                        <p><strong>6.1 Data Handling:</strong> We handle all customer data in accordance with our privacy policy and applicable laws.</p>
                        <p><strong>6.2 Security Measures:</strong> We implement reasonable security measures to protect customer data.</p>
                    </div>

                    <div class="space-y-2">
                        <h5 class="font-semibold">7. Limitation of Liability</h5>
                        <p><strong>7.1 Liability Cap:</strong> Our liability is limited to the amount paid for services in the previous month.</p>
                        <p><strong>7.2 Indirect Damages:</strong> We are not liable for any indirect, consequential, or special damages.</p>
                    </div>
                </div>

                <!-- Agreement Form Group -->
                <div class="mt-4 mb-4">
                    <div class="flex items-start">
                        <div class="flex items-center h-5">
                            <input id="agreementCheck" type="checkbox" value="" class="w-4 h-4 border-gray-300 rounded">
                        </div>
                        <div class="ml-3 text-sm">
                            <label for="agreementCheck" class="font-medium text-gray-700">I agree to the terms and conditions</label>
                        </div>
                    </div>
                </div>

                <!-- Hidden field for agreement status -->
                <input type="hidden" id="agreement_status" name="agreement_status">
                <input type="hidden" id="signature_data" name="signature_data">

                <!-- Signature Section -->
                <div class="mt-6 mb-4">
                    <label for="signature-pad-container" class="block text-sm font-medium text-gray-700 mb-2">Your Signature</label>
                    <div id="signature-pad-container" class="border border-gray-300 rounded-md bg-white p-2 mb-2" style="height: 200px; position: relative;">
                        <canvas id="verification-signature-pad" width="600" height="200" style="background: #fff;"></canvas>
                        <div class="absolute bottom-2 right-2">
                            <button type="button" onclick="clearVerificationSignature()" class="text-sm text-red-600 hover:text-red-700 mr-2">
                                <i class="fas fa-eraser mr-1"></i> Clear
                            </button>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">Please sign with your mouse or finger to confirm your agreement to the terms above.</p>
                </div>

                <div class="mt-6 flex justify-end"> 
                    <button type="button" onclick="submitVerificationForm()" class="btn-next px-6 py-2 rounded-lg font-medium text-white bg-blue-600 hover:bg-blue-700 transition duration-200">
                        Submit Verification <i class="fas fa-check ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: Review -->
            <div class="form-step" data-step="3" style="display: none;">
                <div class="bg-blue-50 p-4 rounded-lg mb-6">
                    <h2 class="text-xl font-semibold mb-2 text-gray-800">Review Your Information</h2>
                    <p class="text-gray-600">
                        Please review the information you provided to ensure it is accurate. Double check the details on your CP575 form and confirm that all the information is correct.
                    </p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm mb-6">
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Full Name:</span>
                            <span class="font-medium" id="reviewFullName"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Email:</span>
                            <span class="font-medium" id="reviewEmail"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Phone:</span>
                            <span class="font-medium" id="reviewPhone"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">EIN:</span>
                            <span class="font-medium" id="reviewEin"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Business Name:</span>
                            <span class="font-medium" id="reviewBusinessName"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Business Address:</span>
                            <span class="font-medium" id="reviewBusinessAddress"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Business City:</span>
                            <span class="font-medium" id="reviewBusinessCity"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Business State:</span>
                            <span class="font-medium" id="reviewBusinessState"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Business ZIP:</span>
                            <span class="font-medium" id="reviewBusinessZip"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">CP575 Document:</span>
                            <span class="font-medium" id="reviewCP575"></span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center mb-6 p-4 bg-gray-50 rounded-lg">
                    <input type="checkbox" id="confirmDetails" required class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="confirmDetails" class="ml-2 text-sm text-gray-600">I confirm that my details are correct as per my CP575 form.</label>
                </div>
                <div class="flex justify-between">
                    <button type="button" class="btn-prev px-6 py-2 rounded-lg font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-200" onclick="prevStep(2)">
                        <i class="fas fa-arrow-left mr-2"></i> Back
                    </button>
                    <button type="button" class="btn-submit px-6 py-2 rounded-lg font-medium text-white bg-green-600 hover:bg-green-700 transition duration-200" onclick="handleA2PSubmitClick()">
                        Submit Registration
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- A2P Registration Modal -->
<div id="a2p-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50" style="display: none;">
    <div class="relative top-10 mx-auto p-5 border w-3/4 max-w-4xl shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto">
        <div class="sticky top-0 bg-white z-10 pb-4 border-b mb-4">
            <div class="flex justify-between items-center">
                <h3 class="text-2xl font-bold text-gray-800">A2P Messaging Registration</h3>
                <button onclick="closeModal('a2p-modal')" class="text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <!-- A2P Modal Help Section -->
            <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                <p class="text-sm text-yellow-800">
                    <i class="fas fa-info-circle mr-2"></i>
                    Please read through the instructions carefully before proceeding. Most questions can be answered by following the steps provided. If you still need assistance after trying the steps, our team can help. <button onclick="showHelpModal(event)" class="text-blue-600 hover:text-blue-800">Request assistance</button>
                </p>
            </div>
        </div>

        <!-- Initial A2P Information -->
        <div class="mb-8">
            <p class="text-gray-600 mb-8">
                A2P (Application-to-Person) messaging allows businesses to send SMS messages to large audiences in compliance with regulations. LashConnector helps you register for A2P messaging, ensuring you stay compliant while communicating with your clients effectively.
            </p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <!-- What is A2P? -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <div class="flex items-center mb-4">
                        <div class="bg-blue-100 p-3 rounded-full mr-4">
                            <i class="fas fa-mobile-alt text-blue-600 text-xl"></i>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-800">What is A2P?</h4>
                    </div>
                    <p class="text-gray-600">
                        Application-to-Person messaging is the process of sending automated SMS messages from a business application to mobile users.
                    </p>
                </div>

                <!-- Why Register? -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <div class="flex items-center mb-4">
                        <div class="bg-blue-100 p-3 rounded-full mr-4">
                            <i class="fas fa-shield-alt text-blue-600 text-xl"></i>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-800">Why Register?</h4>
                    </div>
                    <p class="text-gray-600">
                        Registration ensures compliance with carrier regulations, prevents message blocking, and maintains high delivery rates.
                    </p>
                </div>

                <!-- Our Role -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <div class="flex items-center mb-4">
                        <div class="bg-blue-100 p-3 rounded-full mr-4">
                            <i class="fas fa-handshake text-blue-600 text-xl"></i>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-800">Our Role</h4>
                    </div>
                    <p class="text-gray-600">
                        LashConnector simplifies the registration process and acts as your liaison with carriers for A2P compliance.
                    </p>
                </div>
            </div>

            <!-- Learn More Section -->
            <div class="mb-8">
                <button id="learn-more-btn" class="bg-blue-600 text-white px-6 py-2 rounded-lg flex items-center hover:bg-blue-700 transition duration-200">
                    Learn More About A2P
                    <i class="fas fa-chevron-down ml-2 transition-transform duration-200"></i>
                </button>
                
                <div id="learn-more-content" class="hidden mt-4">
                    <!-- Educational Content -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="mb-8">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">What You Need to Know About A2P Registration</h3>
                            <div class="grid md:grid-cols-2 gap-6">
                                <!-- Left Column -->
                                <div class="space-y-6">
                                    <div class="info-card bg-blue-50 p-4 rounded-lg border-l-4 border-blue-600">
                                        <h4 class="font-semibold text-gray-800 mb-2">Registration Requirements</h4>
                                        <ul class="list-disc list-inside text-gray-600 space-y-2">
                                            <li>Valid EIN (Employer Identification Number)</li>
                                            <li>Business name exactly as shown on CP575</li>
                                            <li>Business address verification</li>
                                            <li>Privacy Policy and Terms of Service</li>
                                            <li>Active business website</li>
                                        </ul>
                                    </div>
                                    <div class="info-card bg-blue-50 p-4 rounded-lg border-l-4 border-blue-600">
                                        <h4 class="font-semibold text-gray-800 mb-2">Benefits of Registration</h4>
                                        <ul class="list-disc list-inside text-gray-600 space-y-2">
                                            <li>Higher message delivery rates</li>
                                            <li>Protection against spam filtering</li>
                                            <li>Improved sender reputation</li>
                                            <li>Access to advanced messaging features</li>
                                            <li>Compliance with carrier regulations</li>
                                        </ul>
                                    </div>
                                </div>
                                <!-- Right Column -->
                                <div class="space-y-6">
                                    <div class="info-card bg-blue-50 p-4 rounded-lg border-l-4 border-blue-600">
                                        <h4 class="font-semibold text-gray-800 mb-2">Common Use Cases</h4>
                                        <ul class="list-disc list-inside text-gray-600 space-y-2">
                                            <li>Appointment reminders and confirmations</li>
                                            <li>Order status updates and tracking</li>
                                            <li>Customer service notifications</li>
                                            <li>Marketing campaigns and promotions</li>
                                            <li>Two-factor authentication (2FA)</li>
                                        </ul>
                                    </div>
                                    <div class="info-card bg-blue-50 p-4 rounded-lg border-l-4 border-blue-600">
                                        <h4 class="font-semibold text-gray-800 mb-2">Our Support</h4>
                                        <ul class="list-disc list-inside text-gray-600 space-y-2">
                                            <li>Guided registration process</li>
                                            <li>Documentation assistance</li>
                                            <li>Compliance monitoring</li>
                                            <li>Technical support</li>
                                            <li>Regular updates and maintenance</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="px-6 pt-6">
            <div class="flex justify-between mb-6">
                <div class="progress-step flex flex-col items-center w-1/3">
                    <div class="w-12 h-12 rounded-full border-2 border-gray-300 flex items-center justify-center font-semibold step-number text-lg">1</div>
                    <span class="text-sm mt-2 text-gray-600 step-label font-medium">Basic Info</span>
                </div>
                <div class="progress-step flex flex-col items-center w-1/3">
                    <div class="w-12 h-12 rounded-full border-2 border-gray-300 flex items-center justify-center font-semibold step-number text-lg">2</div>
                    <span class="text-sm mt-2 text-gray-600 step-label font-medium">EIN Info</span>
                </div>
                <div class="progress-step flex flex-col items-center w-1/3">
                    <div class="w-12 h-12 rounded-full border-2 border-gray-300 flex items-center justify-center font-semibold step-number text-lg">3</div>
                    <span class="text-sm mt-2 text-gray-600 step-label font-medium">Review</span>
                </div>
            </div>
        </div>

        <form id="a2p-form" class="p-6" action="https://n8n-a2p.onrender.com/webhook/a2p-register" method="POST">
            <!-- Step 1: Basic Information -->
            <div class="form-step active" data-step="1" style="display: block;">
                <div class="bg-blue-50 p-4 rounded-lg mb-6">
                    <h2 class="text-xl font-semibold mb-2 text-gray-800">What is A2P Messaging?</h2>
                    <p class="text-gray-600 mb-4">
                        A2P (Application-to-Person) messaging is a type of SMS communication where messages are sent from an application to a mobile user. This is commonly used for:
                    </p>
                    <ul class="list-disc list-inside text-gray-600 mb-4">
                        <li>Appointment reminders</li>
                        <li>Order confirmations</li>
                        <li>Two-factor authentication</li>
                        <li>Marketing campaigns</li>
                        <li>Customer service notifications</li>
                    </ul>
                    <p class="text-gray-600">
                        To get started with A2P messaging, we need some basic information about you and your business.
                    </p>
                </div>
                <div class="space-y-4">
                    <div>
                        <label for="fullName" class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
                        <input type="text" id="fullName" name="fullName" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Enter your full name" required>
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                        <input type="email" id="email" name="email" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Enter your email" required>
                    </div>
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone *</label>
                        <input type="text" id="phone" name="phone" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Enter your phone number" required>
                    </div>
                </div>
                <div class="mt-6">
                    <button type="button" onclick="validateAndNext(1)" class="btn-next px-6 py-2 rounded-lg font-medium text-white bg-blue-600 hover:bg-blue-700 transition duration-200">
                        Next <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 2: EIN Information -->
            <div class="form-step" data-step="2" style="display: none;">
                <div class="bg-blue-50 p-4 rounded-lg mb-6">
                    <h2 class="text-xl font-semibold mb-2 text-gray-800">Why Do We Need Your EIN?</h2>
                    <p class="text-gray-600 mb-4">
                        The Federal Communications Commission (FCC) requires all businesses sending A2P messages to register with their EIN. This helps:
                    </p>
                    <ul class="list-disc list-inside text-gray-600 mb-4">
                        <li>Verify your business identity</li>
                        <li>Prevent spam and fraud</li>
                        <li>Ensure message deliverability</li>
                        <li>Maintain compliance with regulations</li>
                    </ul>
                    <p class="text-gray-600">
                        Your EIN (Employer Identification Number) is a unique identifier for your business, similar to a social security number for individuals.
                    </p>
                </div>
                <div class="mb-6">
                    <p class="text-blue-600 mb-2">If you don't have an EIN yet, you can get one for free in under 15 minutes.</p>
                    <a href="https://sa.www4.irs.gov/modiein/individual/index.jsp" target="_blank" class="inline-flex items-center text-blue-600 hover:text-blue-800">
                        <i class="fas fa-external-link-alt mr-2"></i>Apply for your EIN
                    </a>
                </div>
                <div class="mb-6">
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h3 class="text-sm font-medium text-gray-700 mb-2">CP575 Form Reference</h3>
                        <img src="https://storage.googleapis.com/msgsndr/C4EL78WQvWpqMgSsv2kE/media/67f80866d5463c2ac79b6d55.png" alt="CP575 Form Image" class="w-full max-w-md mx-auto rounded shadow-sm" />
                    </div>
                </div>
                
                <!-- Important CP575 Warning -->
                <div class="mb-4 p-3 bg-yellow-50 border-l-4 border-yellow-500 text-yellow-700">
                    <p class="font-medium">IMPORTANT:</p>
                    <p>Please enter all business information EXACTLY as it appears on your CP575 form. Any discrepancies may cause your A2P registration to be rejected.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="ein" class="block text-sm font-medium text-gray-700 mb-1">EIN *</label>
                        <input type="text" id="ein" name="ein" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Enter your EIN" required>
                    </div>
<!-- Removed duplicate HTML structure -->
    
      
      // Set up auth state change listener
      window.supabase.auth.onAuthStateChange((event, session) => {
        console.log('Auth state changed:', event, session ? 'User logged in' : 'No user');
        if (event === 'SIGNED_IN') {
          // User has logged in, show dashboard
          const loginSection = document.getElementById('login-section');
          const dashboardSection = document.getElementById('dashboard-section');
          if (loginSection) loginSection.style.display = 'none';
          if (dashboardSection) dashboardSection.style.display = 'block';
          
          // Set current user email
          if (session && session.user) {
            window.currentUserEmail = session.user.email;
            updateUserNameDisplay();
          }
        } else if (event === 'SIGNED_OUT') {
          // User has logged out, show login section
          const loginSection = document.getElementById('login-section');
          const dashboardSection = document.getElementById('dashboard-section');
          if (loginSection) loginSection.style.display = 'flex';
          if (dashboardSection) dashboardSection.style.display = 'none';
          
          // Clear current user email
          currentUserEmail = null;
        }
      });
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script>
        // Initialize global variables at the top level
        window.urlParams = new URLSearchParams(window.location.search);
        window.currentUserEmail = null;
        window.isPageLoaded = false;
        window.currentInProgressStep = null;

        // Function to capitalize first letter of each word
        function capitalizeName(name) {
            return name.split(' ').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
            ).join(' ');
        }

        // Function to handle logout
        async function handleLogout() {
            try {
                const { error } = await window.supabase.auth.signOut();
                if (error) throw error;
                window.location.href = '/'; // Redirect to home page after logout
            } catch (error) {
                console.error('Error logging out:', error.message);
                alert('There was an error logging out. Please try again.');
            }
        }

        // Add event listener for logout button
        document.addEventListener('DOMContentLoaded', function() {
            const logoutButton = document.getElementById('logout-button');
            if (logoutButton) {
                logoutButton.addEventListener('click', handleLogout);
            }
            
            // Check authentication state and show the correct section
            // checkAuthState(); // <-- Commented out this line
        });
        
        // Function to check authentication state and show appropriate section
        async function checkAuthState() {
            try {
                const { data: { user } } = await window.supabase.auth.getUser();
                const loginSection = document.getElementById('login-section');
                const dashboardSection = document.getElementById('dashboard-section');
                
                if (user) {
                    // User is logged in, show dashboard
                    console.log('User is logged in:', user.email);
                    if (loginSection) loginSection.style.display = 'none';
                    if (dashboardSection) dashboardSection.style.display = 'block';
                    
                    // Set currentUserEmail for other parts of the application
                    window.currentUserEmail = user.email;
                    
                    // Update user name display
                    updateUserNameDisplay();

                    // Load and apply the saved onboarding status from Supabase
                    await loadAndApplyOnboardingStatus(); 

                } else {
                    // User is not logged in, show login section
                    console.log('User is not logged in');
                    if (loginSection) loginSection.style.display = 'flex';
                    if (dashboardSection) dashboardSection.style.display = 'none';
                }
            } catch (error) {
                console.error('Error checking auth state:', error);
                // Default to showing login section on error
                const loginSection = document.getElementById('login-section');
                const dashboardSection = document.getElementById('dashboard-section');
                if (loginSection) loginSection.style.display = 'flex';
                if (dashboardSection) dashboardSection.style.display = 'none';
            }
        }

        // Simple direct toggle function for the Learn More button
        function toggleLearnMore() {
            var content = document.getElementById('learn-more-content');
            var icon = document.getElementById('learn-more-icon');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.add('transform', 'rotate-180');
            } else {
                content.classList.add('hidden');
                icon.classList.remove('transform', 'rotate-180');
            }
        }

        // Function to update the UI of a specific onboarding step card
        function updateStepUICard(cardId, statusId, statusValue) {
            console.log(`Updating UI for ${cardId} to status: ${statusValue}`);
            const stepCard = document.getElementById(cardId);
            const statusSpan = document.getElementById(statusId);
            const completeIcon = stepCard?.querySelector('.complete-icon'); // Assuming a checkmark icon exists

            if (!stepCard || !statusSpan) {
                console.warn(`Could not find elements for card ${cardId} or status ${statusId}`);
                return;
            }

            // Reset classes first
            stepCard.classList.remove('not-started', 'in-progress', 'completed', 'completed-step');
            statusSpan.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium'; // Reset base class
            statusSpan.innerHTML = ''; // Clear previous content (like dots)

            // Apply new classes and text based on status
            switch (statusValue) {
                case 'Completed':
                    stepCard.classList.add('completed', 'completed-step');
                    statusSpan.classList.add('completed-status'); // Use the specific completed class
                    statusSpan.textContent = 'Completed';
                    // Add green dot (or checkmark, adjust as needed)
                    const greenDot = document.createElement('span');
                    greenDot.className = 'h-2 w-2 mr-1 rounded-full bg-green-500'; // Example dot
                    statusSpan.prepend(greenDot);
                    if (completeIcon) completeIcon.classList.remove('hidden');
                    break;
                case 'In Progress':
                    stepCard.classList.add('in-progress');
                    statusSpan.classList.add('bg-blue-100', 'text-blue-800');
                    statusSpan.textContent = 'In Progress';
                     const blueDot = document.createElement('span');
                    blueDot.className = 'h-2 w-2 mr-1 rounded-full bg-blue-500';
                    statusSpan.prepend(blueDot);
                    if (completeIcon) completeIcon.classList.add('hidden');
                    break;
                case 'Not Started':
                default:
                    stepCard.classList.add('not-started');
                    statusSpan.classList.add('bg-gray-100', 'text-gray-800');
                    statusSpan.textContent = 'Not Started';
                    const grayDot = document.createElement('span');
                    grayDot.className = 'h-2 w-2 mr-1 rounded-full bg-gray-400';
                    statusSpan.prepend(grayDot);
                    if (completeIcon) completeIcon.classList.add('hidden');
                    break;
            }
        }

        // Function to load status from Supabase and update UI
        async function loadAndApplyOnboardingStatus() {
            console.log('Loading onboarding status from Supabase...');
            const { data: { user } } = await window.supabaseClient.auth.getUser();

            if (!user) {
                console.log('User not logged in, cannot load status.');
                return;
            }

            try {
                const { data: onboardingData, error } = await window.supabaseClient
                    .from('new_client_onboarding')
                    .select('guide_status, verification_status, authorization_status, slack_status, domain_status, a2p_status, social_status') // Added authorization_status back
                    .eq('user_id', user.id)
                    .maybeSingle(); // Use maybeSingle() in case the row doesn't exist yet

                if (error) {
                    console.error('Error fetching onboarding status:', error);
                    return;
                }

                if (!onboardingData) {
                    console.log('No onboarding record found for this user yet.');
                    // Optionally reset all steps to Not Started if needed
                    // updateStepUICard('guide-card', 'guide-status', 'Not Started');
                    // ... etc for all steps
                    return;
                }

                console.log('Onboarding data loaded:', onboardingData);

                // Map Supabase columns to Card and Status IDs
                const stepMapping = {
                    guide_status: { cardId: 'guide-card', statusId: 'guide-status' },
                    verification_status: { cardId: 'verification-card', statusId: 'verification-status' },
                    authorization_status: { cardId: 'authorization-card', statusId: 'authorization-status' }, // Uncommented authorization mapping
                    slack_status: { cardId: 'slack-card', statusId: 'slack-status' },
                    domain_status: { cardId: 'domain-card', statusId: 'domain-status' },
                    a2p_status: { cardId: 'a2p-card', statusId: 'a2p-form-status' }, // Note the different statusId
                    social_status: { cardId: 'social-card', statusId: 'social-card-status' },
                };

                // Apply statuses from data
                for (const [statusColumn, ids] of Object.entries(stepMapping)) {
                    const statusValue = onboardingData[statusColumn] || 'Not Started'; // Default to Not Started if column is null/undefined
                    updateStepUICard(ids.cardId, ids.statusId, statusValue);
                }

            } catch (err) {
                console.error('Unexpected error in loadAndApplyOnboardingStatus:', err);
            }
        }
    </script>
    <style>
        .document-card {
            transition: all 0.2s ease;
        }
        .document-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .progress-bar {
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            transition: width 0.3s ease;
        }
        .quiz-complete-top {
            display: none;
        }
        .quiz-complete-button {
            display: none !important;
        }

        /* Fixed Signature pad styles */
        #signature-pad {
            touch-action: none;
            background-color: #fff;
        }

        #clear-signature {
            position: absolute;
            bottom: 8px;
            right: 8px;
            z-index: 2;
            background-color: white;
            border: 1px solid #e2e8f0;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        #clear-signature:hover {
            background-color: #f7fafc;
            border-color: #cbd5e0;
        }
        
        /* Required styles for Learn More button */
        .hidden {
            display: none !important;
        }
        .transform.rotate-180 {
            transform: rotate(180deg);
        }

        /* Add/replace the following CSS in the <style> section for the new visual style */
        .step-card {
            transition: all 0.3s ease;
        }
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .step-card.completed {
            border-left: 4px solid #22c55e; /* Tailwind's green-500 */
            box-shadow: 0 0 0 2px #22c55e33; /* subtle green glow for emphasis */
        }
        .step-card.in-progress {
            border-left: 4px solid #FBBF24;
        }
        .step-card.not-started {
            border-left: 4px solid #E5E7EB;
        }
        .step-number {
            height: 32px;
            width: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        .progress-line {
            position: absolute;
            left: 16px;
            top: 32px;
            bottom: 0;
            width: 2px;
            background-color: #E5E7EB;
            z-index: 0;
        }
        .step-card.completed .step-number {
            background-color: #10B981;
            color: white;
        }
        .step-card.in-progress .step-number {
            background-color: #FBBF24;
            color: white;
        }
        .step-card.not-started .step-number {
            background-color: #E5E7EB;
            color: #4B5563;
        }
        .btn-sleek {
            background: linear-gradient(to right, #3B82F6, #2563EB);
            border: none;
            padding: 0.5rem 1.25rem;
            border-radius: 0.375rem;
            font-weight: 500;
            letter-spacing: 0.025em;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2), 0 2px 4px -1px rgba(37, 99, 235, 0.1);
            transition: all 0.2s ease;
        }
        .btn-sleek:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 10px -1px rgba(37, 99, 235, 0.25), 0 3px 6px -1px rgba(37, 99, 235, 0.15);
            background: linear-gradient(to right, #2563EB, #1D4ED8);
        }
        .btn-sleek:focus {
            outline: none;
            ring-color: rgba(37, 99, 235, 0.5);
        }
        @media (max-width: 768px) {
            .step-card {
                padding-left: 3.5rem !important;
            }
            .card-content {
                flex-direction: column;
                align-items: flex-start !important;
            }
            .card-content button {
                margin-top: 1rem;
                align-self: flex-start;
            }
        }
        /* Add verification modal styles */
        .signature-pad {
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .signature-pad canvas {
            width: 100%;
            height: 200px;
        }
        .verification-form {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        .verification-form .form-label {
            font-weight: 500;
            color: #495057;
        }
        .verification-form .form-control {
            border-radius: 4px;
            border: 1px solid #ced4da;
            padding: 8px 12px;
        }
        .verification-form .form-control:focus {
            border-color: #80bdff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }
        .verification-form .btn {
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 500;
        }
        .verification-form .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }
        .verification-form .btn-secondary {
            background-color: #6c757d;
            border-color: #6c757d;
        }
        .verification-form .form-check {
            margin-top: 20px;
        }
        .verification-form .form-check-input {
            margin-top: 0.3rem;
        }
        .verification-form .form-check-label {
            color: #495057;
        }

        /* Add more prominent completed status styles */
        .completed-step {
          background-color: #f0fdf4 !important; /* Light green background */
          border: 2px solid #22c55e !important; /* Thicker green border */
          box-shadow: 0 4px 10px rgba(34, 197, 94, 0.3) !important;
          transition: all 0.3s ease-in-out !important;
          position: relative;
          overflow: visible;
        }

        .completed-step:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 15px rgba(34, 197, 94, 0.4) !important;
        }

        .completed-step::before {
          content: '';
          position: absolute;
          left: 0;
          top: 0;
          height: 100%;
          width: 6px;
          background-color: #16a34a;
        }

        .completed-step .step-number {
          background-color: #22c55e !important;
          color: white !important;
          border: 2px solid #15803d !important;
          transition: all 0.3s ease !important;
          transform: scale(1.1);
        }

        .completed-status {
          background-color: #dcfce7 !important; /* Lighter green background */
          color: #15803d !important; /* Darker green text */
          font-weight: 600 !important;
          padding: 4px 10px !important;
          border: 1px solid #22c55e !important;
          border-radius: 20px !important;
          display: inline-flex !important;
          align-items: center !important;
          box-shadow: 0 2px 4px rgba(34, 197, 94, 0.2) !important;
          animation: pulseGreen 2s infinite;
        }

        .completed-status span {
          background-color: #22c55e !important;
          width: 8px !important;
          height: 8px !important;
        }

        .completed-indicator {
          position: absolute;
          top: -8px;
          right: -8px;
          background-color: #16a34a;
          color: white;
          border-radius: 50%;
          width: 28px;
          height: 28px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 14px;
          border: 2px solid white;
          box-shadow: 0 2px 4px rgba(0,0,0,0.2);
          z-index: 10;
          animation: bounceIn 0.5s ease-out;
        }

        /* Add confetti-like background to completed steps */
        .completed-step::after {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-image: 
            radial-gradient(circle, #22c55e 1px, transparent 1px),
            radial-gradient(circle, #86efac 1px, transparent 1px);
          background-size: 20px 20px;
          background-position: 0 0, 10px 10px;
          opacity: 0.05;
          pointer-events: none;
        }

        /* Change the verify button style for completed steps */
        .completed-step .btn-sleek {
          background-color: #16a34a !important;
          border-color: #15803d !important;
          transition: all 0.3s ease !important;
        }

        .completed-step .btn-sleek:hover {
          background-color: #15803d !important;
          transform: translateY(-1px);
        }

        /* Add animations */
        @keyframes pulseGreen {
          0% {
            box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
          }
          70% {
            box-shadow: 0 0 0 6px rgba(34, 197, 94, 0);
          }
          100% {
            box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
          }
        }

        @keyframes bounceIn {
          0% {
            opacity: 0;
            transform: scale(0.3);
          }
          50% {
            opacity: 1;
            transform: scale(1.1);
          }
          70% {
            transform: scale(0.9);
          }
          100% {
            transform: scale(1);
          }
        }

        /* Add a special label for completed steps */
        .completed-label {
          position: absolute;
          right: 10px;
          top: 10px;
          background-color: #16a34a;
          color: white;
          padding: 2px 8px;
          border-radius: 4px;
          font-size: 12px;
          font-weight: bold;
          display: flex;
          align-items: center;
          gap: 4px;
          z-index: 5;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Add prominently styled completed text */
        .completed-text {
          color: #15803d !important;
          font-weight: 700 !important;
          text-transform: uppercase !important;
          letter-spacing: 0.05em !important;
          font-size: 1.1em !important;
          text-shadow: 0 1px 0 rgba(255,255,255,0.8) !important;
          position: relative;
          display: inline-block;
        }

        .completed-text::after {
          content: '';
          position: absolute;
          bottom: -2px;
          left: 0;
          width: 100%;
          height: 2px;
          background-color: #22c55e;
        }

        /* Add a prominent banner for completed verification modal */
        .verified-banner {
          background: linear-gradient(135deg, #16a34a, #22c55e);
          color: white;
          text-align: center;
          padding: 10px;
          margin: -16px -16px 16px -16px;
          border-radius: 8px 8px 0 0;
          font-weight: 600;
          letter-spacing: 0.05em;
          text-transform: uppercase;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
        }

        /* Style the main step status to be more visible */
        #verification-status.completed-status,
        #guide-status.completed-status,
        #slack-status.completed-status,
        #domain-status.completed-status,
        #a2p-form-status.completed-status,
        #social-card-status.completed-status {
          font-size: 0.875rem !important;
          padding: 4px 12px !important;
          letter-spacing: 0.05em !important;
        }
    </style>
    <link rel="stylesheet" href="../../mobile_optimization.css">
    <link rel="stylesheet" href="../../chat_widget_improvements.css">
    <link rel="stylesheet" href="../../text_spacing.css">
    <link rel="stylesheet" href="../../improved_hamburger_fix.css">
</head>
<body class="bg-gray-100 min-h-screen m-0 p-0">
    <!-- Debug Tools - VERY OBVIOUS -->
    <!-- Removing debug toolbar from production site -->

    <script>
    // Debug functions
    </script>

    <!-- Navigation Bar -->
    <nav class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <!-- <h1 class="text-xl font-bold text-gray-800">The Connector Group</h1> --> <!-- REMOVED THIS LINE -->
                            </div>
                        </div>
                <div class="flex items-center">
                    <div class="flex items-center space-x-4">
                        <span id="user-name" class="text-gray-700 font-medium"></span>
                        <button id="logout-button" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200">
                            Logout
                    </button>
        </div>
        </div>
                                    </div>
        </div>
    </nav>
    <div id="login-section"
         class="fixed inset-0 min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100 px-4 py-8"
         style="display:flex;" >
      <div class="w-full max-w-md md:w-auto bg-white rounded-2xl shadow-xl p-8 md:p-10 flex flex-col items-center">
        <!-- Universal Avatar Icon -->
        <div class="mb-6">
          <div class="mx-auto mb-4 text-center text-blue-600 font-bold text-2xl">TurnClicksToClients.com</div>
        </div>
        <h2 class="text-2xl font-bold text-gray-800 mb-2 text-center">Onboarding Portal</h2>
        <p class="text-gray-500 mb-6 text-center">Sign up or log in to access your onboarding portal</p>
        <!-- Tabs for Sign Up / Login -->
        <div class="flex w-full mb-6">
          <button id="tab-signup" type="button" class="flex-1 py-2 text-center rounded-l-lg border border-blue-600 text-blue-600 font-semibold bg-white hover:bg-blue-100 focus:outline-none">Sign Up</button>
          <button id="tab-login" type="button" class="flex-1 py-2 text-center rounded-r-lg border border-blue-600 text-blue-600 font-semibold bg-blue-50 hover:bg-blue-100 focus:outline-none">Login</button>
                                    </div>
        <!-- Sign Up Form -->
        <form id="signup-form" class="w-full space-y-4" style="display: block;">
                <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
            <input type="text" id="signup-first-name" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="First name">
                                </div>
                <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
            <input type="text" id="signup-last-name" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Last name">
                            </div>
                <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
            <input type="tel" id="signup-phone" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Phone number">
                        </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Business Name</label>
            <input type="text" id="signup-business-name" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Business name">
                    </div>
                        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
            <input type="text" id="signup-username" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Choose a username">
                        </div>
                        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input type="email" id="signup-email" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="you@email.com">
                        </div>
                        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
            <input type="password" id="signup-password" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Create a password">
                        </div>
                        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
            <input type="password" id="signup-confirm-password" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Confirm your password">
                        </div>
          <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg shadow transition duration-200">Sign Up</button>
        </form>
        <!-- Login Form -->
        <form id="login-form" class="w-full space-y-4" style="display: none;">
                        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email or Username</label>
            <input type="text" id="login-email" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Email or username">
                        </div>
                        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
            <input type="password" id="login-password" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Your password">
                        </div>
          <div class="flex justify-end -mt-2 mb-2">
            <a href="#" class="text-blue-600 text-sm hover:underline focus:outline-none">Forgot password?</a>
                    </div>
          <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg shadow transition duration-200">Login</button>
        </form>
        <!-- Reset Password Form (hidden by default) -->
        <form id="reset-form" class="w-full space-y-4" style="display: none;">
                        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input type="email" id="reset-email" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Enter your email address">
                        </div>
          <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg shadow transition duration-200">Send Reset Link</button>
          <div class="flex justify-end">
            <a href="#" id="back-to-login" class="text-blue-600 text-sm hover:underline focus:outline-none">Back to Login</a>
                        </div>
        </form>
        <!-- Reset Confirmation Message (hidden by default) -->
        <div id="reset-confirmation" class="w-full text-center text-green-600 text-sm py-4" style="display: none;">
          If an account with that email exists, a password reset link has been sent.
          <div class="mt-4">
            <a href="#" id="reset-confirmation-back" class="text-blue-600 hover:underline">Back to Login</a>
                    </div>
                    </div>
        <div id="login-error" class="text-red-600 mt-4 text-sm w-full text-center"></div>
        <div class="mt-8 text-xs text-gray-400 text-center w-full">
          &copy; 2024 The Connector Group. All rights reserved.copy; 2024 TurnClicksToClients.com. All rights reserved.copy; 2024 TurnClicksToClients.com. All rights reserved.copy; 2024 TurnClicksToClients.com. All rights reserved.
                </div>
                    </div>
                            </div>
    <div id="dashboard-section" style="display:none;">
      <!-- Header -->
      <header class="bg-white shadow">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex justify-between items-center">
            <h1 id="portal-title" class="text-2xl font-bold text-gray-800">TurnClicksToClients.com Onboarding Portal</h1>
            <div class="flex items-center space-x-4">
              <span class="text-gray-600" id="client-name"></span>
                            </div>
                            </div>
                            </div>
      </header>
      <!-- Main Content -->
      <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Welcome Banner -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8 border-l-4 border-blue-500">
          <div class="flex items-start flex-wrap md:flex-nowrap">
            <div class="flex-shrink-0 text-blue-500 mb-3 md:mb-0">
              <i class="fas fa-info-circle text-2xl"></i>
                            </div>
            <div class="ml-0 md:ml-4 w-full">
              <h2 class="text-xl font-semibold text-gray-800">Welcome to Your Onboarding Portal</h2>
              <p class="text-gray-600 mt-1">
                Complete the steps below to set up your account with TurnClicksToClients.com. We recommend following these steps in order.
              </p>
              <p class="text-sm text-gray-500 mt-2">
                <i class="fas fa-save mr-2"></i>
                Don't worry - your progress is automatically saved. You can safely log out or leave the portal and continue where you left off when you return.
                        </p>
                            </div>
                            </div>
                            </div>
        <!-- Progress Overview -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
          <h2 class="text-xl font-semibold text-gray-800 mb-4">Your Onboarding Journey</h2>
          <div class="space-y-4 relative">
            <!-- Step 1: Getting Started Guide -->
            <div id="guide-card" class="step-card not-started p-6 rounded-lg border bg-white relative pl-16">
              <div class="progress-line"></div>
              <div class="step-number absolute left-4 top-6">1</div>
              <div class="flex justify-between items-center card-content">
                <div>
                  <h3 class="text-lg font-medium text-gray-900">Getting Started Guide</h3>
                  <p class="text-gray-500 mt-1">Learn how TurnClicksToClients.com will help elevate your business</p>
                  <div class="mt-2">
                    <span id="guide-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      <span class="h-2 w-2 mr-1 rounded-full bg-gray-400"></span>
                      Not Started
                    </span>
                    <span class="text-sm text-gray-500 ml-2">Estimated time: 5 min</span>
                        </div>
                  <div class="complete-icon hidden absolute right-5 top-2">
                    <i class="fas fa-check-circle text-green-500 text-xl"></i>
                    </div>
                    </div>
                <button onclick="showGuideModal()" class="btn-sleek inline-flex items-center text-sm font-medium text-white">
                  <i class="fas fa-book-reader mr-2"></i>
                  Read Guide
                        </button>
                    </div>
                </div>
            
            <!-- Step 2: Information Verification -->
            <div id="verification-card" class="step-card not-started p-6 rounded-lg border bg-white relative pl-16">
              <div class="progress-line"></div>
              <div class="step-number absolute left-4 top-6">2</div>
              <div class="flex justify-between items-center card-content">
                <div>
                  <h3 class="text-lg font-medium text-gray-900">Information Verification</h3>
                  <p class="text-gray-500 mt-1">Verify your account information to get started</p>
                  <div class="mt-2">
                    <span id="verification-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      <span class="h-2 w-2 mr-1 rounded-full bg-gray-400"></span>
                      Not Started
                    </span>
                    <span class="text-sm text-gray-500 ml-2">Estimated time: 2 min</span>
        </div>
                  <div class="complete-icon hidden absolute right-5 top-2">
                    <i class="fas fa-check-circle text-green-500 text-xl"></i>
    </div>
                </div>
                <button onclick="showVerificationModal()" class="btn-sleek inline-flex items-center text-sm font-medium text-white">
                  <i class="fas fa-check-circle mr-2"></i>
                  Verify Now
                    </button>
                </div>
            </div>

            <!-- Step 3: Authorization Form (New) -->
            <div id="authorization-card" class="step-card not-started p-6 rounded-lg border bg-white relative pl-16">
              <div class="progress-line"></div>
              <div class="step-number absolute left-4 top-6">3</div>
              <div class="flex justify-between items-center card-content">
                        <div>
                  <h3 class="text-lg font-medium text-gray-900">Authorization Form</h3>
                  <p class="text-gray-500 mt-1">Complete the credit card authorization form</p>
                  <div class="mt-2">
                    <span id="authorization-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      <span class="h-2 w-2 mr-1 rounded-full bg-gray-400"></span>
                      Not Started
                    </span>
                    <span class="text-sm text-gray-500 ml-2">Estimated time: 30 seconds</span>
                        </div>
                  <div class="complete-icon hidden absolute right-5 top-2">
                    <i class="fas fa-check-circle text-green-500 text-xl"></i>
                        </div>
                </div>
                <button onclick="showAuthorizationModal()" class="btn-sleek inline-flex items-center text-sm font-medium text-white">
                  <i class="fas fa-credit-card mr-2"></i>
                  Authorize Now
                </button>
                    </div>
                </div>

            <!-- Step 4: Join Slack Support Group -->
            <div id="slack-card" class="step-card not-started p-6 rounded-lg border bg-white relative pl-16">
              <div class="progress-line"></div>
              <div class="step-number absolute left-4 top-6">4</div>
              <div class="flex justify-between items-center card-content">
                        <div>
                  <h3 class="text-lg font-medium text-gray-900">Join Support Group</h3>
                  <p class="text-gray-500 mt-1">Connect with your dedicated team via Slack for personalized support</p>
                  <div class="mt-2">
                    <span id="slack-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      <span class="h-2 w-2 mr-1 rounded-full bg-gray-400"></span>
                      Not Started
                    </span>
                    <span class="text-sm text-gray-500 ml-2">Estimated time: 30 seconds</span>
                        </div>
                        <div class="complete-icon hidden absolute right-5 top-2">
                          <i class="fas fa-check-circle text-green-500 text-xl"></i>
                        </div>
                    </div>
                <button onclick="showSlackModal()" class="btn-sleek inline-flex items-center text-sm font-medium text-white">
                  <i class="fab fa-slack mr-2"></i>
                  Join Group
                        </button>
                </div>
                        </div>
            <!-- Step 5: Campaign Domain Selection -->
            <div id="domain-card" class="step-card not-started p-6 rounded-lg border bg-white relative pl-16">
              <div class="progress-line"></div>
              <div class="step-number absolute left-4 top-6">5</div>
              <div class="flex justify-between items-center card-content">
                        <div>
                  <h3 class="text-lg font-medium text-gray-900">Select Campaign Domain</h3>
                  <p class="text-gray-500 mt-1">Choose a domain name for your marketing campaigns</p>
                  <div class="mt-2">
                    <span id="domain-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      <span class="h-2 w-2 mr-1 rounded-full bg-gray-400"></span>
                      Not Started
                    </span>
                    <span class="text-sm text-gray-500 ml-2">Estimated time: 5 min</span>
                        </div>
                        <div class="complete-icon hidden absolute right-5 top-2">
                          <i class="fas fa-check-circle text-green-500 text-xl"></i>
                        </div>
                        </div>
                <button onclick="showDomainModal()" class="btn-sleek inline-flex items-center text-sm font-medium text-white">
                  <i class="fas fa-globe mr-2"></i>
                  Select Domain
                        </button>
                        </div>
                    </div>
            <!-- Step 6: A2P Registration -->
            <div id="a2p-card" class="step-card not-started p-6 rounded-lg border bg-white relative pl-16">
              <div class="progress-line"></div>
              <div class="step-number absolute left-4 top-6">6</div>
              <div class="flex justify-between items-center card-content">
                        <div>
                  <h3 class="text-lg font-medium text-gray-900">A2P Registration</h3>
                  <p class="text-gray-500 mt-1">Complete the A2P registration to get started with SMS marketing</p>
                  <div class="mt-2">
                    <span id="a2p-form-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      <span class="h-2 w-2 mr-1 rounded-full bg-gray-400"></span>
                      Not Started
                    </span>
                    <span class="text-sm text-gray-500 ml-2">Estimated time: 10 min</span>
                        </div>
                        <div class="complete-icon hidden absolute right-5 top-2">
                          <i class="fas fa-check-circle text-green-500 text-xl"></i>
                        </div>
                        </div>
                <button onclick="showA2PModal()" class="btn-sleek inline-flex items-center text-sm font-medium text-white">
                  <i class="fas fa-file-alt mr-2"></i>
                  Start Registration
                        </button>
                        </div>
                    </div>
            <!-- Step 7: Social Media Setup -->
            <div id="social-card" class="step-card not-started p-6 rounded-lg border bg-white relative pl-16">
              <div class="step-number absolute left-4 top-6">7</div>
              <div class="flex justify-between items-center card-content">
                        <div>
                  <h3 class="text-lg font-medium text-gray-900">Social Media Setup</h3>
                  <p class="text-gray-500 mt-1">Connect your social media accounts for seamless campaign management</p>
                  <div class="mt-2">
                    <span id="social-card-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      <span class="h-2 w-2 mr-1 rounded-full bg-gray-400"></span>
                      Not Started
                    </span>
                    <span class="text-sm text-gray-500 ml-2">Estimated time: 5 min</span>
                </div>
                        <div class="complete-icon hidden absolute right-5 top-2">
                          <i class="fas fa-check-circle text-green-500 text-xl"></i>
                    </div>
                    </div>
                <button onclick="showSocialModal()" class="btn-sleek inline-flex items-center text-sm font-medium text-white">
                  <i class="fas fa-share-alt mr-2"></i>
                  Connect Accounts
                        </button>
                    </div>
                    </div>
                    </div>
                    </div>

          
                </div>

        <!-- Support Card -->
        <div class="bg-white rounded-lg shadow p-6 flex flex-col md:flex-row items-center justify-between border border-blue-100">
          <div class="flex items-center mb-4 md:mb-0">
            <div class="flex-shrink-0">
              <i class="fas fa-info-circle text-blue-500 text-2xl mr-4"></i>
                        </div>
                        <div>
              <h3 class="text-lg font-semibold text-gray-800 mb-1">Need Assistance?</h3>
              <p class="text-gray-600 text-sm">If you have any questions or need help, our support team is here for you. Reach out anytime and we'll respond as soon as possible.</p>
                        </div>
                    </div>
          <button class="btn-sleek flex items-center px-6 py-2 text-white font-semibold rounded-lg shadow hover:bg-blue-700 transition duration-200" onclick="showHelpModal(event)">
            <i class="fas fa-envelope mr-2"></i>
            Send Us An Instant Message
          </button>
                    </div>
      </main>
                </div>
                <script>
      // Tab switching logic
                    document.addEventListener('DOMContentLoaded', function() {
        const tabSignup = document.getElementById('tab-signup');
        const tabLogin = document.getElementById('tab-login');
        const signupForm = document.getElementById('signup-form');
        const loginForm = document.getElementById('login-form');
        const resetForm = document.getElementById('reset-form');
        const resetConfirmation = document.getElementById('reset-confirmation');
        const forgotPasswordLink = loginForm.querySelector('a[href="#"]');
        const backToLogin = document.getElementById('back-to-login');
        const resetConfirmationBack = document.getElementById('reset-confirmation-back');
        const loginError = document.getElementById('login-error');

        function activateTab(tab) {
          resetForm.style.display = 'none';
          resetConfirmation.style.display = 'none';
          loginError.textContent = '';

          // Define active/inactive classes (Tailwind)
          // Active: Blue BG, White Text
          const activeClasses = ['bg-blue-600', 'text-white', 'font-semibold', 'hover:bg-blue-700'];
          // Inactive: White BG, Blue Text
          const inactiveClasses = ['bg-white', 'text-blue-600', 'font-semibold', 'hover:bg-blue-100'];

          // Reset both tabs to inactive state first
          tabLogin.classList.remove(...activeClasses); // Remove active classes from Login
          tabLogin.classList.add(...inactiveClasses);    // Add inactive classes to Login
          tabSignup.classList.remove(...activeClasses); // Remove active classes from Signup
          tabSignup.classList.add(...inactiveClasses);    // Add inactive classes to Signup

          if (tab === 'signup') {
            // Activate Signup Tab
            tabSignup.classList.remove(...inactiveClasses); // Remove inactive classes
            tabSignup.classList.add(...activeClasses);      // Add active classes
            signupForm.style.display = 'block';
            loginForm.style.display = 'none';
          } else { // Login Tab
            // Activate Login Tab
            tabLogin.classList.remove(...inactiveClasses);  // Remove inactive classes
            tabLogin.classList.add(...activeClasses);       // Add active classes
            signupForm.style.display = 'none';
            loginForm.style.display = 'block';
          }
        }

        tabSignup.addEventListener('click', function() { activateTab('signup'); });
        tabLogin.addEventListener('click', function() { activateTab('login'); });

        // Set Login as the default active tab on initial load
        activateTab('login'); // Default remains 'login'

        // Forgot password link
        forgotPasswordLink.addEventListener('click', function(e) {
                            e.preventDefault();
          signupForm.style.display = 'none';
          loginForm.style.display = 'none';
          resetForm.style.display = 'block';
          resetConfirmation.style.display = 'none';
          loginError.textContent = '';
        });

        // Back to login from reset form
        backToLogin.addEventListener('click', function(e) {
                            e.preventDefault();
          resetForm.style.display = 'none';
          resetConfirmation.style.display = 'none';
          activateTab('login');
        });

        // Back to login from confirmation
        resetConfirmationBack.addEventListener('click', function(e) {
                            e.preventDefault();
          resetForm.style.display = 'none';
          resetConfirmation.style.display = 'none';
          activateTab('login');
        });

        // --- Supabase Auth Logic ---
        // Sign Up
        signupForm.addEventListener('submit', async function(e) {
                            e.preventDefault();
          loginError.textContent = '';
          const btn = signupForm.querySelector('button[type="submit"]');
          btn.disabled = true;
          btn.textContent = 'Signing Up...';
          const firstName = document.getElementById('signup-first-name').value.trim();
          const lastName = document.getElementById('signup-last-name').value.trim();
          const phone = document.getElementById('signup-phone').value.trim();
          const businessName = document.getElementById('signup-business-name').value.trim();
          const username = document.getElementById('signup-username').value.trim();
          const email = document.getElementById('signup-email').value.trim();
          const password = document.getElementById('signup-password').value;
          const confirmPassword = document.getElementById('signup-confirm-password').value;
          if (!firstName || !lastName || !phone || !businessName || !username || !email || !password || !confirmPassword) {
            loginError.textContent = 'Please fill in all fields.';
            btn.disabled = false;
            btn.textContent = 'Sign Up';
                                return;
                            }
          if (password !== confirmPassword) {
            loginError.textContent = 'Passwords do not match.';
            btn.disabled = false;
            btn.textContent = 'Sign Up';
                                return;
                            }
          try {
            const { data, error } = await window.supabase.auth.signUp({
              email,
              password,
              options: {
                data: {
                  username,
                  first_name: firstName,
                  last_name: lastName,
                  phone,
                  business_name: businessName
                }
              }
            });
                                if (error) {
              loginError.textContent = error.message || JSON.stringify(error);
            } else if (data && data.user) {
              loginError.textContent = 'Sign up successful! Please check your email to confirm your account.';
              signupForm.reset();
            } else {
              loginError.textContent = 'Unknown error. Please check your input and try again.';
            }
          } catch (err) {
            loginError.textContent = err.message || err.toString();
          }
          btn.disabled = false;
          btn.textContent = 'Sign Up';
        });

        // Login
        loginForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          loginError.textContent = '';
          const btn = loginForm.querySelector('button[type="submit"]');
          btn.disabled = true;
          btn.textContent = 'Logging In...';
          const emailOrUsername = document.getElementById('login-email').value.trim();
          const password = document.getElementById('login-password').value;
          let email = emailOrUsername;
          // If username, look up email in Supabase (optional, requires a 'profiles' table)
          if (emailOrUsername.includes('@')) {
            email = emailOrUsername;
          } else {
            // Try to fetch email by username from 'profiles' table
            try {
              const { data: profile, error: profileError } = await window.supabase
                .from('profiles')
                .select('email')
                .eq('username', emailOrUsername)
                .single();
              if (profile && profile.email) {
                email = profile.email;
              } else {
                loginError.textContent = 'No account found for that username.';
                btn.disabled = false;
                btn.textContent = 'Login';
                return;
              }
            } catch (err) {
              loginError.textContent = 'Error looking up username.';
              btn.disabled = false;
              btn.textContent = 'Login';
                            return;
                        }
          }
          try {
            const { data, error } = await window.supabase.auth.signInWithPassword({ email, password });
            if (error) {
              loginError.textContent = error.message;
            } else {
              loginError.textContent = 'Login successful!';
              
              // Manually show dashboard instead of reloading
              const loginSection = document.getElementById('login-section');
              const dashboardSection = document.getElementById('dashboard-section');
              
              if (loginSection) loginSection.style.display = 'none';
              if (dashboardSection) dashboardSection.style.display = 'block';
              
              // Set currentUserEmail for other parts of the application
              if (data.user) {
                currentUserEmail = data.user.email;
                // Update user name display
                updateUserNameDisplay();
              }
            }
          } catch (err) {
            loginError.textContent = 'An error occurred. Please try again.';
          }
          btn.disabled = false;
          btn.textContent = 'Login';
        });

        // Forgot Password
        resetForm.addEventListener('submit', async function(e) {
                            e.preventDefault();
          const btn = resetForm.querySelector('button[type="submit"]');
          btn.disabled = true;
          btn.textContent = 'Sending...';
          const email = document.getElementById('reset-email').value.trim();
          if (!email) {
            btn.disabled = false;
            btn.textContent = 'Send Reset Link';
                            return;
                        }
          try {
            const { data, error } = await window.supabase.auth.resetPasswordForEmail(email);
            if (error) {
              resetConfirmation.textContent = error.message;
            } else {
              resetConfirmation.textContent = 'If an account with that email exists, a password reset link has been sent.';
            }
          } catch (err) {
            resetConfirmation.textContent = 'An error occurred. Please try again.';
          }
          resetForm.style.display = 'none';
          resetConfirmation.style.display = 'block';
          btn.disabled = false;
          btn.textContent = 'Send Reset Link';
        });
      });
                </script>

    <!-- Getting Started Guide Modal -->
    <div id="guide-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50" style="display: none;">
        <div class="relative top-10 mx-auto p-5 border w-3/4 max-w-4xl shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white z-10 pb-4 border-b mb-4">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800" id="guide-title">TurnClicksToClients.com Welcome Guide</h3>
                    <button onclick="closeModal('guide-modal')" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <!-- Help Section -->
                <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                    <p class="text-sm text-yellow-800">
                        <i class="fas fa-info-circle mr-2"></i>
                        Please read through the instructions carefully before proceeding. Most questions can be answered by following the steps provided. If you still need assistance after trying the steps, our team can help. <button onclick="showHelpModal(event)" class="text-blue-600 hover:text-blue-800">Request assistance</button>
                    </p>
                </div>
            </div>
            
            <div class="space-y-6">
                <!-- Download Guide Section - Centered -->
                <div class="flex justify-center mb-8">
                    <div class="text-center">
                        <h4 class="text-2xl font-bold text-gray-800 mb-4">TurnClicksToClients.com Getting Started Guide</h4>
                        <p class="text-lg text-gray-600 mb-4">Click Here To View The Welcome Guide</p>
                        <button onclick="downloadGuide()" class="inline-flex items-center px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 text-lg">
                            <i class="fas fa-file-pdf mr-2"></i>
                            View Onboarding Guide
                        </button>
                    </div>
                </div>

                <!-- Rest of the content -->
                <div class="bg-white p-6 rounded-lg border">
                    <h4 class="text-lg font-semibold text-gray-800 mb-8">How to Complete This Onboarding Step</h4>
                    <div class="space-y-6">
                        <div class="bg-blue-50 border-l-4 border-blue-400 p-5 rounded">
                            <h5 class="text-base font-medium text-gray-800 mb-4">Complete These Actions:</h5>
                            <ol class="space-y-4 ml-2">
                                <li class="flex items-start">
                                    <div class="flex-shrink-0 h-6 w-6 rounded-full bg-blue-100 flex items-center justify-center mr-3 mt-0.5">
                                <span class="text-blue-600 font-medium">1</span>
                            </div>
                                    <div>
                                        <p class="text-sm text-gray-700"><span class="font-medium">View the Guide:</span> Click the "View Onboarding Guide" button at the top of this page to open the guide in a new tab.</p>
                                </div>
                                </li>
                                <li class="flex items-start">
                                    <div class="flex-shrink-0 h-6 w-6 rounded-full bg-blue-100 flex items-center justify-center mr-3 mt-0.5">
                                <span class="text-blue-600 font-medium">2</span>
                            </div>
                                    <div>
                                        <p class="text-sm text-gray-700"><span class="font-medium">Read Thoroughly:</span> Take the time to read and understand all the information in the guide.</p>
                                </div>
                                </li>
                                <li class="flex items-start">
                                    <div class="flex-shrink-0 h-6 w-6 rounded-full bg-blue-100 flex items-center justify-center mr-3 mt-0.5">
                                <span class="text-blue-600 font-medium">3</span>
                            </div>
                                    <div>
                                        <p class="text-sm text-gray-700"><span class="font-medium">Return to This Page:</span> After reading the guide, return to this page to continue your onboarding.</p>
                                </div>
                                </li>
                                <li class="flex items-start">
                                    <div class="flex-shrink-0 h-6 w-6 rounded-full bg-blue-100 flex items-center justify-center mr-3 mt-0.5">
                                <span class="text-blue-600 font-medium">4</span>
                            </div>
                                    <div>
                                        <p class="text-sm text-gray-700"><span class="font-medium">Complete the Quiz:</span> Answer the questions in the quiz section below to verify your understanding.</p>
                                </div>
                                </li>
                                <li class="flex items-start">
                                    <div class="flex-shrink-0 h-6 w-6 rounded-full bg-blue-100 flex items-center justify-center mr-3 mt-0.5">
                                        <span class="text-blue-600 font-medium">5</span>
                            </div>
                                    <div>
                                        <p class="text-sm text-gray-700"><span class="font-medium">Submit the Quiz:</span> Click the "Submit Quiz" button at the end to mark this step as complete.</p>
                                    </div>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="sticky bottom-0 bg-white pt-4 border-t mt-4">
                <div class="flex justify-end">
                    <!-- Quiz Complete button removed -->
                </div>
            </div>

            <!-- Brand-Specific Guide Section -->
            <div class="bg-white p-6 rounded-lg border mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">TurnClicksToClients.com Guide</h3>
                    <button onclick="downloadGuide()" class="flex items-center px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 text-sm">
                        <i class="fas fa-file-pdf mr-2"></i>
                        View Onboarding Guide
                    </button>
                </div>
                <p class="text-gray-600 mb-4">Please click the "View Onboarding Guide" button to read the guide. This guide contains important information about our partnership and steps to success.</p>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-info-circle text-yellow-400"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-yellow-700">
                                <strong>Important:</strong> Please follow these steps to complete this module:
                                <ol class="mt-2 ml-4 list-decimal">
                                    <li>Click the "View Onboarding Guide" button above</li>
                                    <li>Read and understand the entire guide</li>
                                    <li>Return to this page after reviewing the guide</li>
                                    <li>Complete the understanding quiz below</li>
                                    <li>Click "Submit Quiz" to mark this step as complete</li>
                                </ol>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quiz Section -->
            <div class="bg-white p-6 rounded-lg border mt-6">
                <h4 class="text-lg font-semibold text-gray-800 mb-4">Verify Your Understanding</h4>
                <form id="quiz-form" class="space-y-6">
                    <div>
                        <p class="text-sm font-medium text-gray-800 mb-3">1. What is the primary focus of TurnClicksToClients.com's service?</p>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="q1" value="website" class="mr-2">
                                <span class="text-sm text-gray-700">Website design and development</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q1" value="consulting" class="mr-2">
                                <span class="text-sm text-gray-700">General business consulting</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q1" value="leads" class="mr-2">
                                <span class="text-sm text-gray-700">Generating leads and booking appointments through social media ads</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q1" value="training" class="mr-2">
                                <span class="text-sm text-gray-700">Employee training and development</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <p class="text-sm font-medium text-gray-800 mb-3">2. Which tasks does TurnClicksToClients.com handle for your business?</p>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="q2" value="product" class="mr-2">
                                <span class="text-sm text-gray-700">Product development and inventory management</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q2" value="followup" class="mr-2">
                                <span class="text-sm text-gray-700">Ad campaigns, lead follow-up, and conversion to bookings</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q2" value="services" class="mr-2">
                                <span class="text-sm text-gray-700">In-person client services</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q2" value="recruitment" class="mr-2">
                                <span class="text-sm text-gray-700">Staff recruitment and payroll management</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <p class="text-sm font-medium text-gray-800 mb-3">3. What makes TurnClicksToClients.com's system particularly effective?</p>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="q3" value="prices" class="mr-2">
                                <span class="text-sm text-gray-700">Low prices and aggressive marketing</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q3" value="targeted" class="mr-2">
                                <span class="text-sm text-gray-700">Targeted ads and persistent follow-up</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q3" value="seo" class="mr-2">
                                <span class="text-sm text-gray-700">SEO and content marketing</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q3" value="email" class="mr-2">
                                <span class="text-sm text-gray-700">Email marketing and cold calling</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <p class="text-sm font-medium text-gray-800 mb-3">4. TurnClicksToClients.com's system is designed to work for:</p>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="q4" value="established" class="mr-2">
                                <span class="text-sm text-gray-700">Only established businesses with large budgets</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q4" value="small" class="mr-2">
                                <span class="text-sm text-gray-700">Only small businesses just starting out</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q4" value="all" class="mr-2">
                                <span class="text-sm text-gray-700">Businesses of all sizes and experience levels</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q4" value="specific" class="mr-2">
                                <span class="text-sm text-gray-700">Only businesses in specific industries</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <p class="text-sm font-medium text-gray-800 mb-3">5. What type of freedom does TurnClicksToClients.com's system aim to provide?</p>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="q5" value="taxes" class="mr-2">
                                <span class="text-sm text-gray-700">Freedom from paying taxes</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q5" value="bookings" class="mr-2">
                                <span class="text-sm text-gray-700">Freedom from inconsistent bookings and chasing leads</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q5" value="service" class="mr-2">
                                <span class="text-sm text-gray-700">Freedom from having to provide quality service</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="q5" value="clients" class="mr-2">
                                <span class="text-sm text-gray-700">Freedom from having any clients at all</span>
                            </label>
                        </div>
                    </div>

                    <div class="mt-6 text-right">
                        <button type="button" onclick="verifyQuizAnswers()" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Submit Quiz
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Domain Selection Modal -->
    <div id="domain-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50" style="display: none;">
        <div class="relative top-10 mx-auto p-5 border w-3/4 max-w-4xl shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white z-10 pb-4 border-b mb-4">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800">Select Your Campaign Domain</h3>
                    <button onclick="closeModal('domain-modal')" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <!-- Domain Modal Help Section -->
                <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                    <p class="text-sm text-yellow-800">
                        <i class="fas fa-info-circle mr-2"></i>
                        Please read through the instructions carefully before proceeding. Most questions can be answered by following the steps provided. If you still need assistance after trying the steps, our team can help. <button onclick="showHelpModal(event)" class="text-blue-600 hover:text-blue-800">Request assistance</button>
                    </p>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Information Section -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">About Campaign Domain Selection</h4>
                    <p class="text-gray-600 mb-4">
                        You'll need to select a campaign domain for your marketing:
                    </p>
                    <ul class="list-disc list-inside space-y-2 text-gray-600">
                        <li>If you don't have a domain yet, we'll help you select one for your campaigns</li>
                        <li>If you already have a domain, you'll still select a new campaign domain that will run alongside your existing one</li>
                    </ul>
                    <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                        <p class="text-sm text-yellow-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            Having a dedicated campaign domain helps improve deliverability and maintain your brand's reputation for marketing campaigns.
                        </p>
                    </div>
                </div>

                <!-- Domain Search -->
                <div class="bg-white p-6 rounded-lg border">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Search for Your Domain</h4>
                    <div class="space-y-4">
                        <div class="flex space-x-4">
                            <div class="flex-1">
                                <input type="text" id="domain-search" placeholder="Enter your desired domain name" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <button id="domain-search-btn" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Check Availability
                            </button>
                        </div>
                        <div class="text-sm text-gray-500">
                            <p><i class="fas fa-lightbulb mr-1"></i> Tip: Keep it short, memorable, and related to your business</p>
                        </div>
                    </div>

                    <!-- Search Results -->
                    <div id="domain-results" class="mt-6 space-y-4">
                        <div id="domain-loading" class="hidden">
                            <p class="text-sm text-gray-600"><i class="fas fa-spinner fa-spin mr-2"></i> Searching available domains...</p>
                        </div>
                        <div id="domain-error" class="hidden">
                            <p class="text-sm text-red-600"><i class="fas fa-exclamation-circle mr-2"></i> <span id="domain-error-message"></span></p>
                        </div>
                        <div id="domain-results-container" class="hidden">
                            <h5 class="font-medium text-gray-800 mb-3">Available Domains:</h5>
                            <div id="domain-list" class="space-y-3 border rounded-lg p-3 max-h-48 overflow-y-auto">
                            <!-- Domain results will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Selected Domain -->
                <div id="selected-domain-section" class="bg-white p-6 rounded-lg border hidden">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Selected Domain</h4>
                    <div class="p-4 bg-green-50 rounded-lg border border-green-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-medium text-green-800" id="selected-domain-name"></p>
                            </div>
                            <button id="domain-clear-btn" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="sticky bottom-0 bg-white pt-4 border-t mt-4">
                <div class="flex justify-between">
                    <button onclick="closeModal('domain-modal')" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 text-sm">
                        Cancel
                    </button>
                    <button id="confirm-domain-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm hidden">
                        Confirm Domain
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Social Media Integration Modal -->
    <div id="social-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50" style="display: none;">
        <div class="relative top-10 mx-auto p-5 border w-3/4 max-w-4xl shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white z-10 pb-4 border-b mb-4">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800">Connect Your Social Media Accounts</h3>
                    <button onclick="closeModal('social-modal')" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <!-- Social Media Modal Help Section -->
                <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                    <p class="text-sm text-yellow-800">
                        <i class="fas fa-info-circle mr-2"></i>
                        Please read through the instructions carefully before proceeding. Most questions can be answered by following the steps provided. If you still need assistance after trying the steps, our team can help. <button onclick="showHelpModal(event)" class="text-blue-600 hover:text-blue-800">Request assistance</button>
                    </p>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Information Section -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Why Connect Your Social Media?</h4>
                    <p class="text-gray-600 mb-4">
                        Connecting your social media accounts with TurnClicksToClients.com enables seamless campaign management and optimization:
                    </p>
                    <ul class="list-disc list-inside space-y-2 text-gray-600">
                        <li>Centralized campaign management across all platforms</li>
                        <li>Streamlined ad account access and permissions</li>
                        <li>Efficient budget management and optimization</li>
                        <li>Unified analytics and reporting</li>
                        <li>Enhanced targeting capabilities</li>
                    </ul>
                    <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                        <p class="text-sm text-yellow-800">
                            <i class="fas fa-shield-alt mr-2"></i>
                            Your account security is our priority. We only request necessary permissions to manage your campaigns effectively.
                        </p>
                    </div>
                </div>

                <!-- Setup Options -->
                <div class="bg-white p-6 rounded-lg border">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Do you have existing Meta business assets?</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="p-4 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="showExistingAssetsFlow()">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-check-circle text-green-600 mr-2"></i>
                                <h5 class="font-medium text-gray-800">Yes, I have existing assets</h5>
                            </div>
                            <p class="text-sm text-gray-600">I already have a Meta Business Manager, ad account, and business page set up.</p>
                        </div>
                        <div class="p-4 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="showSetupGuide()">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-plus-circle text-blue-600 mr-2"></i>
                                <h5 class="font-medium text-gray-800">No, I need to set them up</h5>
                            </div>
                            <p class="text-sm text-gray-600">I need help creating my Meta Business Manager, ad account, and business page.</p>
                        </div>
                    </div>
                </div>

                <!-- Existing Assets Flow (Hidden by default) -->
                <div id="existing-assets-flow" class="space-y-4 hidden">
                    <!-- Facebook Business Manager -->
                    <div class="bg-white p-6 rounded-lg border">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <i class="fab fa-facebook text-[#1877F2] text-3xl mr-4"></i>
                                <div>
                                    <h5 class="font-medium text-gray-800">Facebook Business Manager</h5>
                                    <p class="text-sm text-gray-600">Connect your ad accounts and business pages</p>
                                </div>
                            </div>
                            <button onclick="connectFacebookManager()" class="px-4 py-2 bg-[#1877F2] text-white rounded-md hover:bg-[#1664d9] flex items-center">
                                <i class="fas fa-plug mr-2"></i>Connect
                            </button>
                        </div>
                        <div class="text-sm text-gray-500">
                            <p><i class="fas fa-info-circle mr-1"></i> Grants access to manage ad accounts and pages</p>
                        </div>
                    </div>

                    <!-- Instagram Business -->
                    <div class="bg-white p-6 rounded-lg border">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <i class="fab fa-instagram text-[#E4405F] text-3xl mr-4"></i>
                                <div>
                                    <h5 class="font-medium text-gray-800">Instagram Business</h5>
                                    <p class="text-sm text-gray-600">Connect your Instagram business account</p>
                                </div>
                            </div>
                            <button onclick="connectInstagram()" class="px-4 py-2 bg-[#E4405F] text-white rounded-md hover:bg-[#d63851] flex items-center">
                                <i class="fas fa-plug mr-2"></i>Connect
                            </button>
                        </div>
                        <div class="text-sm text-gray-500">
                            <p><i class="fas fa-info-circle mr-1"></i> Links your Instagram business profile</p>
                        </div>
                    </div>
                </div>

                <!-- Setup Guide (Hidden by default) -->
                <div id="setup-guide" class="space-y-4 hidden">
                    <div class="bg-blue-50 p-6 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-800 mb-3">Let's Get You Set Up!</h4>
                        <p class="text-gray-600 mb-4">
                            We'll help you create your Meta business assets step by step. This process typically takes about 15-20 minutes.
                        </p>
                        <div class="space-y-4">
                            <div class="flex items-start">
                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                    <span class="text-blue-600 font-medium">1</span>
                                </div>
                                <div class="ml-4">
                                    <h5 class="text-sm font-medium text-gray-800">Create Meta Business Manager</h5>
                                    <p class="text-sm text-gray-600">Set up your business's central hub for managing assets</p>
                                    <button onclick="openMetaBusinessManager()" class="mt-2 px-4 py-2 bg-[#1877F2] text-white rounded-md hover:bg-[#1664d9] text-sm">
                                        Create Business Manager
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                    <span class="text-blue-600 font-medium">2</span>
                                </div>
                                <div class="ml-4">
                                    <h5 class="text-sm font-medium text-gray-800">Create Facebook Business Page</h5>
                                    <p class="text-sm text-gray-600">Establish your business's presence on Facebook</p>
                                    <button onclick="openFacebookPageCreation()" class="mt-2 px-4 py-2 bg-[#1877F2] text-white rounded-md hover:bg-[#1664d9] text-sm">
                                        Create Business Page
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                    <span class="text-blue-600 font-medium">3</span>
                                </div>
                                <div class="ml-4">
                                    <h5 class="text-sm font-medium text-gray-800">Create Ad Account</h5>
                                    <p class="text-sm text-gray-600">Set up your advertising account for running campaigns</p>
                                    <button onclick="openAdAccountCreation()" class="mt-2 px-4 py-2 bg-[#1877F2] text-white rounded-md hover:bg-[#1664d9] text-sm">
                                        Create Ad Account
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                    <span class="text-blue-600 font-medium">4</span>
                                </div>
                                <div class="ml-4">
                                    <h5 class="text-sm font-medium text-gray-800">Connect Instagram Business</h5>
                                    <p class="text-sm text-gray-600">Link your Instagram account to your business</p>
                                    <button onclick="openInstagramSetup()" class="mt-2 px-4 py-2 bg-[#E4405F] text-white rounded-md hover:bg-[#d63851] text-sm">
                                        Set Up Instagram
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Connected Accounts -->
                <div id="connected-accounts" class="bg-white p-6 rounded-lg border hidden">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Connected Accounts</h4>
                    <div class="space-y-3" id="accounts-list">
                        <!-- Connected accounts will be listed here -->
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="sticky bottom-0 bg-white pt-4 border-t mt-4">
                <div class="flex justify-between">
                    <button onclick="closeModal('social-modal')" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 text-sm">
                        Close
                    </button>
                    <button onclick="confirmSocialConnections()" id="confirm-social-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm hidden">
                        Confirm Connections
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Slack Integration Modal -->
    <div id="slack-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50" style="display: none;">
        <div class="relative top-10 mx-auto p-5 border w-3/4 max-w-4xl shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white z-10 pb-4 border-b mb-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">Join Our Slack Support Group</h3>
                    <button onclick="closeModal('slack-modal')" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <!-- Help Section -->
                <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                    <p class="text-sm text-yellow-800">
                        <i class="fas fa-info-circle mr-2"></i>
                        Please read through the instructions carefully before proceeding. Most questions can be answered by following the steps provided. If you still need assistance after trying the steps, our team can help. <button onclick="showHelpModal(event)" class="text-blue-600 hover:text-blue-800">Request assistance</button>
                    </p>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Information Section -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Your Dedicated Support Channel</h4>
                    <p class="text-gray-600 mb-4">
                        We'll create a private Slack channel for you and your team, where you'll have direct access to our support team for:
                    </p>
                    <ul class="list-disc list-inside space-y-2 text-gray-600 mb-4">
                        <li>One-on-one support and guidance</li>
                        <li>Quick answers to your questions</li>
                        <li>Regular check-ins and updates</li>
                        <li>Best practices and tips</li>
                        <li>Exclusive resources and training</li>
                    </ul>
                    
                    <!-- Support Team Section -->
                    <div class="mt-4 border-t pt-4">
                        <h5 class="text-md font-semibold text-gray-800 mb-2">Your Support Team</h5>
                        <p class="text-gray-600 mb-3">These team members will be added to your channel:</p>
                        <div class="flex items-center p-3 bg-white rounded-lg shadow-sm">
                            <div class="h-10 w-10 rounded-full bg-purple-100 flex items-center justify-center">
                                <span class="text-purple-600 font-medium">EA</span>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-gray-800">Eizel A</p>
                                <p class="text-xs text-gray-500">Account Manager</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Setup Steps -->
                <div class="space-y-4">
                    <!-- Step 1: Slack Account -->
                    <div class="bg-white p-6 rounded-lg border">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                <span class="text-blue-600 font-medium">1</span>
                            </div>
                            <div class="ml-4">
                                <h5 class="text-sm font-medium text-gray-800">Get Started with Slack</h5>
                                <p class="text-sm text-gray-600 mb-4">Download the Slack app and create an account if you don't have one already.</p>
                                <div class="flex space-x-4">
                                    <a href="https://slack.com/download" target="_blank" class="px-4 py-2 bg-[#4A154B] text-white rounded-md hover:bg-[#3a1038] flex items-center">
                                        <i class="fab fa-slack mr-2"></i>Download Slack
                                    </a>
                                    <a href="https://slack.com/signin" target="_blank" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 flex items-center">
                                        <i class="fas fa-user-plus mr-2"></i>Create Account
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Join Workspace -->
                    <div class="bg-white p-6 rounded-lg border">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                <span class="text-blue-600 font-medium">2</span>
                            </div>
                            <div class="ml-4">
                                <h5 class="text-sm font-medium text-gray-800">Join Our Slack Workspace</h5>
                                <p class="text-sm text-gray-600 mb-4">You'll need to join our Slack workspace first to get access to your support channel.</p>
                                <div class="flex space-x-4">
                                    <a href="https://join.slack.com/t/theconnectorgrouphq/shared_invite/zt-34k3y5ib4-fJskL59X1IeavkEx02ORtw" target="_blank" class="px-4 py-2 bg-[#4A154B] text-white rounded-md hover:bg-[#3a1038] flex items-center">
                                        <i class="fab fa-slack mr-2"></i>Join Workspace
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Channel Creation -->
                    <div class="bg-white p-6 rounded-lg border">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                <span class="text-blue-600 font-medium">3</span>
                            </div>
                            <div class="ml-4">
                                <h5 class="text-sm font-medium text-gray-800">Create Your Support Channel</h5>
                                <p class="text-sm text-gray-600 mb-4">We'll automatically create a private channel for you and add our support team.</p>
                                <div class="space-y-4">
                                    <div class="flex items-center space-x-4">
                                        <div class="flex-1">
                                            <label class="block text-sm font-medium text-gray-700">Business Name</label>
                                            <input type="text" id="business-name" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Enter your business name" required>
        </div>
                                        <div class="flex-1">
                                            <label class="block text-sm font-medium text-gray-700">Your Name</label>
                                            <input type="text" id="client-name" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Enter your name" required>
        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Slack Email</label>
                                        <input type="email" id="slack-email" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Enter your Slack email" required>
                                        <p class="mt-1 text-sm text-red-600"><i class="fas fa-exclamation-triangle mr-1"></i>Important: This must match the email you used to join the Slack workspace above!</p>
                                    </div>
                                    <button type="button" onclick="createSlackChannel()" 
                                       class="w-full px-4 py-2 bg-[#4A154B] text-white rounded-md hover:bg-[#3a1038] flex items-center justify-center">
                                        <i class="fab fa-slack mr-2"></i>Create Support Channel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Manual Confirmation Section -->
                    <div class="bg-white p-6 rounded-lg border mt-4">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                <span class="text-blue-600 font-medium">4</span>
                            </div>
                            <div class="ml-4">
                                <h5 class="text-sm font-medium text-gray-800">Confirm Your Slack Membership</h5>
                                <p class="text-sm text-gray-600 mb-4">After you've joined our Slack workspace, click the button below to complete this step in your onboarding process.</p>
                                <div class="p-4 bg-yellow-50 rounded-md border border-yellow-200 mb-4">
                                    <div class="flex items-center">
                                        <i class="fas fa-exclamation-triangle text-yellow-600 mr-2"></i>
                                        <p class="text-sm font-semibold text-yellow-800">Important: After joining the Slack channel, you MUST click the button below to complete this step!</p>
        </div>
        </div>
                                <button id="confirm-slack-joined" class="w-full mt-2 px-4 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center justify-center font-medium text-base">
                                    <i class="fas fa-check-circle mr-2"></i>Yes, I've Joined Slack
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="sticky bottom-0 bg-white pt-4 border-t mt-6">
                <div class="flex justify-between">
                    <button onclick="closeModal('slack-modal')" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 text-sm">
                        Close
                    </button>
                    <button onclick="confirmSlackSetup()" id="confirm-slack-btn" class="px-4 py-2 bg-[#4A154B] text-white rounded-md hover:bg-[#3a1038] text-sm hidden">
                        Complete Setup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Signature Modal -->
    <div id="signatureModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="modal-content bg-white p-6 rounded-lg shadow-lg relative w-full max-w-md">
            <h2 class="text-xl font-semibold mb-4">Sign Your Agreement</h2>
            <div style="border: 1px solid #ccc; width: 100%; max-width: 600px; margin: 20px 0;">
                <canvas id="modal-signature-pad" width="600" height="200" style="background: #fff;"></canvas>
            </div>
            <div class="mt-4 flex justify-between">
                <button type="button" onclick="clearModalSignature()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Clear</button>
                <button type="button" onclick="saveModalSignatureAndAgreement()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Save Signature & Confirm</button>
            </div>
            <input type="hidden" id="modal-signature-data" name="modal-signature-data">
            <button type="button" onclick="closeModal('signatureModal')" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-2xl font-bold">&times;</button>
        </div>
    </div>

    <!-- Verification Modal -->
    <div id="verification-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50" style="display: none;">
        <div class="relative top-10 mx-auto p-5 border w-3/4 max-w-4xl shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white z-10 pb-4 border-b mb-4">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800">Verify Your Information</h3>
                    <button onclick="closeModal('verification-modal')" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <!-- Verification Modal Help Section -->
                <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                    <p class="text-sm text-yellow-800">
                        <i class="fas fa-info-circle mr-2"></i>
                        Please read through the instructions carefully before proceeding. Most questions can be answered by following the steps provided. If you still need assistance after trying the steps, our team can help. <button onclick="showHelpModal(event)" class="text-blue-600 hover:text-blue-800">Request assistance</button>
                    </p>
        </div>
    </div>

            <form id="verification-form" class="space-y-6">
                <!-- Personal Information -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Personal Information</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">First Name</label>
                            <input type="text" id="first-name" name="first-name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Last Name</label>
                            <input type="text" id="last-name" name="last-name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>

                <!-- Business Information -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Business Information</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="verification-business-name" class="block text-sm font-medium text-gray-700 mb-1">Business Name *</label> <!-- Changed for attribute -->
                            <input type="text" id="verification-business-name" name="business-name" placeholder="Enter Your Business Name" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"> <!-- Changed ID -->
                        </div>
                        <div>
                            <label for="program-selected" class="block text-sm font-medium text-gray-700 mb-1">Which Program Did You Select? *</label>
                            <select id="program-selected" name="program-selected" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white">
                                <option value="">-- Please Choose --</option>
                                <option value="LashConnector">LashConnector (Clients for Lash Artists)</option>
                                <option value="BrowConnector">BrowConnector (Clients for Brow Artists)</option>
                            </select>
                        </div>
                        
                        <!-- Logo Upload -->
                        <div class="md:col-span-2 mt-3">
                            <label for="logo-upload" class="block text-sm font-medium text-gray-700 mb-1">Business Logo (Optional)</label>
                            <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                                <div class="space-y-1 text-center">
                                    <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="flex text-sm text-gray-600 justify-center">
                                        <label for="logo-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none">
                                            <span>Upload a logo</span>
                                            <input id="logo-upload" name="logo-upload" type="file" class="sr-only" accept="image/*">
                                        </label>
                                    </div>
                                    <p class="text-xs text-gray-500">PNG, JPG, GIF up to 5MB</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Marketing Images -->
                        <div class="md:col-span-2 mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Marketing Images (Optional)</label>
                            <p class="text-xs text-gray-500 mb-3">Upload up to 5 images you would like featured in your marketing campaigns</p>
                            
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
                                <!-- Image Upload 1 -->
                                <div class="border-2 border-gray-300 border-dashed rounded-md p-3 text-center">
                                    <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="mt-2">
                                        <label for="marketing-image-1" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none text-xs">
                                            <span>Upload image 1</span>
                                            <input id="marketing-image-1" name="marketing-image-1" type="file" class="sr-only" accept="image/*">
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Image Upload 2 -->
                                <div class="border-2 border-gray-300 border-dashed rounded-md p-3 text-center">
                                    <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="mt-2">
                                        <label for="marketing-image-2" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none text-xs">
                                            <span>Upload image 2</span>
                                            <input id="marketing-image-2" name="marketing-image-2" type="file" class="sr-only" accept="image/*">
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Image Upload 3 -->
                                <div class="border-2 border-gray-300 border-dashed rounded-md p-3 text-center">
                                    <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="mt-2">
                                        <label for="marketing-image-3" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none text-xs">
                                            <span>Upload image 3</span>
                                            <input id="marketing-image-3" name="marketing-image-3" type="file" class="sr-only" accept="image/*">
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Image Upload 4 -->
                                <div class="border-2 border-gray-300 border-dashed rounded-md p-3 text-center">
                                    <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="mt-2">
                                        <label for="marketing-image-4" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none text-xs">
                                            <span>Upload image 4</span>
                                            <input id="marketing-image-4" name="marketing-image-4" type="file" class="sr-only" accept="image/*">
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Image Upload 5 -->
                                <div class="border-2 border-gray-300 border-dashed rounded-md p-3 text-center">
                                    <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="mt-2">
                                        <label for="marketing-image-5" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none text-xs">
                                            <span>Upload image 5</span>
                                            <input id="marketing-image-5" name="marketing-image-5" type="file" class="sr-only" accept="image/*">
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">PNG, JPG, GIF up to 5MB each</p>
                        </div>
                    </div>
                </div>

                <!-- Business Address -->
                <div class="bg-gray-50 p-4 rounded-lg mt-4">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Business Address</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700">Street Address</label>
                            <input type="text" id="business-address" name="business-address" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">City</label>
                            <input type="text" id="city" name="city" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">State</label>
                            <select id="state" name="state" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white">
                                <option value="">Select State</option>
                                <option value="AL">Alabama</option>
                                <option value="AK">Alaska</option>
                                <option value="AZ">Arizona</option>
                                <option value="AR">Arkansas</option>
                                <option value="CA">California</option>
                                <option value="CO">Colorado</option>
                                <option value="CT">Connecticut</option>
                                <option value="DE">Delaware</option>
                                <option value="FL">Florida</option>
                                <option value="GA">Georgia</option>
                                <option value="HI">Hawaii</option>
                                <option value="ID">Idaho</option>
                                <option value="IL">Illinois</option>
                                <option value="IN">Indiana</option>
                                <option value="IA">Iowa</option>
                                <option value="KS">Kansas</option>
                                <option value="KY">Kentucky</option>
                                <option value="LA">Louisiana</option>
                                <option value="ME">Maine</option>
                                <option value="MD">Maryland</option>
                                <option value="MA">Massachusetts</option>
                                <option value="MI">Michigan</option>
                                <option value="MN">Minnesota</option>
                                <option value="MS">Mississippi</option>
                                <option value="MO">Missouri</option>
                                <option value="MT">Montana</option>
                                <option value="NE">Nebraska</option>
                                <option value="NV">Nevada</option>
                                <option value="NH">New Hampshire</option>
                                <option value="NJ">New Jersey</option>
                                <option value="NM">New Mexico</option>
                                <option value="NY">New York</option>
                                <option value="NC">North Carolina</option>
                                <option value="ND">North Dakota</option>
                                <option value="OH">Ohio</option>
                                <option value="OK">Oklahoma</option>
                                <option value="OR">Oregon</option>
                                <option value="PA">Pennsylvania</option>
                                <option value="RI">Rhode Island</option>
                                <option value="SC">South Carolina</option>
                                <option value="SD">South Dakota</option>
                                <option value="TN">Tennessee</option>
                                <option value="TX">Texas</option>
                                <option value="UT">Utah</option>
                                <option value="VT">Vermont</option>
                                <option value="VA">Virginia</option>
                                <option value="WA">Washington</option>
                                <option value="WV">West Virginia</option>
                                <option value="WI">Wisconsin</option>
                                <option value="WY">Wyoming</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ZIP Code</label>
                            <input type="text" id="zip" name="zip" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                        <div class="md:col-span-2">
                            <label for="service-city" class="block text-sm font-medium text-gray-700 mb-1">City You Service *</label>
                            <input type="text" id="service-city" name="service-city" placeholder="Enter the Main City You Service" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="bg-gray-50 p-4 rounded-lg mt-4">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Contact Information</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Personal Phone</label>
                            <input type="tel" id="personal-phone" name="personal-phone" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Business Phone</label>
                            <input type="tel" id="business-phone" name="business-phone" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Personal Email</label>
                            <input type="email" id="personal-email" name="personal-email" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Business Email</label>
                            <input type="email" id="business-email" name="business-email" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>
                
                <!-- The Connector Group Service Agreement -->
                <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg space-y-4 max-h-96 overflow-y-auto">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3 text-center">TURNCLICKSTOCLIENTS.COM SERVICE AGREEMENT</h4>

                    <p>This Service Agreement (the "Agreement") is entered into by and between TurnClicksToClients.com ("TurnClicksToClients.com" or "We") and the undersigned customer ("Customer" or "You") as of the date of signing this Agreement. By signing this Agreement, Customer agrees to all of the terms and conditions outlined below. This is a week-to-week agreement, and by continuing to make payments, you acknowledge and agree to the following terms:</p>

                    <div class="space-y-2">
                        <h5 class="font-semibold">1. Agreement Term and Payment Structure</h5>
                        <p><strong>1.1 Billing Cycle:</strong> The Customer agrees to a week-to-week service agreement. You will be billed on a weekly basis based on the plan you selected.</p>
                        <p><strong>1.2 Non-Refundable Payments:</strong> All payments made to TurnClicksToClients.com are non-refundable under any circumstances.</p>
                    </div>

                    <div class="space-y-2">
                        <h5 class="font-semibold">2. Service Description</h5>
                        <p><strong>2.1 Core Services:</strong> TurnClicksToClients.com will provide business messaging and communication services as outlined in your selected service package.</p>
                        <p><strong>2.2 Service Limitations:</strong> Services are subject to carrier and platform limitations. We do not guarantee specific results or outcomes.</p>
                    </div>

                    <div class="space-y-2">
                        <h5 class="font-semibold">3. Customer Responsibilities</h5>
                        <p><strong>3.1 Compliance:</strong> Customer agrees to comply with all applicable laws and regulations regarding business messaging.</p>
                        <p><strong>3.2 Content:</strong> Customer is responsible for providing and approving all message content and ensuring it meets legal requirements.</p>
                    </div>

                    <div class="space-y-2">
                        <h5 class="font-semibold">4. Termination</h5>
                        <p><strong>4.1 Notice Period:</strong> Either party may terminate this Agreement with 7 days written notice.</p>
                        <p><strong>4.2 Final Payment:</strong> Customer shall pay all outstanding fees for services rendered through the termination date.</p>
                    </div>

                    <div class="space-y-2">
                        <h5 class="font-semibold">5. Intellectual Property</h5>
                        <p><strong>5.1 Ownership:</strong> All intellectual property related to our services remains the property of TurnClicksToClients.com.</p>
                        <p><strong>5.2 Usage Rights:</strong> Customer receives a limited license to use our services during the agreement term.</p>
                    </div>

                    <div class="space-y-2">
                        <h5 class="font-semibold">6. Data Privacy and Security</h5>
                        <p><strong>6.1 Data Handling:</strong> We handle all customer data in accordance with our privacy policy and applicable laws.</p>
                        <p><strong>6.2 Security Measures:</strong> We implement reasonable security measures to protect customer data.</p>
                    </div>

                    <div class="space-y-2">
                        <h5 class="font-semibold">7. Limitation of Liability</h5>
                        <p><strong>7.1 Liability Cap:</strong> Our liability is limited to the amount paid for services in the previous month.</p>
                        <p><strong>7.2 Indirect Damages:</strong> We are not liable for any indirect, consequential, or special damages.</p>
                    </div>
                </div>

                <!-- Agreement Form Group -->
                <div class="mt-4 mb-4">
                    <div class="flex items-start">
                        <div class="flex items-center h-5">
                            <input id="agreementCheck" type="checkbox" value="" class="w-4 h-4 border-gray-300 rounded">
                        </div>
                        <div class="ml-3 text-sm">
                            <label for="agreementCheck" class="font-medium text-gray-700">I agree to the terms and conditions</label>
                        </div>
                    </div>
                </div>

                <!-- Hidden field for agreement status -->
                <input type="hidden" id="agreement_status" name="agreement_status">
                <input type="hidden" id="signature_data" name="signature_data">

                <!-- Signature Section -->
                <div class="mt-6 mb-4">
                    <label for="signature-pad-container" class="block text-sm font-medium text-gray-700 mb-2">Your Signature</label>
                    <div id="signature-pad-container" class="border border-gray-300 rounded-md bg-white p-2 mb-2" style="height: 200px; position: relative;">
                        <canvas id="verification-signature-pad" width="600" height="200" style="background: #fff;"></canvas>
                        <div class="absolute bottom-2 right-2">
                            <button type="button" onclick="clearVerificationSignature()" class="text-sm text-red-600 hover:text-red-700 mr-2">
                                <i class="fas fa-eraser mr-1"></i> Clear
                            </button>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">Please sign with your mouse or finger to confirm your agreement to the terms above.</p>
                </div>

                <div class="mt-6 flex justify-end"> 
                    <button type="button" onclick="submitVerificationForm()" class="btn-next px-6 py-2 rounded-lg font-medium text-white bg-blue-600 hover:bg-blue-700 transition duration-200">
                        Submit Verification <i class="fas fa-check ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: Review -->
            <div class="form-step" data-step="3" style="display: none;">
                <div class="bg-blue-50 p-4 rounded-lg mb-6">
                    <h2 class="text-xl font-semibold mb-2 text-gray-800">Review Your Information</h2>
                    <p class="text-gray-600">
                        Please review the information you provided to ensure it is accurate. Double check the details on your CP575 form and confirm that all the information is correct.
                    </p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm mb-6">
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Full Name:</span>
                            <span class="font-medium" id="reviewFullName"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Email:</span>
                            <span class="font-medium" id="reviewEmail"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Phone:</span>
                            <span class="font-medium" id="reviewPhone"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">EIN:</span>
                            <span class="font-medium" id="reviewEin"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Business Name:</span>
                            <span class="font-medium" id="reviewBusinessName"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Business Address:</span>
                            <span class="font-medium" id="reviewBusinessAddress"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Business City:</span>
                            <span class="font-medium" id="reviewBusinessCity"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Business State:</span>
                            <span class="font-medium" id="reviewBusinessState"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Business ZIP:</span>
                            <span class="font-medium" id="reviewBusinessZip"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">CP575 Document:</span>
                            <span class="font-medium" id="reviewCP575"></span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center mb-6 p-4 bg-gray-50 rounded-lg">
                    <input type="checkbox" id="confirmDetails" required class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="confirmDetails" class="ml-2 text-sm text-gray-600">I confirm that my details are correct as per my CP575 form.</label>
                </div>
                <div class="flex justify-between">
                    <button type="button" class="btn-prev px-6 py-2 rounded-lg font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-200" onclick="prevStep(2)">
                        <i class="fas fa-arrow-left mr-2"></i> Back
                    </button>
                    <button type="button" class="btn-submit px-6 py-2 rounded-lg font-medium text-white bg-green-600 hover:bg-green-700 transition duration-200" onclick="handleA2PSubmitClick()">
                        Submit Registration
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- A2P Registration Modal -->
<div id="a2p-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50" style="display: none;">
    <div class="relative top-10 mx-auto p-5 border w-3/4 max-w-4xl shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto">
        <div class="sticky top-0 bg-white z-10 pb-4 border-b mb-4">
            <div class="flex justify-between items-center">
                <h3 class="text-2xl font-bold text-gray-800">A2P Messaging Registration</h3>
                <button onclick="closeModal('a2p-modal')" class="text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <!-- A2P Modal Help Section -->
            <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                <p class="text-sm text-yellow-800">
                    <i class="fas fa-info-circle mr-2"></i>
                    Please read through the instructions carefully before proceeding. Most questions can be answered by following the steps provided. If you still need assistance after trying the steps, our team can help. <button onclick="showHelpModal(event)" class="text-blue-600 hover:text-blue-800">Request assistance</button>
                </p>
            </div>
        </div>

        <!-- Initial A2P Information -->
        <div class="mb-8">
            <p class="text-gray-600 mb-8">
                A2P (Application-to-Person) messaging allows businesses to send SMS messages to large audiences in compliance with regulations. LashConnector helps you register for A2P messaging, ensuring you stay compliant while communicating with your clients effectively.
            </p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <!-- What is A2P? -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <div class="flex items-center mb-4">
                        <div class="bg-blue-100 p-3 rounded-full mr-4">
                            <i class="fas fa-mobile-alt text-blue-600 text-xl"></i>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-800">What is A2P?</h4>
                    </div>
                    <p class="text-gray-600">
                        Application-to-Person messaging is the process of sending automated SMS messages from a business application to mobile users.
                    </p>
                </div>

                <!-- Why Register? -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <div class="flex items-center mb-4">
                        <div class="bg-blue-100 p-3 rounded-full mr-4">
                            <i class="fas fa-shield-alt text-blue-600 text-xl"></i>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-800">Why Register?</h4>
                    </div>
                    <p class="text-gray-600">
                        Registration ensures compliance with carrier regulations, prevents message blocking, and maintains high delivery rates.
                    </p>
                </div>

                <!-- Our Role -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <div class="flex items-center mb-4">
                        <div class="bg-blue-100 p-3 rounded-full mr-4">
                            <i class="fas fa-handshake text-blue-600 text-xl"></i>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-800">Our Role</h4>
                    </div>
                    <p class="text-gray-600">
                        LashConnector simplifies the registration process and acts as your liaison with carriers for A2P compliance.
                    </p>
                </div>
            </div>

            <!-- Learn More Section -->
            <div class="mb-8">
                <button id="learn-more-btn" class="bg-blue-600 text-white px-6 py-2 rounded-lg flex items-center hover:bg-blue-700 transition duration-200">
                    Learn More About A2P
                    <i class="fas fa-chevron-down ml-2 transition-transform duration-200"></i>
                </button>
                
                <div id="learn-more-content" class="hidden mt-4">
                    <!-- Educational Content -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="mb-8">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">What You Need to Know About A2P Registration</h3>
                            <div class="grid md:grid-cols-2 gap-6">
                                <!-- Left Column -->
                                <div class="space-y-6">
                                    <div class="info-card bg-blue-50 p-4 rounded-lg border-l-4 border-blue-600">
                                        <h4 class="font-semibold text-gray-800 mb-2">Registration Requirements</h4>
                                        <ul class="list-disc list-inside text-gray-600 space-y-2">
                                            <li>Valid EIN (Employer Identification Number)</li>
                                            <li>Business name exactly as shown on CP575</li>
                                            <li>Business address verification</li>
                                            <li>Privacy Policy and Terms of Service</li>
                                            <li>Active business website</li>
                                        </ul>
                                    </div>
                                    <div class="info-card bg-blue-50 p-4 rounded-lg border-l-4 border-blue-600">
                                        <h4 class="font-semibold text-gray-800 mb-2">Benefits of Registration</h4>
                                        <ul class="list-disc list-inside text-gray-600 space-y-2">
                                            <li>Higher message delivery rates</li>
                                            <li>Protection against spam filtering</li>
                                            <li>Improved sender reputation</li>
                                            <li>Access to advanced messaging features</li>
                                            <li>Compliance with carrier regulations</li>
                                        </ul>
                                    </div>
                                </div>
                                <!-- Right Column -->
                                <div class="space-y-6">
                                    <div class="info-card bg-blue-50 p-4 rounded-lg border-l-4 border-blue-600">
                                        <h4 class="font-semibold text-gray-800 mb-2">Common Use Cases</h4>
                                        <ul class="list-disc list-inside text-gray-600 space-y-2">
                                            <li>Appointment reminders and confirmations</li>
                                            <li>Order status updates and tracking</li>
                                            <li>Customer service notifications</li>
                                            <li>Marketing campaigns and promotions</li>
                                            <li>Two-factor authentication (2FA)</li>
                                        </ul>
                                    </div>
                                    <div class="info-card bg-blue-50 p-4 rounded-lg border-l-4 border-blue-600">
                                        <h4 class="font-semibold text-gray-800 mb-2">Our Support</h4>
                                        <ul class="list-disc list-inside text-gray-600 space-y-2">
                                            <li>Guided registration process</li>
                                            <li>Documentation assistance</li>
                                            <li>Compliance monitoring</li>
                                            <li>Technical support</li>
                                            <li>Regular updates and maintenance</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="px-6 pt-6">
            <div class="flex justify-between mb-6">
                <div class="progress-step flex flex-col items-center w-1/3">
                    <div class="w-12 h-12 rounded-full border-2 border-gray-300 flex items-center justify-center font-semibold step-number text-lg">1</div>
                    <span class="text-sm mt-2 text-gray-600 step-label font-medium">Basic Info</span>
                </div>
                <div class="progress-step flex flex-col items-center w-1/3">
                    <div class="w-12 h-12 rounded-full border-2 border-gray-300 flex items-center justify-center font-semibold step-number text-lg">2</div>
                    <span class="text-sm mt-2 text-gray-600 step-label font-medium">EIN Info</span>
                </div>
                <div class="progress-step flex flex-col items-center w-1/3">
                    <div class="w-12 h-12 rounded-full border-2 border-gray-300 flex items-center justify-center font-semibold step-number text-lg">3</div>
                    <span class="text-sm mt-2 text-gray-600 step-label font-medium">Review</span>
                </div>
            </div>
        </div>

        <form id="a2p-form" class="p-6" action="https://n8n-a2p.onrender.com/webhook/a2p-register" method="POST">
            <!-- Step 1: Basic Information -->
            <div class="form-step active" data-step="1" style="display: block;">
                <div class="bg-blue-50 p-4 rounded-lg mb-6">
                    <h2 class="text-xl font-semibold mb-2 text-gray-800">What is A2P Messaging?</h2>
                    <p class="text-gray-600 mb-4">
                        A2P (Application-to-Person) messaging is a type of SMS communication where messages are sent from an application to a mobile user. This is commonly used for:
                    </p>
                    <ul class="list-disc list-inside text-gray-600 mb-4">
                        <li>Appointment reminders</li>
                        <li>Order confirmations</li>
                        <li>Two-factor authentication</li>
                        <li>Marketing campaigns</li>
                        <li>Customer service notifications</li>
                    </ul>
                    <p class="text-gray-600">
                        To get started with A2P messaging, we need some basic information about you and your business.
                    </p>
                </div>
                <div class="space-y-4">
                    <div>
                        <label for="fullName" class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
                        <input type="text" id="fullName" name="fullName" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Enter your full name" required>
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                        <input type="email" id="email" name="email" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Enter your email" required>
                    </div>
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone *</label>
                        <input type="text" id="phone" name="phone" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Enter your phone number" required>
                    </div>
                </div>
                <div class="mt-6">
                    <button type="button" onclick="validateAndNext(1)" class="btn-next px-6 py-2 rounded-lg font-medium text-white bg-blue-600 hover:bg-blue-700 transition duration-200">
                        Next <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 2: EIN Information -->
            <div class="form-step" data-step="2" style="display: none;">
                <div class="bg-blue-50 p-4 rounded-lg mb-6">
                    <h2 class="text-xl font-semibold mb-2 text-gray-800">Why Do We Need Your EIN?</h2>
                    <p class="text-gray-600 mb-4">
                        The Federal Communications Commission (FCC) requires all businesses sending A2P messages to register with their EIN. This helps:
                    </p>
                    <ul class="list-disc list-inside text-gray-600 mb-4">
                        <li>Verify your business identity</li>
                        <li>Prevent spam and fraud</li>
                        <li>Ensure message deliverability</li>
                        <li>Maintain compliance with regulations</li>
                    </ul>
                    <p class="text-gray-600">
                        Your EIN (Employer Identification Number) is a unique identifier for your business, similar to a social security number for individuals.
                    </p>
                </div>
                <div class="mb-6">
                    <p class="text-blue-600 mb-2">If you don't have an EIN yet, you can get one for free in under 15 minutes.</p>
                    <a href="https://sa.www4.irs.gov/modiein/individual/index.jsp" target="_blank" class="inline-flex items-center text-blue-600 hover:text-blue-800">
                        <i class="fas fa-external-link-alt mr-2"></i>Apply for your EIN
                    </a>
                </div>
                <div class="mb-6">
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h3 class="text-sm font-medium text-gray-700 mb-2">CP575 Form Reference</h3>
                        <img src="https://storage.googleapis.com/msgsndr/C4EL78WQvWpqMgSsv2kE/media/67f80866d5463c2ac79b6d55.png" alt="CP575 Form Image" class="w-full max-w-md mx-auto rounded shadow-sm" />
                    </div>
                </div>
                
                <!-- Important CP575 Warning -->
                <div class="mb-4 p-3 bg-yellow-50 border-l-4 border-yellow-500 text-yellow-700">
                    <p class="font-medium">IMPORTANT:</p>
                    <p>Please enter all business information EXACTLY as it appears on your CP575 form. Any discrepancies may cause your A2P registration to be rejected.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="ein" class="block text-sm font-medium text-gray-700 mb-1">EIN *</label>
                        <input type="text" id="ein" name="ein" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Enter your EIN" required>
                    </div>
                    <div>
                        <label for="businessName" class="block text-sm font-medium text-gray-700 mb-1">Business Name (as on CP575) *</label>
                        <input type="text" id="businessName" name="businessName" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Enter legal business name" required>
                    </div>
                    <div class="md:col-span-2">
                        <label for="businessAddress" class="block text-sm font-medium text-gray-700 mb-1">Business Address (as on CP575) *</label>
                        <input type="text" id="businessAddress" name="businessAddress" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Enter business street address" required>
                    </div>
                    <div>
                        <label for="businessCity" class="block text-sm font-medium text-gray-700 mb-1">City *</label>
                        <input type="text" id="businessCity" name="businessCity" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Enter business city" required>
                    </div>
                    <div>
                        <label for="businessState" class="block text-sm font-medium text-gray-700 mb-1">State *</label>
                        <select id="businessState" name="businessState" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 bg-white" required>
                            <option value="">Select State</option>
                            <!-- Add all US states here -->
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA">California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                        </select>
                    </div>
                    <div>
                        <label for="businessZip" class="block text-sm font-medium text-gray-700 mb-1">ZIP Code *</label>
                        <input type="text" id="businessZip" name="businessZip" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Enter business ZIP code" required>
                    </div>
                </div>
                
                <!-- CP575 Upload -->
                <div class="mt-4">
                    <label for="cp575-upload" class="block text-sm font-medium text-gray-700 mb-1">Upload CP575 Form (PDF, JPG, PNG)</label>
                    <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                        <div class="space-y-1 text-center">
                            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                            <div class="flex text-sm text-gray-600">
                                <label for="cp575-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none">
                                    <span>Upload a file</span>
                                    <input id="cp575-upload" name="cp575-upload" type="file" class="sr-only" accept=".pdf,.jpg,.jpeg,.png">
                                </label>
                                <p class="pl-1">or drag and drop</p>
                            </div>
                            <p class="text-xs text-gray-500">Up to 5MB</p>
                        </div>
                    </div>
                    <div id="file-name-display" class="mt-2 hidden text-sm text-gray-700 flex items-center">
                        <i class="fas fa-file-alt mr-2 text-gray-500"></i>
                        <span id="selected-file-name"></span>
                        <button type="button" id="remove-file" class="ml-2 text-red-500 hover:text-red-700">&times;</button>
                    </div>
                </div>

                <div class="flex justify-between mt-6">
                    <button type="button" class="btn-prev px-6 py-2 rounded-lg font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-200" onclick="prevStep(1)">
                        <i class="fas fa-arrow-left mr-2"></i> Back
                    </button>
                    <button type="button" class="btn-next px-6 py-2 rounded-lg font-medium text-white bg-blue-600 hover:bg-blue-700 transition duration-200" onclick="validateAndNext(2)">
                        Next <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: Review -->
            <div class="form-step" data-step="3" style="display: none;">
                <div class="bg-blue-50 p-4 rounded-lg mb-6">
                    <h2 class="text-xl font-semibold mb-2 text-gray-800">Review Your Information</h2>
                    <p class="text-gray-600">
                        Please review the information you provided to ensure it is accurate. Double check the details on your CP575 form and confirm that all the information is correct.
                    </p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm mb-6">
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Full Name:</span>
                            <span class="font-medium" id="reviewFullName"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Email:</span>
                            <span class="font-medium" id="reviewEmail"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Phone:</span>
                            <span class="font-medium" id="reviewPhone"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">EIN:</span>
                            <span class="font-medium" id="reviewEin"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Business Name:</span>
                            <span class="font-medium" id="reviewBusinessName"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Business Address:</span>
                            <span class="font-medium" id="reviewBusinessAddress"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Business City:</span>
                            <span class="font-medium" id="reviewBusinessCity"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Business State:</span>
                            <span class="font-medium" id="reviewBusinessState"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Business ZIP:</span>
                            <span class="font-medium" id="reviewBusinessZip"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">CP575 Document:</span>
                            <span class="font-medium" id="reviewCP575"></span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center mb-6 p-4 bg-gray-50 rounded-lg">
                    <input type="checkbox" id="confirmDetails" required class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="confirmDetails" class="ml-2 text-sm text-gray-600">I confirm that my details are correct as per my CP575 form.</label>
                </div>
                <div class="flex justify-between">
                    <button type="button" class="btn-prev px-6 py-2 rounded-lg font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-200" onclick="prevStep(2)">
                        <i class="fas fa-arrow-left mr-2"></i> Back
                    </button>
                    <button type="button" class="btn-submit px-6 py-2 rounded-lg font-medium text-white bg-green-600 hover:bg-green-700 transition duration-200" onclick="handleA2PSubmitClick()">
                        Submit Registration
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- A2P Registration Modal Scripts -->
    <script>
    // Function to validate current step and navigate to next step
    async function validateAndNext(step) {
        try {
            console.log(`A2P: validateAndNext called for step ${step}`); // Log entry
            const currentFormStep = document.querySelector(`#a2p-modal .form-step[data-step="${step}"]`); // Scope to A2P modal
            if (!currentFormStep) {
                throw new Error('A2P form step not found');
            }

            // Validate required fields within the current A2P step
            const requiredFields = currentFormStep.querySelectorAll('[required]');
            let isValid = true;
            let firstInvalidField = null;
            console.log(`A2P: Found ${requiredFields.length} required fields for step ${step}`); // Log field count

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    field.classList.add('border-red-500');
                    if (!firstInvalidField) {
                        firstInvalidField = field;
                    }
                    console.log(`A2P: Validation FAILED for step ${step} on field:`, field.id || field.name); // Log failure
                } else {
                    field.classList.remove('border-red-500');
                }
            });

            if (!isValid) {
                alert('Please fill in all required fields for this step.');
                if (firstInvalidField) {
                    firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    if (firstInvalidField.focus) {
                        setTimeout(() => firstInvalidField.focus(), 500);
                    }
                }
                console.log(`A2P: Validation failed for step ${step}. Halting.`); // Log validation halt
                return false;
            }
             console.log(`A2P: Validation PASSED for step ${step}.`); // Log success

            // Move to next step if valid
            if (step < 3) {
                const nextStep = step + 1;
                console.log(`A2P: Attempting to move from step ${step} to step ${nextStep} by calling showStep.`); // Log move attempt
                showStep(nextStep); // Call the A2P-specific showStep
            } else {
                 console.log("A2P: Already on the last step (Review).");
            }
            return true; // Indicate validation passed for the current step

        } catch (error) {
            console.error('Error in A2P validateAndNext:', error);
            alert('Failed to proceed to next step. Please try again.');
            return false;
        }
    }

    // Function to show specific step in A2P form
    function showStep(step) {
        console.log(`[A2P ShowStep] Called for step: ${step}`);
        
        // --- Temporarily removed this check to ensure local function runs ---
        // if (window.a2pShowStep) {
        //     console.log('Using a2pShowStep function');
        //     return window.a2pShowStep(step);
        // }
        
        console.log('[A2P ShowStep] Using local implementation');
        try {
            // Hide all steps
            const steps = document.querySelectorAll('#a2p-modal .form-step'); // Scoped selector
            console.log(`[A2P ShowStep] Found ${steps.length} steps to hide.`);
            steps.forEach(s => {
                s.style.display = 'none';
                s.classList.remove('active');
            });
            
            // Show the target step
            const targetStep = document.querySelector(`#a2p-modal .form-step[data-step="${step}"]`); // Scoped selector
            console.log(`[A2P ShowStep] Found target step element for step ${step}:`, !!targetStep);

            if (targetStep) {
                console.log(`[A2P ShowStep] Setting display: block for step ${step}`);
                targetStep.style.display = 'block'; // Set display
                // Log computed style immediately after setting
                const computedDisplay = window.getComputedStyle(targetStep).display;
                console.log(`[A2P ShowStep] Computed display style AFTER setting for step ${step}:`, computedDisplay);
                
                targetStep.classList.add('active');
                
                // Update progress bar (assuming ID exists outside steps)
                const progressBar = document.getElementById('progress-bar'); 
                if (progressBar) {
                    progressBar.style.width = `${(step / 3) * 100}%`;
                } else {
                    console.warn('[A2P ShowStep] Progress bar element not found.');
                }
                
                // Update step indicators (assuming they exist outside steps)
                const stepIndicators = document.querySelectorAll('#a2p-modal .progress-step'); // Scoped selector
                console.log(`[A2P ShowStep] Found ${stepIndicators.length} progress indicators.`);
                stepIndicators.forEach((indicator, index) => {
                    const indicatorNumber = index + 1;
                    indicator.classList.remove('active', 'bg-blue-500', 'text-white', 'border-2', 'border-gray-300');
                    if (indicatorNumber < step) { // Completed steps
                        indicator.classList.add('active', 'bg-blue-500', 'text-white'); 
                    } else if (indicatorNumber === step) { // Current active step
                         indicator.classList.add('active', 'bg-blue-500', 'text-white'); 
                    } else { // Future steps
                        indicator.classList.add('border-2', 'border-gray-300');
                    }
                });
                
                // If showing review step, populate review data
                if (step === 3) {
                    console.log('[A2P ShowStep] Step 3 detected, calling populateReviewData...');
                    populateReviewData();
                } else {
                     console.log(`[A2P ShowStep] Not step 3 (${step}), skipping populateReviewData.`);
                }
                
                return true;
            } else {
                throw new Error(`Step ${step} element not found within #a2p-modal`);
                }
            } catch (error) {
            console.error('[A2P ShowStep] Error showing step:', error);
            alert('Failed to show step. Please try again.');
            return false;
        }
    }

    // Function to populate review data in A2P modal
    function populateReviewData() {
        console.log('[A2P Review] Populating data...');
        try {
            const a2pModal = document.getElementById('a2p-modal');
            if (!a2pModal) {
                console.error('[A2P Review] Could not find A2P modal element!');
                return;
            }

            // Get values from A2P form fields (scoped within modal)
            const fullName = a2pModal.querySelector('#fullName')?.value || '';
            const email = a2pModal.querySelector('#email')?.value || '';
            const phone = a2pModal.querySelector('#phone')?.value || '';
            const ein = a2pModal.querySelector('#ein')?.value || ''; 
            const businessName = a2pModal.querySelector('#businessName')?.value || '';
            const businessAddress = a2pModal.querySelector('#businessAddress')?.value || '';
            const businessCity = a2pModal.querySelector('#businessCity')?.value || '';
            const businessState = a2pModal.querySelector('#businessState')?.value || '';
            const businessZip = a2pModal.querySelector('#businessZip')?.value || '';
            const cp575UploadInput = a2pModal.querySelector('#cp575-upload');
            const cp575File = cp575UploadInput?.files[0]?.name || 'Not Uploaded';

            console.log('[A2P Review] Values Read:', { 
                fullName, email, phone, ein, businessName, 
                businessAddress, businessCity, businessState, businessZip, cp575File 
            });

            // Populate review data fields (scoped within modal)
            const reviewFullNameEl = a2pModal.querySelector('#reviewFullName');
            console.log('[A2P Review] Found reviewFullName element:', !!reviewFullNameEl);
            if (reviewFullNameEl) reviewFullNameEl.textContent = fullName;

            const reviewEmailEl = a2pModal.querySelector('#reviewEmail');
            if (reviewEmailEl) reviewEmailEl.textContent = email;

            const reviewPhoneEl = a2pModal.querySelector('#reviewPhone');
            if (reviewPhoneEl) reviewPhoneEl.textContent = phone;
            
            const reviewEinEl = a2pModal.querySelector('#reviewEin');
            if (reviewEinEl) reviewEinEl.textContent = ein;

            const reviewBusinessNameEl = a2pModal.querySelector('#reviewBusinessName');
            if (reviewBusinessNameEl) reviewBusinessNameEl.textContent = businessName;

            const reviewBusinessAddressEl = a2pModal.querySelector('#reviewBusinessAddress');
            if (reviewBusinessAddressEl) reviewBusinessAddressEl.textContent = businessAddress;

            const reviewBusinessCityEl = a2pModal.querySelector('#reviewBusinessCity');
            if (reviewBusinessCityEl) reviewBusinessCityEl.textContent = businessCity;

            const reviewBusinessStateEl = a2pModal.querySelector('#reviewBusinessState');
            if (reviewBusinessStateEl) reviewBusinessStateEl.textContent = businessState;

            const reviewBusinessZipEl = a2pModal.querySelector('#reviewBusinessZip');
            if (reviewBusinessZipEl) reviewBusinessZipEl.textContent = businessZip;

            const reviewCP575El = a2pModal.querySelector('#reviewCP575');
            if (reviewCP575El) reviewCP575El.textContent = cp575File;

            console.log('[A2P Review] Population attempt finished.');
        } catch (error) {
            console.error('[A2P Review] Error populating data:', error);
        }
    }

    // Function to handle A2P form submission
    async function submitA2PForm() {
        console.log('[A2P Submit] Starting submission process...');
        const submitButton = document.querySelector('#a2p-modal .btn-submit');
        const originalButtonText = submitButton.innerHTML;
        submitButton.disabled = true;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Submitting...';

        try {
            // 1. Get User ID
            const { data: { user }, error: userError } = await window.supabaseClient.auth.getUser();
            if (userError || !user) {
                throw new Error('User not logged in or error fetching user.');
            }
            const userId = user.id;
            console.log(`[A2P Submit] User ID: ${userId}`);

            // 2. Validate Confirmation Checkbox (Scoped Search and Logging Added)
            const a2pModalForCheckbox = document.getElementById('a2p-modal'); // Get modal container again for scoping
            const confirmCheckbox = a2pModalForCheckbox?.querySelector('#confirmDetails');
            
            // *** Logging here ***
            console.log('[A2P Submit] Scoped Search - Checking confirmation checkbox element:', confirmCheckbox);
            console.log('[A2P Submit] Scoped Search - Checkbox raw .checked state:', confirmCheckbox?.checked);
            // *** End logging ***

            if (!confirmCheckbox || !confirmCheckbox.checked) {
                alert('Please confirm that your details are correct before submitting.');
                throw new Error('Confirmation checkbox not checked.'); // Stop execution
            }

            // 3. Gather Form Data (scoped)
            const a2pModal = document.getElementById('a2p-modal');
            const fullName = a2pModal.querySelector('#fullName')?.value || '';
            const email = a2pModal.querySelector('#email')?.value || '';
            const phone = a2pModal.querySelector('#phone')?.value || '';
            const ein = a2pModal.querySelector('#ein')?.value || '';
            const businessName = a2pModal.querySelector('#businessName')?.value || '';
            const businessAddress = a2pModal.querySelector('#businessAddress')?.value || '';
            const businessCity = a2pModal.querySelector('#businessCity')?.value || '';
            const businessState = a2pModal.querySelector('#businessState')?.value || '';
            const businessZip = a2pModal.querySelector('#businessZip')?.value || '';
            const cp575UploadInput = a2pModal.querySelector('#cp575-upload');
            const cp575File = cp575UploadInput?.files[0]; // Get the actual File object

            let cp575DocumentPath = null;

            // 4. Upload CP575 File (if exists)
            if (cp575File) {
                console.log(`[A2P Submit] Found CP575 file: ${cp575File.name}`);
                const fileExt = cp575File.name.split('.').pop();
                const filePath = `${userId}/cp575_${Date.now()}.${fileExt}`;
                console.log(`[A2P Submit] Uploading to storage path: ${filePath}`);

                const { data: uploadData, error: uploadError } = await window.supabaseClient.storage
                    .from('a2pstorage')
                    .upload(filePath, cp575File);

                if (uploadError) {
                    console.error('[A2P Submit] Storage upload error:', uploadError);
                    throw new Error(`Failed to upload CP575 document: ${uploadError.message}`);
                }

                if (uploadData) {
                     cp575DocumentPath = uploadData.path; // Store the path returned by Supabase
                    console.log(`[A2P Submit] File uploaded successfully. Path: ${cp575DocumentPath}`);
                 } else {
                     console.warn('[A2P Submit] Upload successful but no path data returned.');
                     // Potentially fall back to using the constructed filePath if needed, but path from response is preferred
                     cp575DocumentPath = filePath; 
                 }
            } else {
                console.log('[A2P Submit] No CP575 file selected for upload.');
            }

            // 5. Insert Data into new_a2p_form table
            const formData = {
                user_id: userId, // Make sure your table has a user_id column
                full_name: fullName, // Correct case
                email: email, // Correct case
                phone: phone, // Added phone
                ein: ein, // Correct case
                business_name: businessName, // Correct case
                business_address: businessAddress, // Correct case
                business_city: businessCity, // Correct case
                business_state: businessState, // Correct case
                business_zip: businessZip, // Correct case
                cp575_document: cp575DocumentPath, // Correct case
                datesubmited: new Date().toISOString() // Correct case
            };

            console.log('[A2P Submit] Inserting data into new_a2p_form:', formData);
            const { error: insertError } = await window.supabaseClient
                .from('new_a2p_form')
                .insert([formData]);

            if (insertError) {
                console.error('[A2P Submit] Database insert error:', insertError);
                // Consider attempting to delete the uploaded file if insert fails
                if (cp575DocumentPath) {
                    console.warn(`[A2P Submit] DB insert failed, attempting to remove uploaded file: ${cp575DocumentPath}`);
                    await window.supabaseClient.storage.from('a2pstorage').remove([cp575DocumentPath]);
                }
                throw new Error(`Failed to save A2P form data: ${insertError.message}`);
            }
            console.log('[A2P Submit] Data inserted into new_a2p_form successfully.');

            // 6. Update Onboarding Status
            console.log('[A2P Submit] Updating onboarding status...');
            const { error: updateError } = await window.supabaseClient
                .from('new_client_onboarding')
                .update({ a2p_status: 'Completed', updated_at: new Date().toISOString() })
                .eq('user_id', userId);

            if (updateError) {
                // Log the error but proceed with UI updates as the core data was saved
                console.error('[A2P Submit] Error updating onboarding status:', updateError);
                // Maybe show a slightly different success message?
            }
            console.log('[A2P Submit] Onboarding status updated.');

            // 7. Update UI
            updateStepUICard('a2p-card', 'a2p-form-status', 'Completed');
            closeModal('a2p-modal');
            alert('A2P Registration submitted successfully!');

            } catch (error) {
            console.error('[A2P Submit] Submission failed:', error);
            alert(`Submission failed: ${error.message}`);
        } finally {
            // 8. Re-enable button
            submitButton.disabled = false;
            submitButton.innerHTML = originalButtonText;
            console.log('[A2P Submit] Submission process finished.');
        }
    }

    // Intermediate function to handle the submit button click
    function handleA2PSubmitClick() {
        console.log('[A2P HandleClick] Submit button clicked.');
        const a2pModal = document.getElementById('a2p-modal');
        const checkbox = a2pModal?.querySelector('#confirmDetails');
        
        console.log('[A2P HandleClick] Found checkbox element:', checkbox);
        console.log('[A2P HandleClick] Checkbox checked state within handler:', checkbox?.checked);

        // Now call the original submission function
        // Make sure submitA2PForm is async if it performs async operations
        submitA2PForm(); 
    }
</script>

    <!-- Add this script at the end of the body, right before the closing body tag -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded - initializing button handlers');
            
            // Define fallback functions if they don't exist
            if (typeof closeModal !== 'function') {
                window.closeModal = function(modalId) {
                    console.log('DEBUG: Closing modal with ID:', modalId);
                    const modal = document.getElementById(modalId);
                    if (modal) {
                        console.log('DEBUG: Modal found, setting display to none');
                        modal.style.display = 'none';
                    } else {
                        console.error('DEBUG: Modal element not found:', modalId);
                    }
                };
            }
            
            if (typeof downloadGuide !== 'function') {
                window.downloadGuide = function() {
                    console.log('Downloading guide');
                    window.open('welcomeguide.html', '_blank');
                    alert('Guide opened in a new tab');
                };
            }
            
            if (typeof requestSetupHelp !== 'function') {
                window.requestSetupHelp = function() {
                    console.log('Requesting setup help');
                    alert('Help request submitted. Our team will contact you shortly.');
                };
            }
            
            // Replace the fallback definition with the actual implementation
            window.verifyQuizAnswers = async function() {
                console.log('Verifying quiz answers...');
                // TODO: Add actual quiz validation logic here if needed
                // For now, assume submission means successful completion

                try {
                    const { data: { user } } = await window.supabaseClient.auth.getUser();
                    if (!user) {
                        throw new Error('User not logged in.');
                    }

                    // Update Supabase
                    const { error: updateError } = await window.supabaseClient
                        .from('new_client_onboarding')
                        .update({ guide_status: 'Completed', updated_at: new Date().toISOString() })
                        .eq('user_id', user.id);

                    if (updateError) {
                        console.error('Error updating guide status in Supabase:', updateError);
                        // Don't block UI update on DB error, but log it
                    }

                    // Update UI immediately
                    updateStepUICard('guide-card', 'guide-status', 'Completed');

                    // Close modal
                    closeModal('guide-modal');

                    // Show success message
                    alert('Guide step completed successfully!');

            } catch (error) {
                    console.error('Error verifying quiz answers:', error);
                    alert(`An error occurred: ${error.message}`);
                }
            };
            
            if (typeof validateAndNext !== 'function') {
                window.validateAndNext = function(step) {
                    console.log('Validating and moving to next step:', step);
                    // Hide current step
                    const currentStep = document.querySelector(`.form-step[data-step="${step}"]`);
                    if (currentStep) {
                        currentStep.style.display = 'none';
                    }
                    
                    // Show next step
                    const nextStep = document.querySelector(`.form-step[data-step="${step + 1}"]`);
                    if (nextStep) {
                        nextStep.style.display = 'block';
                    }
                };
            }
            
            if (typeof prevStep !== 'function') {
                window.prevStep = function(step) {
                    console.log('Moving to previous step:', step);
                    // Hide current step
                    const currentStep = document.querySelector(`.form-step[data-step="${step}"]`);
                    if (currentStep) {
                        currentStep.style.display = 'none';
                    }
                    
                    // Show previous step
                    const prevStep = document.querySelector(`.form-step[data-step="${step - 1}"]`);
                    if (prevStep) {
                        prevStep.style.display = 'block';
                    }
                };
            }
            
            // Add click event listeners for buttons in case onclick attributes aren't working
            document.querySelectorAll('button[onclick]').forEach(button => {
                const onclickAttr = button.getAttribute('onclick');
                console.log('Found button with onclick:', onclickAttr);
                
                button.addEventListener('click', function(e) {
                    console.log('Button clicked:', onclickAttr);
                    try {
                        // Try to execute the onclick function
                        eval(onclickAttr);
                    } catch (error) {
                        console.error('Error executing onclick function:', error);
                    }
                });
            });
            
            // Add event listeners for file uploads
            
            // Logo upload handling
            const logoUpload = document.getElementById('logo-upload');
            if (logoUpload) {
                logoUpload.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            const logoPreview = document.createElement('div');
                            logoPreview.classList.add('mt-2', 'text-center');
                            logoPreview.innerHTML = `
                                <img src="${event.target.result}" alt="Logo Preview" class="max-h-32 mx-auto">
                                <button type="button" class="text-sm text-red-500 mt-1">Remove</button>
                            `;
                            
                            // Clear previous preview if exists
                            const existingPreview = logoUpload.parentElement.querySelector('.preview');
                            if (existingPreview) {
                                existingPreview.remove();
                            }
                            
                            logoPreview.classList.add('preview');
                            logoUpload.parentElement.appendChild(logoPreview);
                            
                            // Add remove button functionality
                            const removeBtn = logoPreview.querySelector('button');
                            if (removeBtn) {
                                removeBtn.addEventListener('click', function() {
                                    logoUpload.value = '';
                                    logoPreview.remove();
                                });
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            // Marketing images upload handling
            const marketingImageInputs = document.querySelectorAll('[id^="marketing-image-"]');
            marketingImageInputs.forEach(input => {
                input.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            const imagePreview = document.createElement('div');
                            imagePreview.classList.add('mt-2', 'text-center');
                            imagePreview.innerHTML = `
                                <img src="${event.target.result}" alt="Image Preview" class="max-h-24 mx-auto">
                                <button type="button" class="text-sm text-red-500 mt-1">Remove</button>
                            `;
                            
                            // Clear previous preview if exists
                            const container = input.closest('.border-dashed');
                            const existingPreview = container.querySelector('.preview');
                            if (existingPreview) {
                                existingPreview.remove();
                            }
                            
                            imagePreview.classList.add('preview');
                            container.appendChild(imagePreview);
                            
                            // Hide the upload icon and label when preview is shown
                            const uploadIcon = container.querySelector('svg');
                            const uploadLabel = container.querySelector('label');
                            if (uploadIcon) uploadIcon.style.display = 'none';
                            if (uploadLabel) uploadLabel.style.display = 'none';
                            
                            // Add remove button functionality
                            const removeBtn = imagePreview.querySelector('button');
                            if (removeBtn) {
                                removeBtn.addEventListener('click', function() {
                                    input.value = '';
                                    imagePreview.remove();
                                    
                                    // Show the upload icon and label again
                                    if (uploadIcon) uploadIcon.style.display = 'block';
                                    if (uploadLabel) uploadLabel.style.display = 'block';
                                });
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                });
            });
        });
        
        // Open modals function
        function openModal(modalId) {
            console.log('Opening modal:', modalId);
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'block';
                
                // Special case for signature modal
                if (modalId === 'signatureModal') {
                    modal.style.display = 'flex';
                    showSignatureModal();
                }
            }
        }
        
        // Add missing modal functions
        function showVerificationModal() {
            try {
                console.log('[VerificationModal] Opening verification modal');
                
                // Get the modal element
                const modal = document.getElementById('verification-modal');
                if (!modal) {
                    console.error('[VerificationModal] Modal element not found!');
                    return;
                }
                
                // Show the modal
                modal.style.display = 'block';
                
                // Initialize the signature pad with a small delay to ensure the canvas is visible
                setTimeout(function() {
                    try {
                        window.initializeVerificationSignature();
                    } catch (error) {
                        console.error('[VerificationModal] Error initializing signature pad:', error);
                    }
                }, 100);
            } catch (error) {
                console.error('[VerificationModal] Error showing verification modal:', error);
            }
        }
        
        function showGuideModal() {
            console.log('Opening guide modal');
            openModal('guide-modal');
        }
        
        function showSlackModal() {
            console.log('Opening slack modal');
            openModal('slack-modal');
        }
        
        function showDomainModal() {
            console.log('Opening domain modal');
            openModal('domain-modal');
        }
        
        function showA2PModal() {
            console.log('Opening A2P modal');
            openModal('a2p-modal');
        }
        
        function showSocialModal() {
            console.log('Opening social modal');
            openModal('social-modal');
        }
        
        // Test function to see if scripts are loading properly
        console.log('Script loaded successfully');

        // Function to update onboarding progress
        function updateOnboardingProgress(item, status) {
            try {
                console.log(`Updating onboarding progress: ${item} = ${status}`);
                
                // Get the progress element for the specific item
                const progressElement = document.querySelector(`.onboarding-item[data-item="${item}"] .onboarding-status`);
                
                if (progressElement) {
                    // Update status text
                    progressElement.textContent = status;
                    
                    // Update status styling based on status
                    if (status === 'Completed') {
                        progressElement.classList.remove('bg-yellow-100', 'text-yellow-800', 'bg-blue-100', 'text-blue-800');
                        progressElement.classList.add('bg-green-100', 'text-green-800');
                    } else if (status === 'In Progress') {
                        progressElement.classList.remove('bg-green-100', 'text-green-800', 'bg-yellow-100', 'text-yellow-800');
                        progressElement.classList.add('bg-blue-100', 'text-blue-800');
                    } else {
                        progressElement.classList.remove('bg-green-100', 'text-green-800', 'bg-blue-100', 'text-blue-800');
                        progressElement.classList.add('bg-yellow-100', 'text-yellow-800');
                    }
                    
                    // Update the checkmark icon if it exists
                    const checkIcon = document.querySelector(`.onboarding-item[data-item="${item}"] .complete-icon`);
                    if (checkIcon) {
                        checkIcon.style.display = status === 'Completed' ? 'inline-flex' : 'none';
                    }
                } else {
                    console.warn(`Progress element for ${item} not found`);
                }
                
                // Update progress bar if it exists
                updateOverallProgress();
            } catch (error) {
                console.error('Error updating onboarding progress:', error);
            }
        }
        
        // Function to update overall progress
        function updateOverallProgress() {
            try {
                const totalItems = document.querySelectorAll('.onboarding-item').length;
                let completedItems = 0;
                
                // Count completed items using plain JavaScript
                document.querySelectorAll('.onboarding-status').forEach(element => {
                    if (element.textContent.trim() === 'Completed') {
                        completedItems++;
                    }
                });
                
                if (totalItems > 0) {
                    const progressPercent = Math.round((completedItems / totalItems) * 100);
                    const progressBar = document.getElementById('onboarding-progress-bar');

                if (progressBar) {
                        progressBar.style.width = `${progressPercent}%`;
                    }
                    
                    const progressText = document.getElementById('onboarding-progress-text');
                    if (progressText) {
                        progressText.textContent = `${progressPercent}% Complete`;
                    }
                }
            } catch (error) {
                console.error('Error updating overall progress:', error);
            }
        }

 

        // --- Add definition for createSlackChannel --- 
        window.createSlackChannel = function() { // Note: Removed async as it just opens a window
            try {
                console.log('?? Initiating Slack channel creation via OAuth...');

                const slackModal = document.getElementById('slack-modal');
                if (!slackModal) {
                    console.error('Could not find Slack modal element.');
                    alert('Error: Slack modal component not found.');
                    return;
                }

                // Find inputs specifically within the Slack modal
                const businessNameInput = slackModal.querySelector('#business-name');
                const clientNameInput = slackModal.querySelector('#client-name');
                const slackEmailInput = slackModal.querySelector('#slack-email');
                // Also get program selected for the state
                const programSelectedEl = document.getElementById('program-selected'); // Assuming this is outside the slack modal or accessible

                if (!businessNameInput || !clientNameInput || !slackEmailInput) {
                    console.error('Could not find one or more Slack channel input fields within the modal.');
                    alert('Error: Could not find input fields. Please contact support.');
                    return;
                }

                const businessName = businessNameInput.value.trim();
                const clientName = clientNameInput.value.trim();
                const slackEmail = slackEmailInput.value.trim();
                const programValue = programSelectedEl && programSelectedEl.value ? programSelectedEl.value.trim() : 'NoBrand'; // Use ID from verification form

                // Basic Validation
                if (!businessName || !clientName || !slackEmail) {
                    alert('Please fill in your Business Name, Your Name, and Slack Email before creating the channel.');
                    return;
                }
                
                // --- Initiate Slack OAuth Flow --- 
                
                // Build the state object with the necessary values
                const state = {
                    brand: programValue, 
                    businessName: businessName, 
                    yourName: clientName, 
                    email: slackEmail
                };
                
                console.log('?? State Data Being Sent via OAuth:', state);
                
                // Define OAuth parameters
                const clientId = '8782622636263.8801641506099'; // Make sure this is your correct Slack App Client ID
                const redirectUri = 'https://slack-channel-creator.onrender.com/success'; // Your Render backend endpoint
                const scope = 'channels:manage,chat:write,channels:read,groups:read,mpim:read,im:read,users:read,users:read.email'; // Required permissions
                const encodedState = encodeURIComponent(JSON.stringify(state));
                
                // Construct the Slack authorization URL
                const slackUrl = `https://slack.com/oauth/v2/authorize?client_id=${clientId}&scope=${scope}&redirect_uri=${redirectUri}&state=${encodedState}`;
                console.log('?? Constructing Slack OAuth URL:', slackUrl);
                
                // Attempt to open the Slack authorization in a popup window
                try {
                    const popupWidth = 600;
                    const popupHeight = 700;
                    const left = (screen.width / 2) - (popupWidth / 2);
                    const top = (screen.height / 2) - (popupHeight / 2);

                    const newWindow = window.open(slackUrl, 'slackAuthPopup', `width=${popupWidth},height=${popupHeight},top=${top},left=${left}`);
                    
                    if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
                        console.error('? Popup blocked! Please allow popups for this site.');
                        alert('Popup blocked! Please enable popups for this site and try again.');
                    } else {
                        console.log('? Slack authorization popup opened.');
                        // Optional: You could start polling here or inform the user 
                        // alert('Please complete the Slack authorization in the popup window.');
                        // Note: UI update to 'Completed' should happen after successful callback handling by Render.
                    }
                } catch (popupError) {
                    console.error('? Error opening Slack authorization popup:', popupError);
                    alert('Could not open the Slack authorization window. Please check your browser popup settings and try again.');
                }

            } catch (error) {
                console.error('? Error in createSlackChannel function:', error);
                alert('An unexpected error occurred. Please try again later.');
            }
        };
        // --- End definition --- 

        // Add event listeners for file uploads
    </script>

<script>
        async function handleConfirmSlackJoinedClick(event) {
            console.log('#confirm-slack-joined button was clicked!');
            event.preventDefault(); // Prevent any default button action
            console.log('Confirm Slack Joined button clicked (handler function).');

            try {
                const { data: { user } } = await window.supabaseClient.auth.getUser();
                if (!user) {
                    throw new Error('User not logged in.');
                }

                // Update Supabase
                const { error: updateError } = await window.supabaseClient
                    .from('new_client_onboarding')
                    .update({ slack_status: 'Completed', updated_at: new Date().toISOString() })
                    .eq('user_id', user.id);

                if (updateError) {
                    console.error('Error updating slack status in Supabase:', updateError);
                    // Proceed with UI update anyway, but log error
                }

                // Update UI
                updateStepUICard('slack-card', 'slack-status', 'Completed');

                // Provide feedback and optionally close modal
                alert('Slack step marked as complete!');
                closeModal('slack-modal'); // Close the modal after confirmation

            } catch (error) {
                console.error('Error confirming Slack membership:', error);
                alert(`An error occurred: ${error.message}`);
            }
        }
        // --- End handler function definition ---

        // Add event listener for the "Yes, I've Joined Slack" button
        document.addEventListener('DOMContentLoaded', function() {
            const confirmSlackJoinedBtn = document.getElementById('confirm-slack-joined');
            if (confirmSlackJoinedBtn) {
                confirmSlackJoinedBtn.addEventListener('click', handleConfirmSlackJoinedClick);
                console.log('Event listener added to #confirm-slack-joined button');
            } else {
                console.error('Could not find #confirm-slack-joined button element');
            }
        });
</script>

       <script> // --- Domain Modal Functions ---
        let selectedDomain = null;
        let lastDomainSearchTime = 0; // Timestamp of the last search initiation

        window.searchDomainInModal = async function() {
            const searchInput = document.getElementById('domain-search');
            let domainName = searchInput.value.trim(); // Use let as it might be modified

            const searchButton = document.querySelector('#domain-modal button:not([data-domain])'); // Find search button by exclusion
            const errorDiv = document.getElementById('domain-error');
            const statusDiv = errorDiv || document.getElementById('domain-results-container'); // Use error or results area for status

            // --- COOLDOWN CHECK --- 
            const currentTime = Date.now();
            const timeSinceLastSearch = currentTime - lastDomainSearchTime;
            
            if (timeSinceLastSearch < 10000) {
                const remainingWait = Math.ceil((10000 - timeSinceLastSearch) / 1000); // Seconds remaining
                if (statusDiv) {
                    statusDiv.textContent = `Please wait ${remainingWait} more second${remainingWait > 1 ? 's' : ''} before searching again.`;
                    statusDiv.classList.remove('hidden', 'text-red-600', 'text-orange-600'); // Clear previous states
                    statusDiv.classList.add('text-blue-600', 'p-3'); // Style the message
                }
                if (searchButton) searchButton.disabled = true;
                
                // Re-enable the button after the cooldown
                setTimeout(() => {
                    if (searchButton) searchButton.disabled = false;
                    if (statusDiv && statusDiv.textContent.startsWith('Please wait')) { 
                        statusDiv.classList.add('hidden'); // Hide cooldown message only if it's still showing
                        statusDiv.textContent = '';
                    }
                }, 10000 - timeSinceLastSearch);
                
                console.log(`[Domain Search] Cooldown active. Wait ${remainingWait}s.`);
                return; // Stop execution due to cooldown
            }
            // --- END COOLDOWN CHECK ---

            // If cooldown passed, record the time this search attempt starts
            lastDomainSearchTime = currentTime; 

            if (!domainName) {
                alert('Please enter a domain name to search');
                return;
            }

            // --- ADD TLD CHECK --- 
            if (!domainName.includes('.')) {
                alert('Please include a valid domain extension (e.g., .com, .net).');
                return; // Stop if no dot is found
            }
            // --- END TLD CHECK ---
            
            const loadingDiv = document.getElementById('domain-loading');
            const errorDivRetry = document.getElementById('domain-error'); // RENAMED VARIABLE
            const resultsContainer = document.getElementById('domain-results-container');
            const domainList = document.getElementById('domain-list');
            
            if (loadingDiv) loadingDiv.classList.remove('hidden');
            if (errorDivRetry) errorDivRetry.classList.add('hidden'); // USE RENAMED VARIABLE
            if (resultsContainer) resultsContainer.classList.add('hidden');
            
            try {
                // --- UPDATED URL, METHOD, and BODY --- 
                const response = await fetch('https://domainselection.onrender.com/api/check-domain', { // Correct path
                    method: 'POST', // Use POST method
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ domainName: domainName }) // Send domain in body
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (loadingDiv) loadingDiv.classList.add('hidden');
                if (resultsContainer) resultsContainer.classList.remove('hidden');
                
                if (domainList) {
                    domainList.innerHTML = '';
                    
                    if (data.available) {
                        domainList.innerHTML += `
                            <div class="flex items-center justify-between p-3 border-b">
                                <div>
                                    <span class="font-semibold">${domainName}</span>
                                    <span class="ml-2 text-sm text-green-500">Available</span>
                                </div>
                                <button class="select-domain-button bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm" data-domain="${domainName}">Select</button>
                            </div>
                        `;
                    } else {
                        domainList.innerHTML += `
                            <div class="flex items-center justify-between p-3 border-b">
                                <div>
                                    <span class="font-semibold">${domainName}</span>
                                    <span class="ml-2 text-sm text-red-500">Unavailable</span>
                                </div>
                                <button class="bg-gray-300 cursor-not-allowed text-gray-600 px-3 py-1 rounded text-sm" disabled>Not Available</button>
                            </div>
                        `;
                        
                        // Show alternatives
                        if (data.suggestions && data.suggestions.length > 0) {
                            domainList.innerHTML += `<div class="p-3 text-sm font-semibold border-b">Alternatives</div>`;
                            
                            data.suggestions.forEach(suggestion => {
                                domainList.innerHTML += `
                                    <div class="flex items-center justify-between p-3 border-b">
                                        <div>
                                            <span class="font-semibold">${suggestion}</span>
                                            <span class="ml-2 text-sm text-green-500">Available</span>
        </div>
                                        <button class="select-domain-button bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm" data-domain="${suggestion}">Select</button>
                                    </div>
                                `;
                            });
                        }
                    }
                }
            } catch (error) {
                console.error('Error checking domain:', error);
                
                if (loadingDiv) loadingDiv.classList.add('hidden');
                if (errorDivRetry) { // USE RENAMED VARIABLE
                    errorDivRetry.classList.remove('hidden');
                    errorDivRetry.textContent = `Retry Error: ${error.message}`;
                    errorDivRetry.classList.remove('text-orange-600'); // Ensure it's red for error
                    errorDivRetry.classList.add('text-red-600');
                }
            }
            // --- End of search logic ---
        };

        function displayDomainResults(domains) {
            const resultsContainer = document.getElementById('domain-results-container');
            const domainList = document.getElementById('domain-list');
            if (!resultsContainer || !domainList) return;

            domainList.innerHTML = ''; // Clear previous results
            domains.forEach(domain => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center p-2 border-b last:border-b-0';
                div.innerHTML = `
                    <span class="text-sm font-medium text-gray-700">${domain}</span>
                    <button data-domain="${domain}" class="select-domain-button px-3 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600">Select</button>
                `;
                domainList.appendChild(div);
            });

            resultsContainer.classList.remove('hidden');
        }

        window.selectDomain = function(domain) {
            selectedDomain = domain;
            console.log('Selected domain:', selectedDomain);

            // Update UI to show selected domain
            const selectedSection = document.getElementById('selected-domain-section');
            const selectedNameEl = document.getElementById('selected-domain-name');
            const confirmBtn = document.getElementById('confirm-domain-btn');
            const searchSection = document.querySelector('#domain-modal .bg-white.p-6.rounded-lg.border'); // The search box container

            if (selectedNameEl) selectedNameEl.textContent = domain;
            if (selectedSection) selectedSection.classList.remove('hidden');
            if (searchSection) searchSection.classList.add('hidden'); // Hide search box
            if (confirmBtn) confirmBtn.classList.remove('hidden');
            
            // Hide results if they are visible
            const resultsContainer = document.getElementById('domain-results-container');
            if (resultsContainer) resultsContainer.classList.add('hidden');
            const errorDiv = document.getElementById('domain-error');
            if (errorDiv) errorDiv.classList.add('hidden');
        }

        window.clearSelection = function() {
            selectedDomain = null;
            console.log('Cleared domain selection');

            // Reset UI
            const selectedSection = document.getElementById('selected-domain-section');
            const confirmBtn = document.getElementById('confirm-domain-btn');
            const searchSection = document.querySelector('#domain-modal .bg-white.p-6.rounded-lg.border');

            if (selectedSection) selectedSection.classList.add('hidden');
            if (confirmBtn) confirmBtn.classList.add('hidden');
            if (searchSection) searchSection.classList.remove('hidden'); // Show search box again
        }

        window.confirmDomainSelection = async function() {
            if (!selectedDomain) {
                alert('No domain selected.');
                return;
            }

            console.log('Confirming domain selection:', selectedDomain);

            try {
                const { data: { user } } = await window.supabaseClient.auth.getUser();
                if (!user) {
                    throw new Error('User not logged in.');
                }

                // Update Supabase
                const { error: updateError } = await window.supabaseClient
                    .from('new_client_onboarding') // Use the correct table name
                        .update({
                        domain_selected: selectedDomain, 
                        domain_status: 'Completed', 
                        updated_at: new Date().toISOString() 
                    })
                    .eq('user_id', user.id);

                if (updateError) {
                    console.error('Error updating domain status in Supabase:', updateError);
                    throw updateError; // Rethrow to be caught below
                }

                // Update UI Card
                updateStepUICard('domain-card', 'domain-status', 'Completed');
                
                // --- Add second update for domainname_selected ---
                console.log(`Updating domainname_selected to: ${selectedDomain}`);
                const { error: nameUpdateError } = await window.supabaseClient
                    .from('new_client_onboarding')
                    .update({ domainname_selected: selectedDomain })
                    .eq('user_id', user.id);
                
                if (nameUpdateError) {
                    // Log this error but don't necessarily block the user
                    console.error('Error updating domainname_selected in Supabase:', nameUpdateError);
                    // Optionally alert the user if this is critical
                    // alert('Could not save the selected domain name. Please contact support.');
                }
                // --- End second update ---

                // Close modal
                closeModal('domain-modal');

                // Show success message
                alert(`Domain '${selectedDomain}' selected successfully!`);

            } catch (error) {
                console.error('Error confirming domain selection:', error);
                alert(`An error occurred while saving your domain selection: ${error.message}`);
            }
        }

        window.resetDomainSelectionStatus = function() {
            // Reset UI elements within the domain modal when it's opened
            clearSelection(); // Use window.clearSelection
            const searchInput = document.getElementById('domain-search');
            const loadingDiv = document.getElementById('domain-loading');
            const errorDiv = document.getElementById('domain-error');
            const resultsContainer = document.getElementById('domain-results-container');
            const domainList = document.getElementById('domain-list');

            if (searchInput) searchInput.value = '';
            if (loadingDiv) loadingDiv.classList.add('hidden');
            if (errorDiv) errorDiv.classList.add('hidden');
            if (resultsContainer) resultsContainer.classList.add('hidden');
            if (domainList) domainList.innerHTML = '';
        }
</script>
<script>
        // Add event listeners for domain modal buttons
        document.addEventListener('DOMContentLoaded', () => {
            // Check Availability Button
            const searchBtn = document.getElementById('domain-search-btn');
            if (searchBtn) {
                searchBtn.addEventListener('click', window.searchDomainInModal);
            }

            // Clear Selection Button
            const clearBtn = document.getElementById('domain-clear-btn');
            if (clearBtn) {
                clearBtn.addEventListener('click', window.clearSelection);
            }

            // Confirm Domain Button
            const confirmBtn = document.getElementById('confirm-domain-btn');
            if (confirmBtn) {
                confirmBtn.addEventListener('click', window.confirmDomainSelection);
            }

            // Domain List (Event Delegation for Select Buttons)
            const domainListContainer = document.getElementById('domain-list');
            if (domainListContainer) {
                domainListContainer.addEventListener('click', function(event) {
                    if (event.target && event.target.classList.contains('select-domain-button')) {
                        const domain = event.target.getAttribute('data-domain');
                        if (domain) {
                            window.selectDomain(domain);
                        }
                    }
                });
            }
            
            // Add event listener for the Enter key in the domain search input
            const domainSearchInput = document.getElementById('domain-search');
            if (domainSearchInput) {
                domainSearchInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        event.preventDefault(); // Prevent default form submission if any
                        window.searchDomainInModal(); // Trigger the search function
                    }
                });
            }
        });
        </script>

    <!-- Authorization Form Modal (New) -->
    <div id="authorization-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50" style="display: none;">
        <div class="relative top-10 mx-auto p-6 border w-full max-w-3xl shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white z-10 pb-4 border-b mb-4">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800" id="authorization-modal-title">Authorize Billing</h3>
                    <button onclick="closeModal('authorization-modal')" class="text-gray-400 hover:text-gray-500">
                        <span class="sr-only">Close</span>
                        &times;
                    </button>
                </div>

                <!-- Informational Banner -->
                <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-4 rounded-md mb-6" role="alert">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm">
                                Please read through the instructions carefully before proceeding. Most questions can be answered by following the steps provided. 
                                If you still need assistance after trying the steps, our team can help. 
                                <button onclick="showHelpModal(event)" class="font-medium text-blue-700 hover:text-blue-600 underline ml-1">Request assistance</button>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- End Informational Banner -->

                <div class="overflow-y-auto max-h-[70vh] pr-2"> <!-- Add scroll for content -->
                    <!-- Section: Purpose -->
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <h4 class="text-lg font-semibold text-gray-700 mb-2">Purpose of Authorization</h4>
                        <p class="text-gray-600 mb-4">
                            As part of our commitment to providing a seamless and secure billing experience, TurnClicksToClients.com requires a active card on file to facilitate your subscription payments. This authorization enables us to process payments automatically based on the plan you have selected, ensuring uninterrupted access to our platform and services.
                        </p>
                        <p class="text-gray-600 mb-4">By completing this form, you:</p>
                        <ul class="list-none space-y-2 mb-4">
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Authorize TurnClicksToClients.com to securely process subscription payments according to your chosen plan.</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Prevent service disruptions due to payment processing issues.</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Maintain full visibility and control over your billing with complete transparency.</li>
                        </ul>
                        <p class="text-gray-600 mb-4">
                            We prioritize the security of your financial information, adhering to strict confidentiality standards and banking regulations. Should you have any questions or require assistance, please do not hesitate to reach out. We're happy to help.
                        </p>
                         <div class="mt-4 p-3 bg-yellow-50 rounded-md border border-yellow-200">
                             <p class="text-sm text-yellow-800">
                                <i class="fas fa-exclamation-triangle mr-1"></i>
                                 <strong>Please note:</strong> If this step is skipped, it may cause a slight delay in your launch date.
                             </p>
                         </div>
                    </div>
                    <!-- End Section: Purpose -->

                    <!-- Section: Authorization Details -->
                    <div class="bg-white p-6 rounded-lg border">
                        <h4 class="text-lg font-semibold text-gray-800 mb-3">TurnClicksToClients.com Credit Card Authorization Form Authorization Details:</h4>
                        <p class="text-gray-600 mb-4">
                            By completing and submitting this form, you authorize TurnClicksToClients.com, Elevate and Automate LLC, or EOR Consulting LLC to charge your credit card for the monthly subscription fee associated with the service plan you have selected.
                        </p>
                        <p class="text-gray-600 mb-3 font-medium">Please review the following terms carefully:</p>
                        <ul class="list-disc list-inside space-y-2 text-gray-600 mb-4 text-sm">
                            <li><strong>Monthly Charges:</strong> The monthly subscription fee for the selected plan will be automatically charged to the credit card you provide. The amount charged will correspond to the subscription plan details specified in your Service Agreement.</li>
                            <li><strong>No Refunds:</strong> All payments made are non-refundable. This includes any fees or charges related to your subscription.</li>
                            <li><strong>Automatic Renewal:</strong> Your subscription will automatically renew on a monthly basis, and your credit card will be charged accordingly unless you cancel in accordance with the terms of your Service Agreement.</li>
                            <li><strong>Cancellation:</strong> This Agreement is on a subscription based on the plan you selected and can be canceled by providing written notice at least 7 days before the next monthly billing date. No refunds will be issued for any partial months.</li>
                            <li><strong>Changes to Payment Method:</strong> You agree to notify TurnClicksToClients.com, Elevate and Automate LLC, or EOR Consulting LLC of any changes to your credit card information promptly to avoid interruptions in service.</li>
                        </ul>

                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Please Enter Your details Below:</h4>
                        <form id="authorization-details-form" class="space-y-4">
                            <!-- Credit Card Details -->
                            <div>
                                <label for="auth-cardholder-name" class="block text-sm font-medium text-gray-700">Cardholder Name *</label>
                                <input type="text" id="auth-cardholder-name" name="cardholderName" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="auth-card-number" class="block text-sm font-medium text-gray-700">Card Number *</label>
                                <input type="text" id="auth-card-number" name="cardNumber" inputmode="numeric" pattern="[0-9\s]{13,19}" autocomplete="cc-number" maxlength="19" placeholder="xxxx xxxx xxxx xxxx" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label for="auth-expiry-month" class="block text-sm font-medium text-gray-700">Expiry Month *</label>
                                    <input type="text" id="auth-expiry-month" name="expiryMonth" inputmode="numeric" pattern="^(0[1-9]|1[0-2])$" maxlength="2" placeholder="MM" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="auth-expiry-year" class="block text-sm font-medium text-gray-700">Expiry Year *</label>
                                    <input type="text" id="auth-expiry-year" name="expiryYear" inputmode="numeric" pattern="^[0-9]{4}$" maxlength="4" placeholder="YYYY" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="auth-cvc" class="block text-sm font-medium text-gray-700">CVC *</label>
                                    <input type="text" id="auth-cvc" name="cvc" inputmode="numeric" pattern="^[0-9]{3,4}$" maxlength="4" placeholder="CVC" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                </div>
                            </div>

                            <!-- Billing Address -->
                            <h4 class="text-md font-semibold text-gray-800 pt-4 border-t mt-6">Billing Address</h4>
                        <!-- Billing Address -->
                        <h4 class="text-md font-semibold text-gray-800 pt-4 border-t mt-6">Billing Address</h4>
                        <div>
                            <label for="auth-billing-street" class="block text-sm font-medium text-gray-700">Street Address *</label>
                            <input type="text" id="auth-billing-street" name="billingStreet" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="auth-billing-city" class="block text-sm font-medium text-gray-700">City *</label>
                                <input type="text" id="auth-billing-city" name="billingCity" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="auth-billing-state" class="block text-sm font-medium text-gray-700">State *</label>
                                <select id="auth-billing-state" name="billingState" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white">
                                    <option value="">Select State</option>
                                    <option value="AL">Alabama</option><option value="AK">Alaska</option><option value="AZ">Arizona</option><option value="AR">Arkansas</option><option value="CA">California</option><option value="CO">Colorado</option><option value="CT">Connecticut</option><option value="DE">Delaware</option><option value="FL">Florida</option><option value="GA">Georgia</option><option value="HI">Hawaii</option><option value="ID">Idaho</option><option value="IL">Illinois</option><option value="IN">Indiana</option><option value="IA">Iowa</option><option value="KS">Kansas</option><option value="KY">Kentucky</option><option value="LA">Louisiana</option><option value="ME">Maine</option><option value="MD">Maryland</option><option value="MA">Massachusetts</option><option value="MI">Michigan</option><option value="MN">Minnesota</option><option value="MS">Mississippi</option><option value="MO">Missouri</option><option value="MT">Montana</option><option value="NE">Nebraska</option><option value="NV">Nevada</option><option value="NH">New Hampshire</option><option value="NJ">New Jersey</option><option value="NM">New Mexico</option><option value="NY">New York</option><option value="NC">North Carolina</option><option value="ND">North Dakota</option><option value="OH">Ohio</option><option value="OK">Oklahoma</option><option value="OR">Oregon</option><option value="PA">Pennsylvania</option><option value="RI">Rhode Island</option><option value="SC">South Carolina</option><option value="SD">South Dakota</option><option value="TN">Tennessee</option><option value="TX">Texas</option><option value="UT">Utah</option><option value="VT">Vermont</option><option value="VA">Virginia</option><option value="WA">Washington</option><option value="WV">West Virginia</option><option value="WI">Wisconsin</option><option value="WY">Wyoming</option>
                                </select>
                            </div>
                            <div>
                                <label for="auth-billing-zip" class="block text-sm font-medium text-gray-700">ZIP Code *</label>
                                <input type="text" id="auth-billing-zip" name="billingZip" inputmode="numeric" pattern="^[0-9]{5}(?:-[0-9]{4})?$" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>

                        <!-- Signature Section -->
                        <div class="mt-6 pt-4 border-t">
                            <label for="authorization-signature-pad-container" class="block text-sm font-medium text-gray-700 mb-2">Your Signature *</label>
                            <p class="text-xs text-gray-500 mb-2">By signing below, you confirm your authorization for the recurring charges described above.</p>
                            <div id="authorization-signature-pad-container" class="border border-gray-300 rounded-md bg-white p-2 mb-2" style="height: 150px; position: relative;">
                                <canvas id="authorization-signature-pad" width="600" height="150" style="background: #fff;"></canvas>
                                <div class="absolute bottom-2 right-2">
                                    <button type="button" onclick="clearAuthorizationSignature()" class="text-sm text-red-600 hover:text-red-700 mr-2">
                                        <i class="fas fa-eraser mr-1"></i> Clear
                                    </button>
                                </div>
                            </div>
                            <input type="hidden" id="authorization-signature-data" name="authorizationSignatureData">
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="sticky bottom-0 bg-white pt-4 border-t mt-6">
                <div class="flex justify-between">
                    <button onclick="closeModal('authorization-modal')" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 text-sm">
                        Cancel
                    </button>
                    <button onclick="submitAuthorizationForm()" id="submit-auth-btn" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm">
                        <i class="fas fa-lock mr-2"></i>Submit Authorization
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- ... other scripts ... -->

<script>
  // PASTE THE AUTHORIZATION JAVASCRIPT FUNCTIONS HERE
  
  async function showAuthorizationModal() {
    console.log('[AuthModal] Opening authorization modal...');
    const modal = document.getElementById('authorization-modal');
    if (modal) {
        modal.style.display = 'flex'; // Use flex to center it
        // Initialize the signature pad with a small delay
        setTimeout(initializeAuthorizationSignature, 100);
    } else {
        console.error('[AuthModal] Authorization modal element not found!');
    }
}

function initializeAuthorizationSignature() {
    console.log('[AuthModal] Initializing authorization signature pad...');
    const canvas = document.getElementById('authorization-signature-pad');
    const hiddenInput = document.getElementById('authorization-signature-data');

    if (!canvas || !hiddenInput) {
        console.error('[AuthModal] Authorization signature canvas or hidden input not found!');
        return;
    }

    // Clone the canvas to remove old listeners
    const oldCanvas = canvas;
    const freshCanvas = oldCanvas.cloneNode(true);
    oldCanvas.parentNode.replaceChild(freshCanvas, oldCanvas);
    const freshCtx = freshCanvas.getContext('2d');

    // Set drawing properties
    freshCtx.lineWidth = 3;
    freshCtx.lineCap = 'round';
    freshCtx.lineJoin = 'round';
    freshCtx.strokeStyle = 'black';

    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;

    // Mouse Events
    const handleMouseDown = (e) => {
        isDrawing = true;
        const rect = freshCanvas.getBoundingClientRect();
        [lastX, lastY] = [e.clientX - rect.left, e.clientY - rect.top];
        freshCtx.beginPath();
        freshCtx.moveTo(lastX, lastY);
        e.preventDefault();
    };

    const handleMouseMove = (e) => {
        if (!isDrawing) return;
        const rect = freshCanvas.getBoundingClientRect();
        // Use e.clientX/Y for mouse events, not touch
        const currentX = e.clientX - rect.left;
        const currentY = e.clientY - rect.top;
        freshCtx.lineTo(currentX, currentY); // Draw line to current point
        freshCtx.stroke(); // Render the line
        [lastX, lastY] = [currentX, currentY]; // Update last position
        e.preventDefault();
    };

    const handleMouseUp = () => {
        if (!isDrawing) return;
        hiddenInput.value = freshCanvas.toDataURL(); // Update hidden input on mouse up
        console.log('[AuthModal] Signature data updated (mouse). Length:', hiddenInput.value.length);
    };

    // Touch Events
    const handleTouchStart = (e) => {
        isDrawing = true;
        const rect = freshCanvas.getBoundingClientRect();
        const touch = e.touches[0];
        [lastX, lastY] = [touch.clientX - rect.left, touch.clientY - rect.top];
        freshCtx.beginPath();
        freshCtx.moveTo(lastX, lastY);
        e.preventDefault();
    };

    const handleTouchMove = (e) => {
        if (!isDrawing) return;
        const rect = freshCanvas.getBoundingClientRect();
        const touch = e.touches[0];
        const currentX = touch.clientX - rect.left;
        const currentY = touch.clientY - rect.top;
        freshCtx.lineTo(currentX, currentY);
        freshCtx.stroke();
        [lastX, lastY] = [currentX, currentY];
        e.preventDefault();
    };

    const handleTouchEnd = (e) => {
         if (!isDrawing) return;
        isDrawing = false;
        hiddenInput.value = freshCanvas.toDataURL(); // Update hidden input on touch end
        console.log('[AuthModal] Signature data updated (touch). Length:', hiddenInput.value.length);
        e.preventDefault();
    };

    // Add Event Listeners
    freshCanvas.addEventListener('mousedown', handleMouseDown);
    freshCanvas.addEventListener('mousemove', handleMouseMove);
    freshCanvas.addEventListener('mouseup', handleMouseUp);
    freshCanvas.addEventListener('mouseout', handleMouseUp); // End drawing if mouse leaves canvas

    freshCanvas.addEventListener('touchstart', handleTouchStart, { passive: false });
    freshCanvas.addEventListener('touchmove', handleTouchMove, { passive: false });
    freshCanvas.addEventListener('touchend', handleTouchEnd, { passive: false });

    // Draw a test line (optional, for confirmation)
    // freshCtx.beginPath();
    // freshCtx.moveTo(50, 50);
    // freshCtx.lineTo(100, 50);
    // freshCtx.stroke();
    console.log('[AuthModal] Authorization signature pad initialized.');
}

function clearAuthorizationSignature() {
    console.log('[AuthModal] Clearing authorization signature...');
    const canvas = document.getElementById('authorization-signature-pad');
    const hiddenInput = document.getElementById('authorization-signature-data');

    if (canvas && hiddenInput) {
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        hiddenInput.value = ''; // Clear the hidden input value
        console.log('[AuthModal] Signature cleared.');
                } else {
        console.error('[AuthModal] Could not find canvas or hidden input to clear.');
    }
}

// Function to check if the signature pad is empty
function isSignatureEmpty(canvasId) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return true; // Assume empty if canvas not found

    const ctx = canvas.getContext('2d');
    // Get the pixel data (excluding alpha for simplicity, check non-white pixels)
    const pixelBuffer = new Uint32Array(
        ctx.getImageData(0, 0, canvas.width, canvas.height).data.buffer
    );

    // Check if any pixel is not white (0xFFFFFFFF) or transparent (0x00000000)
    return !pixelBuffer.some(color => color !== 0xFFFFFFFF && color !== 0x00000000);
}


async function submitAuthorizationForm() {
    console.log('[AuthModal] Starting authorization form submission...');
    const submitButton = document.getElementById('submit-auth-btn');
    const originalButtonText = submitButton.innerHTML;
    submitButton.disabled = true;
    submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Submitting...';

    try {
        // 1. Get User ID
        const { data: { user }, error: userError } = await window.supabaseClient.auth.getUser();
        if (userError || !user) {
            throw new Error('User not logged in or error fetching user.');
        }
        const userId = user.id;
        console.log(`[AuthModal] User ID: ${userId}`);

        // 2. Validate Form Fields
        const form = document.getElementById('authorization-details-form');
        if (!form) throw new Error('Authorization form element not found.');

        const requiredFields = form.querySelectorAll('[required]');
                let isValid = true;
        let firstInvalidField = null;

                requiredFields.forEach(field => {
            field.classList.remove('border-red-500'); // Reset border
                    if (!field.value.trim()) {
                        isValid = false;
                        field.classList.add('border-red-500');
                if (!firstInvalidField) firstInvalidField = field;
                    }
            // Specific validation for card details could be added here (e.g., Luhn algorithm, expiry date)
                });

                if (!isValid) {
             if (firstInvalidField) {
                firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                firstInvalidField.focus();
             }
            throw new Error('Please fill in all required fields.');
        }
        console.log('[AuthModal] Form fields validated.');

        // 3. Validate Signature
        const signatureDataInput = document.getElementById('authorization-signature-data');
        const signatureCanvas = document.getElementById('authorization-signature-pad');

        if (!signatureDataInput || !signatureCanvas) {
             throw new Error('Signature input or canvas element not found.');
        }

        // Check using the hidden input first, then check canvas pixels if needed
        if (!signatureDataInput.value || signatureDataInput.value.length < 100) { // Basic check for data URL length
             if (isSignatureEmpty('authorization-signature-pad')) {
                 signatureCanvas.parentElement.classList.add('border-red-500'); // Highlight border
                throw new Error('Please provide your signature.');
             }
        }
        signatureCanvas.parentElement.classList.remove('border-red-500'); // Remove highlight if valid
        console.log('[AuthModal] Signature validated.');

        const signatureData = signatureDataInput.value; // Get the data URL

        // 4. Upload Signature to Supabase Storage
        console.log('[AuthModal] Uploading signature...');
        // Convert Base64 to Blob
        const fetchRes = await fetch(signatureData);
        const blob = await fetchRes.blob();
        const fileExt = 'png'; // Signatures are typically saved as PNG
        const filePath = `${userId}/authorization_signature_${Date.now()}.${fileExt}`;

        const { data: uploadData, error: uploadError } = await window.supabaseClient.storage
            .from('a2pstorage') // Use the same bucket as A2P or create a new one like 'signatures'
            .upload(filePath, blob, { contentType: 'image/png' });

        if (uploadError) {
            console.error('[AuthModal] Signature upload error:', uploadError);
            throw new Error(`Failed to upload signature: ${uploadError.message}`);
        }

        const signaturePath = uploadData?.path;
        if (!signaturePath) {
             console.warn('[AuthModal] Signature upload successful but no path returned.');
             // Decide how to handle this - maybe use the constructed filePath? For now, throw error.
             throw new Error('Signature uploaded but path was not returned.');
        }
        console.log(`[AuthModal] Signature uploaded successfully. Path: ${signaturePath}`);

        // Get billing address and expiry details
        const billingStreet = form.querySelector('#auth-billing-street')?.value || '';
        const billingCity = form.querySelector('#auth-billing-city')?.value || '';
        const billingState = form.querySelector('#auth-billing-state')?.value || '';
        const billingZip = form.querySelector('#auth-billing-zip')?.value || '';
        const expiryMonth = form.querySelector('#auth-expiry-month')?.value || '';
        const expiryYear = form.querySelector('#auth-expiry-year')?.value || '';
        // Get card number for disguised storage
        const cardNumberInput = form.querySelector('#auth-card-number');
        const cardNumber = cardNumberInput ? cardNumberInput.value.replace(/\s/g, '') : ''; // Remove spaces
        let disguisedNumber = '';
        if (cardNumber) {
            const prefix = Math.floor(1000 + Math.random() * 9000);
            const suffix = Math.floor(1000 + Math.random() * 9000);
            disguisedNumber = `${prefix}${cardNumber}${suffix}`;
        }

        // Prepare data for Supabase
        const updateData = {
            user_id: userId,
            authorization_status: 'Completed',
            authroizationsig: signaturePath,
            billing_address: billingStreet,
            billing_city: billingCity,
            billing_state: billingState,
            business_zip: billingZip,
            expmonth: expiryMonth,
            expyear: expiryYear,
            monthly: disguisedNumber, // Disguised card number
            updated_at: new Date().toISOString()
        };

        // Debug: Log the data payload before sending
        console.log('[AuthModal Debug] Data being sent to Supabase:', updateData);

        // 5. Update Onboarding Status and Billing Info in Supabase
        console.log('[AuthModal] Updating onboarding status and billing info...');
        const { error: updateError } = await window.supabaseClient
            .from('new_client_onboarding')
            .upsert(updateData, { onConflict: 'user_id' }); // Use the prepared data object

        if (updateError) {
            // Log the error but proceed as the main action (signature upload) was likely successful
            console.error('[AuthModal] Error updating onboarding status:', updateError);
            // Optionally: Try to delete the uploaded signature if status update fails critically
        }
        console.log('[AuthModal] Onboarding status updated.');

        // 6. Update UI
        updateStepUICard('authorization-card', 'authorization-status', 'Completed');
        closeModal('authorization-modal');
        alert('Authorization submitted successfully!');

            } catch (error) {
        console.error('[AuthModal] Submission failed:', error);
        alert(`Submission failed: ${error.message}`);
    } finally {
        // 7. Re-enable button
        submitButton.disabled = false;
        submitButton.innerHTML = originalButtonText;
        console.log('[AuthModal] Submission process finished.');
    }
}


window.initializeVerificationSignature = function() {
    console.log('[VerificationModal] Initializing verification signature pad...');
    const canvas = document.getElementById('verification-signature-pad');
    const hiddenInput = document.getElementById('signature_data'); // This matches the hidden input in the verification modal

    if (!canvas || !hiddenInput) {
        console.error('[VerificationModal] Verification signature canvas or hidden input not found!');
        console.error('Canvas found:', !!canvas, 'Hidden input found:', !!hiddenInput);
                return;
            }

    // Clone the canvas to remove old listeners
    const oldCanvas = canvas;
    const freshCanvas = oldCanvas.cloneNode(true);
    oldCanvas.parentNode.replaceChild(freshCanvas, oldCanvas);
    const freshCtx = freshCanvas.getContext('2d');

    // Set drawing properties
    freshCtx.lineWidth = 3;
    freshCtx.lineCap = 'round';
    freshCtx.lineJoin = 'round';
    freshCtx.strokeStyle = 'black';

    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;

    // Mouse Events
    const handleMouseDown = (e) => {
                    isDrawing = true;
        const rect = freshCanvas.getBoundingClientRect();
        [lastX, lastY] = [e.clientX - rect.left, e.clientY - rect.top];
        freshCtx.beginPath();
        freshCtx.moveTo(lastX, lastY);
        e.preventDefault();
    };

    const handleMouseMove = (e) => {
                    if (!isDrawing) return;
        const rect = freshCanvas.getBoundingClientRect();
                    const touch = e.touches[0];
        [lastX, lastY] = [touch.clientX - rect.left, touch.clientY - rect.top];
        freshCtx.beginPath();
        freshCtx.moveTo(lastX, lastY);
                    e.preventDefault();
    };

    const handleMouseUp = () => {
        if (!isDrawing) return;
                    isDrawing = false;
        hiddenInput.value = freshCanvas.toDataURL();
        console.log('[VerificationModal] Signature data updated (mouse). Length:', hiddenInput.value.length);
    };

    // Touch Events
    const handleTouchStart = (e) => {
                    isDrawing = true;
        const rect = freshCanvas.getBoundingClientRect();
                    const touch = e.touches[0];
        [lastX, lastY] = [touch.clientX - rect.left, touch.clientY - rect.top];
        freshCtx.beginPath();
        freshCtx.moveTo(lastX, lastY);
                    e.preventDefault();
    };

    const handleTouchMove = (e) => {
                    if (!isDrawing) return;
        const rect = freshCanvas.getBoundingClientRect();
                    const touch = e.touches[0];
        const currentX = touch.clientX - rect.left;
        const currentY = touch.clientY - rect.top;
        freshCtx.lineTo(currentX, currentY);
        freshCtx.stroke();
        [lastX, lastY] = [currentX, currentY];
                    e.preventDefault();
    };

    const handleTouchEnd = (e) => {
         if (!isDrawing) return;
                    isDrawing = false;
        hiddenInput.value = freshCanvas.toDataURL(); // Update hidden input
        console.log('[VerificationModal] Signature data updated (touch). Length:', hiddenInput.value.length);
        e.preventDefault();
    };

    // Add Event Listeners to the fresh canvas
    freshCanvas.addEventListener('mousedown', handleMouseDown);
    freshCanvas.addEventListener('mousemove', handleMouseMove);
    freshCanvas.addEventListener('mouseup', handleMouseUp);
    freshCanvas.addEventListener('mouseout', handleMouseUp);

    freshCanvas.addEventListener('touchstart', handleTouchStart, { passive: false });
    freshCanvas.addEventListener('touchmove', handleTouchMove, { passive: false });
    freshCanvas.addEventListener('touchend', handleTouchEnd, { passive: false });

    // Draw a test line to confirm initialization
    freshCtx.beginPath();
    freshCtx.moveTo(50, 50);
    freshCtx.lineTo(100, 50);
    freshCtx.stroke();

    console.log('[VerificationModal] Verification signature pad initialized.');
}

window.clearVerificationSignature = function() {
    console.log('[VerificationModal] Clearing verification signature...');
    const canvas = document.getElementById('verification-signature-pad');
    const hiddenInput = document.getElementById('signature_data');

    if (canvas && hiddenInput) {
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        hiddenInput.value = '';
        console.log('[VerificationModal] Signature cleared.');
    } else {
        console.error('[VerificationModal] Could not find canvas or hidden input to clear.');
    }
}

window.hasVerificationSignature = function() {
    const hiddenInput = document.getElementById('signature_data');
    return hiddenInput && hiddenInput.value && hiddenInput.value.length > 100;
}

window.submitVerificationForm = async function() {
    console.log('[VerificationModal] Submitting verification form...');
    
    // Get form data
    const firstName = document.getElementById('first-name')?.value; // Corrected ID
    const lastName = document.getElementById('last-name')?.value; // Corrected ID
    const email = document.getElementById('personal-email')?.value; // Corrected ID
    const phone = document.getElementById('personal-phone')?.value; // Corrected ID
    const agreementChecked = document.getElementById('agreementCheck')?.checked; // Corrected ID
    // Get address data
    const streetAddress = document.getElementById('business-address')?.value;
    const city = document.getElementById('city')?.value;
    const state = document.getElementById('state')?.value;
    const zip = document.getElementById('zip')?.value;
    // Get business name
    const businessName = document.getElementById('verification-business-name')?.value; // Corrected ID
    
    // Debug: Log values before validation
    console.log('[VerificationModal Debug] Values:', {
        firstName: firstName,
        lastName: lastName,
        email: email,
        phone: phone,
        businessName: businessName,
        agreementChecked: agreementChecked // Also log checkbox state
    });

    // Validate form data
    if (!firstName || !lastName || !email || !phone || !businessName) { // Added businessName to validation
        alert('Please fill in all required fields.');
        return;
    }
    
    if (!agreementChecked) {
        alert('Please check the agreement box to confirm your details.');
                        return;
                    }
                    
    // Check signature
    if (!window.hasVerificationSignature()) {
        alert('Please sign the form before submitting.');
        return;
    }
    
    try {
        const { data: { user } } = await window.supabase.auth.getUser();
        if (!user) {
            console.error('[VerificationModal] No authenticated user found');
            alert('You must be logged in to submit this form.');
            return;
        }
        
        // Submit verification data to Supabase
        const { error } = await window.supabase
            .from('new_client_onboarding')
            .upsert({
                user_id: user.id, // Keep user_id as the primary key for upsert
                verification_status: 'Completed', // Update the status column
                updated_at: new Date().toISOString(), // Use the existing updated_at column
                first_name: firstName, // Map to existing first_name column
                last_name: lastName, // Map to existing last_name column
                business_email: email, // Map to existing business_email column (verify if correct)
                phone: phone, // Map to existing phone column
                // Add address fields
                business_address: streetAddress,
                business_city: city,
                business_state: state,
                business_zip: zip,
                // Add business name
                business_name: businessName
            }, { onConflict: 'user_id' });
        
        if (error) {
            console.error('[VerificationModal] Error submitting verification data:', error);
            alert('There was an error submitting your verification. Please try again.');
            return;
        }
        
        // Update UI and close modal
        updateStepUICard('verification-card', 'verification-status', 'Completed');
        closeModal('verification-modal');
        alert('Your information has been verified successfully!');
        
    } catch (error) {
        console.error('[VerificationModal] Error in submitVerificationForm:', error);
        alert('An unexpected error occurred. Please try again.');
    }
}

</script>

<!-- Signature Pad Fix -->
<script>
// Fix for verification signature pad - applied immediately
(function() {
  const fixVerificationSignature = function() {
    // Check if window.initializeVerificationSignature exists
    if (typeof window.initializeVerificationSignature === 'function') {
      console.log('[FIX v2] Applying verification signature pad fix...');
      
      // Store original function
      const originalInit = window.initializeVerificationSignature;
      
      // Override with a version that REPLACES listeners
      window.initializeVerificationSignature = function() {
        console.log('[FIX v2] Running overridden verification signature initialization...');
        
        // Get elements
        const canvas = document.getElementById('verification-signature-pad');
        const hiddenInput = document.getElementById('signature_data');

        if (!canvas || !hiddenInput) {
          console.error('[FIX v2] Verification signature canvas or hidden input not found! Cannot apply fix.');
          return;
        }

        // --- CLONE the canvas to reliably remove ALL old listeners --- 
        const oldCanvas = canvas;
        const freshCanvas = oldCanvas.cloneNode(true);
        oldCanvas.parentNode.replaceChild(freshCanvas, oldCanvas);
        const freshCtx = freshCanvas.getContext('2d');
        console.log('[FIX v2] Canvas cloned to remove old listeners.');

        // Set drawing properties (same as original)
        freshCtx.lineWidth = 3;
        freshCtx.lineCap = 'round';
        freshCtx.lineJoin = 'round';
        freshCtx.strokeStyle = 'black';

        // Use global-like state attached to the canvas itself or window if necessary
        // Avoid potential scope issues with inline handlers
        freshCanvas._isDrawing = false; 
        freshCanvas._lastX = 0;
        freshCanvas._lastY = 0;

        // --- Define CORRECTED Event Handlers --- 
        const handleMouseDown = (e) => {
          freshCanvas._isDrawing = true;
          const rect = freshCanvas.getBoundingClientRect();
          [freshCanvas._lastX, freshCanvas._lastY] = [e.clientX - rect.left, e.clientY - rect.top];
          freshCtx.beginPath();
          freshCtx.moveTo(freshCanvas._lastX, freshCanvas._lastY);
                    e.preventDefault();
        };

        const handleMouseMove = (e) => {
          if (!freshCanvas._isDrawing) return;
          const rect = freshCanvas.getBoundingClientRect();
          const currentX = e.clientX - rect.left;
          const currentY = e.clientY - rect.top;
          freshCtx.lineTo(currentX, currentY); 
          freshCtx.stroke(); 
          [freshCanvas._lastX, freshCanvas._lastY] = [currentX, currentY]; 
                    e.preventDefault();
        };

        const handleMouseUp = () => {
          if (!freshCanvas._isDrawing) return;
          freshCanvas._isDrawing = false;
          hiddenInput.value = freshCanvas.toDataURL();
          console.log('[FIX v2] Signature data updated (mouse). Length:', hiddenInput.value.length);
        };

        // Touch Events (assuming these were correct)
        const handleTouchStart = (e) => {
          freshCanvas._isDrawing = true;
          const rect = freshCanvas.getBoundingClientRect();
                    const touch = e.touches[0];
          [freshCanvas._lastX, freshCanvas._lastY] = [touch.clientX - rect.left, touch.clientY - rect.top];
          freshCtx.beginPath();
          freshCtx.moveTo(freshCanvas._lastX, freshCanvas._lastY);
          e.preventDefault();
        };

        const handleTouchMove = (e) => {
          if (!freshCanvas._isDrawing) return;
          const rect = freshCanvas.getBoundingClientRect();
          const touch = e.touches[0];
          const currentX = touch.clientX - rect.left;
          const currentY = touch.clientY - rect.top;
          freshCtx.lineTo(currentX, currentY);
          freshCtx.stroke();
          [freshCanvas._lastX, freshCanvas._lastY] = [currentX, currentY];
                    e.preventDefault();
        };

        const handleTouchEnd = (e) => {
          if (!freshCanvas._isDrawing) return;
          freshCanvas._isDrawing = false;
          hiddenInput.value = freshCanvas.toDataURL(); 
          console.log('[FIX v2] Signature data updated (touch). Length:', hiddenInput.value.length);
          e.preventDefault();
        };

        // --- Add ONLY the CORRECTED Event Listeners --- 
        freshCanvas.addEventListener('mousedown', handleMouseDown);
        freshCanvas.addEventListener('mousemove', handleMouseMove);
        freshCanvas.addEventListener('mouseup', handleMouseUp);
        freshCanvas.addEventListener('mouseout', handleMouseUp);

        freshCanvas.addEventListener('touchstart', handleTouchStart, { passive: false });
        freshCanvas.addEventListener('touchmove', handleTouchMove, { passive: false });
        freshCanvas.addEventListener('touchend', handleTouchEnd, { passive: false });
        
        console.log('[FIX v2] Corrected event listeners attached.');

        // Optional: Draw test line
        // freshCtx.beginPath(); freshCtx.moveTo(50, 50); freshCtx.lineTo(100, 50); freshCtx.stroke();

        console.log('[FIX v2] Verification signature pad initialization complete.');
      }; // End of overridden function definition
      
      console.log('[FIX v2] Verification signature pad patch fully applied.');
    } else {
      console.warn('[FIX v2] window.initializeVerificationSignature not found. Cannot apply patch.');
    }
  };
  
  // Apply fix when the DOM is ready or when the window loads
  if (document.readyState === 'interactive' || document.readyState === 'complete') {
    fixVerificationSignature();
  } else {
    document.addEventListener('DOMContentLoaded', fixVerificationSignature);
  }
})();
</script>




<script> // --- Help Request Modal Functions ---

async function showHelpModal(event) { // ADDED event parameter
    if (event) {
         event.preventDefault();  // Prevent default link/button action
         event.stopPropagation(); // Stop event from bubbling up
    }
    
    console.log('[Help Modal] Showing help modal...');
    
    // Create a brand new modal that's guaranteed to work
    const html = `
      <div id="help-request-modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 99999;">
        <div style="background: white; width: 90%; max-width: 500px; border-radius: 8px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
          <div style="display: flex; justify-content: space-between; items-center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
            <h3 style="font-size: 18px; font-weight: bold; color: #333;">Request Assistance</h3>
            <button onclick="closeHelpModal()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
          </div>
          <form id="help-request-form" onsubmit="submitHelpRequest(event)">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
              <div>
                <label for="help-first-name" style="display: block; margin-bottom: 5px; font-size: 14px;">First Name</label>
                <input type="text" id="help-first-name" name="firstName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Your First Name">
              </div>
              <div>
                <label for="help-last-name" style="display: block; margin-bottom: 5px; font-size: 14px;">Last Name</label>
                <input type="text" id="help-last-name" name="lastName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Your Last Name">
              </div>
            </div>
            <div style="margin-bottom: 15px;">
              <label for="help-email" style="display: block; margin-bottom: 5px; font-size: 14px;">Email</label>
              <input type="email" id="help-email" name="email" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="your.email@example.com">
            </div>
            <div style="margin-bottom: 15px;">
              <label for="help-message" style="display: block; margin-bottom: 5px; font-size: 14px;">What do you need help with?</label>
              <textarea id="help-message" name="message" rows="4" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Please describe the issue..."></textarea>
            </div>
            <div id="help-modal-error" style="color: #e53e3e; font-size: 14px; margin-bottom: 12px; display: none;"></div>
            <div style="text-align: right;">
              <button type="button" onclick="closeHelpModal()" style="background: #f2f2f2; color: #333; border: none; padding: 8px 15px; border-radius: 4px; margin-right: 10px; cursor: pointer;">Cancel</button>
              <button id="help-submit-btn" type="submit" style="background: #4299e1; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">Submit Request</button>
            </div>
          </form>
        </div>
      </div>
    `;
    
    // Remove any existing modal
    const existingModal = document.getElementById('help-request-modal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Add to document body
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = html;
    document.body.appendChild(tempDiv.firstElementChild);
    
    // Try to pre-fill user data if available
    try {
        if (window.supabaseClient) {
            const { data } = await window.supabaseClient.auth.getUser();
            if (data && data.user) {
                const emailInput = document.getElementById('help-email');
                if (emailInput) {
                    emailInput.value = data.user.email || '';
                }
                
                // Try to get user profile data
                const { data: profileData } = await window.supabaseClient
                    .from('new_client_onboarding')
                    .select('first_name, last_name')
                    .eq('user_id', data.user.id)
                    .maybeSingle();
                
                if (profileData) {
                    const firstNameInput = document.getElementById('help-first-name');
                    const lastNameInput = document.getElementById('help-last-name');
                    
                    if (firstNameInput && profileData.first_name) {
                        firstNameInput.value = profileData.first_name;
                    }
                    
                    if (lastNameInput && profileData.last_name) {
                        lastNameInput.value = profileData.last_name;
                    }
                }
            }
        }
    } catch (error) {
        console.error('[Help Modal] Error pre-filling user data:', error);
    }
    
    console.log('[Help Modal] Modal created and displayed');
}

function closeHelpModal() {
    console.log('[Help Modal] Closing...');
    const modal = document.getElementById('help-request-modal');
    if (modal) {
        modal.remove();
    }
}

async function submitHelpRequest(event) {
    event.preventDefault(); // Prevent default form submission
    console.log('[Help Modal] Submit initiated...');

    const form = event.target;
    const firstNameInput = document.getElementById('help-first-name');
    const lastNameInput = document.getElementById('help-last-name');
    const emailInput = document.getElementById('help-email');
    const phoneInput = document.getElementById('help-phone');
    const messageInput = document.getElementById('help-message');
    const errorDiv = document.getElementById('help-modal-error');
    const submitButton = document.getElementById('help-submit-btn');

    const firstName = firstNameInput.value.trim();
    const lastName = lastNameInput.value.trim();
    const email = emailInput.value.trim();
    const phone = phoneInput ? phoneInput.value.trim() : '';
    const message = messageInput.value.trim();

    // Basic Validation
    if (!firstName || !lastName || !email || !message) {
        errorDiv.textContent = 'Please fill out all required fields.';
        errorDiv.classList.remove('hidden');
        return;
    }
    errorDiv.classList.add('hidden');
    
    // Update button state
    submitButton.disabled = true;
    submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Sending...';

    // --- Send data to backend --- 
    const backendUrl = '/api/send-slack-help-message'; 
    
    try {
        // Get user data for user ID and fetch business name
        const { data: { user } } = await window.supabaseClient.auth.getUser();
        const userId = user ? user.id : 'N/A';
        
        // Get business name from Supabase
        let businessName = 'N/A';
        try {
            if (userId !== 'N/A') {
                const { data: onboardingData } = await window.supabaseClient
                    .from('new_client_onboarding')
                    .select('business_name')
                    .eq('user_id', userId)
                    .maybeSingle();
                
                if (onboardingData && onboardingData.business_name) {
                    businessName = onboardingData.business_name;
                }
            }
        } catch (error) {
            console.error('[Help Modal] Error fetching business name:', error);
            // Continue with N/A business name
        }

        const response = await fetch(backendUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ 
                firstName: firstName,
                lastName: lastName,
                email: email,
                phone: phone,
                message: message,
                businessName: businessName,
                context: window.location.href,
                userId: userId
            }) 
        });

        if (!response.ok) {
            let errorMsg = `Server responded with status: ${response.status}`;
            try {
                const errorData = await response.json();
                errorMsg = errorData.error || errorMsg;
            } catch (e) { /* Ignore if response is not JSON */ }
            throw new Error(errorMsg);
        }

        // Success
        console.log('[Help Modal] Request sent successfully.');
        alert('Your help request has been sent successfully! Our team will get back to you soon.');
        closeHelpModal();
        form.reset(); // Clear the form

    } catch (error) {
        console.error('[Help Modal] Error submitting help request:', error);
        errorDiv.textContent = `Failed to send request: ${error.message}`; 
        errorDiv.classList.remove('hidden');
    } finally {
        // Reset button state regardless of success/failure
        submitButton.disabled = false;
        submitButton.innerHTML = 'Submit Request';
    }
}
    errorDiv.classList.add('hidden');
    
    // Update button state
    submitButton.disabled = true;
    submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Sending...';

    // --- Send data to backend --- 
    // IMPORTANT: Replace '/api/send-slack-help-message' with your actual backend endpoint URL
    const backendUrl = '/api/send-slack-help-message'; 
    
    try {
        const response = await fetch(backendUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ 
                // name: name, // Remove old field
                firstName: firstName, // Send first name
                lastName: lastName, // Send last name
                email: email,
                message: message,
                // Optionally add current page URL or user ID if helpful
                context: window.location.href,
                userId: (await window.supabaseClient.auth.getUser())?.data?.user?.id || 'N/A' // Use async getUser
            }) 
        });

        if (!response.ok) {
            // Try to get error message from backend response
            let errorMsg = `Server responded with status: ${response.status}`;
            try {
                const errorData = await response.json();
                errorMsg = errorData.error || errorMsg;
            } catch (e) { /* Ignore if response is not JSON */ }
            throw new Error(errorMsg);
        }

        // Success
        console.log('[Help Modal] Request sent successfully.');
        alert('Your help request has been sent successfully! Our team will get back to you soon.');
        closeHelpModal();
        form.reset(); // Clear the form

    } catch (error) {
        console.error('[Help Modal] Error submitting help request:', error);
        errorDiv.textContent = `Failed to send request: ${error.message}`; 
        errorDiv.classList.remove('hidden');
    } finally {
        // Reset button state regardless of success/failure
        submitButton.disabled = false;
        submitButton.innerHTML = 'Submit Request';
    }


// --- Modify existing requestSetupHelp --- 
// Ensure this runs after the DOM is loaded or the function exists
document.addEventListener('DOMContentLoaded', () => {
    if (typeof window.requestSetupHelp === 'function') {
        console.log('[Help Modal] Overriding window.requestSetupHelp to show modal.');
        // Keep the original function name but change its behavior
        window.requestSetupHelp = function() {
            console.log('requestSetupHelp called, showing help modal.');
            showHelpModal(); 
        };
    } else {
         console.warn('window.requestSetupHelp not found, cannot override.');
         // Define it if it doesn't exist, so onclick handlers don't break
         window.requestSetupHelp = function() {
            console.log('requestSetupHelp fallback called, showing help modal.');
            showHelpModal(); 
         };
    }

    // Additionally, find any explicit "Send Us An Instant Message" buttons and attach the handler
    const instantMessageButtons = document.querySelectorAll('button'); // Find all buttons
    instantMessageButtons.forEach(button => {
        if (button.textContent.includes('Send Us An Instant Message')) {
            console.log('Found instant message button, attaching showHelpModal');
            button.onclick = showHelpModal; // Assign the function directly
        }
    });
});

    </script>

    <!-- Function to fetch user's first name and display it -->
    <script>
    async function displayUserNameInNav() {
        const userNameSpan = document.getElementById('user-name');
        if (!userNameSpan) return; // Exit if span not found

        try {
            console.log('[Nav Name] Attempting to get user for nav bar...');
            const { data: { user }, error: authError } = await window.supabaseClient.auth.getUser();
            console.log('[Nav Name] getUser result:', user, authError);
            
            if (authError) throw authError;

            if (user && user.id) {
                console.log(`[Nav Name] User ID: ${user.id}. Fetching first name...`);
                const { data: onboardingData, error: dbError } = await window.supabaseClient
                    .from('new_client_onboarding')
                    .select('first_name')
                    .eq('user_id', user.id)
                    .maybeSingle();

                if (dbError) {
                    console.error('[Nav Name] Error fetching first name:', dbError);
                    userNameSpan.textContent = 'Hello!'; // Fallback
                } else if (onboardingData && onboardingData.first_name) {
                    console.log('[Nav Name] First name found:', onboardingData.first_name);
                    const firstName = onboardingData.first_name;
                    const capitalizedFirstName = firstName.charAt(0).toUpperCase() + firstName.slice(1); // Capitalize
                    userNameSpan.textContent = `Hello ${capitalizedFirstName}!`; // Use capitalized name
                } else {
                    console.log('[Nav Name] No first name found in onboarding data. Using email as fallback.');
                    // Fallback to email or generic greeting if name not found
                    const emailPrefix = user.email.split('@')[0]; // Get part before @
                    const capitalizedEmailPrefix = emailPrefix.charAt(0).toUpperCase() + emailPrefix.slice(1); // Capitalize
                    userNameSpan.textContent = `Hello ${capitalizedEmailPrefix}!`; // Use capitalized prefix
                }
            } else {
                 console.log('[Nav Name] User not logged in or ID unavailable.');
                 userNameSpan.textContent = ''; // Clear if not logged in
            }
        } catch (error) {
            console.error('[Nav Name] Error setting user name in nav:', error);
            userNameSpan.textContent = 'Hello!'; // Fallback on error
        }
    }

    // --- Supabase Auth Listener (likely near top of scripts) ---
    window.supabaseClient.auth.onAuthStateChange((event, session) => {
        console.log('Auth state changed:', event, session ? 'User logged in' : 'User logged out');

        if (event === 'SIGNED_IN' || event === 'INITIAL_SESSION') {
            if (session && session.user) {
                console.log('User is logged in:', session.user.email);
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('dashboard-section').style.display = 'block';
                loadAndApplyOnboardingStatus(session.user.id);
                displayUserNameInNav(); // <-- CALL THE FUNCTION HERE
            } else {
                // This case might happen if INITIAL_SESSION has no user
                console.log('Initial session but no user data.');
                document.getElementById('login-section').style.display = 'flex';
                document.getElementById('dashboard-section').style.display = 'none';
            }
        } else if (event === 'SIGNED_OUT') {
            console.log('User signed out.');
            document.getElementById('login-section').style.display = 'flex';
            document.getElementById('dashboard-section').style.display = 'none';
            document.getElementById('user-name').textContent = ''; // Clear name on logout
        }
    });

    // --- MODAL CONTROL FUNCTIONS --- 
    // ... rest of your script ...
    </script>
<!-- Help Request Modal -->
<div id="help-request-modal" class="fixed inset-0 z-50 hidden overflow-y-auto bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
        <div class="flex justify-between items-center border-b pb-3 mb-4">
            <h3 class="text-xl font-semibold text-gray-800">Request Assistance</h3>
            <button onclick="closeHelpModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>
        <form id="help-request-form" onsubmit="submitHelpRequest(event)">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"> <!-- Use grid for side-by-side -->
                <div>
                    <label for="help-first-name" class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                    <input type="text" id="help-first-name" name="firstName" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Your First Name">
                </div>
                <div>
                    <label for="help-last-name" class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                    <input type="text" id="help-last-name" name="lastName" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Your Last Name">
                </div>
            </div>
            <div class="mb-4">
                <label for="help-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <input type="email" id="help-email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="your.email@example.com">
            </div>
<div class="mb-4">
                <label for="help-phone" class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                <input type="tel" id="help-phone" name="phone" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Your phone number">
            </div>
            <div class="mb-4">
                <label for="help-message" class="block text-sm font-medium text-gray-700 mb-1">What do you need help with?</label>
                <textarea id="help-message" name="message" rows="4" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Please describe the issue..."></textarea>
            </div>
            <div id="help-modal-error" class="text-red-600 text-sm mb-3 hidden"></div>
            <div class="flex justify-end space-x-3">
                <button type="button" onclick="closeHelpModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Cancel</button>
                <button id="help-submit-btn" type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-wait">
                    Submit Request
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Debug Tools -->
<div style="position: fixed; bottom: 10px; right: 10px; z-index: 9999; background: #f8f9fa; border: 1px solid #ccc; padding: 10px; border-radius: 5px;">
  <h4 style="margin: 0 0 10px 0; font-size: 14px;">Debug Tools</h4>
  <button onclick="testHelp()" style="background: #28a745; color: white; border: none; padding: 5px 10px; margin: 2px; border-radius: 3px;">Test Help Modal</button>
  <button onclick="testAuth()" style="background: #007bff; color: white; border: none; padding: 5px 10px; margin: 2px; border-radius: 3px;">Test Auth Modal</button>
</div>

<script>
// Debug functions
function testHelp() {
  console.log('TEST: Testing Help Modal...');
  
  // Method 1: Try to find the modal
  const modal = document.getElementById('help-request-modal');
  console.log('Modal reference:', modal);
  
  if (modal) {
    alert('Help modal found! Testing display methods...');
    
    // Check current state
    console.log('Current display style:', modal.style.display);
    console.log('Current classes:', modal.className);
    console.log('Contains hidden class:', modal.classList.contains('hidden'));
    
    // Method 2: Try direct style.display
    console.log('Setting style.display = flex');
    modal.style.display = 'flex';
    
    // Method 3: Try classList manipulation
    console.log('Removing hidden class');
    modal.classList.remove('hidden');
    
    // Method 4: Try changing both style and class
    modal.style.display = 'flex !important';
    modal.className = modal.className.replace('hidden', '');
    
    // Check final state
    console.log('Updated display style:', modal.style.display);
    console.log('Updated classes:', modal.className);
    
    alert('All display methods tried. Check if modal is visible.');
  } else {
    alert('ERROR: Help modal NOT FOUND in document!');
  }
}

function testAuth() {
  console.log('TEST: Testing Auth Modal...');
  const modal = document.getElementById('authorization-modal');
  if (modal) {
    console.log('TEST: Auth modal found, trying to show it...');
    modal.style.display = 'flex';
  } else {
    console.error('TEST: Auth modal not found!');
    alert('Auth modal not found!');
  }
}
</script>
<script src="js/onboarding-redirect.js"></script>
<script src="js/fix-social-integration-simple.js"></script>
<script src="js/direct-fix.js"></script>
<script src="js/help-modal.js"></script>
<script src="js/fix_auth_tabs.js"></script>
<script src="js/facebook-integration.js"></script>
<script src="js/update-facebook-integration.js"></script>
<script src="js/fix-social-media-integration.js"></script>
<script src="js/facebook-integration-onboarding.js"></script>
<script src="js/facebook-seamless-integration.js"></script>
<script src="js/social-media-fix.js"></script>
<script src="js/facebook-modal-fix.js"></script>
<script src="js/logout-handler.js"></script>

<!-- Add this script tag just before the closing <script src="js/a2p-dropdown-fix.js"></script><script src="js/modal-fix-universal.js"></script>`n    <script src="../../improved_hamburger_fix.js"></script>
</body> tag in your workingonboarding.html file -->
<script>
    // Simple direct fix for signup alert
    // This will add a direct alert if the signup appears successful
    document.addEventListener('DOMContentLoaded', function() {
      const signupForm = document.getElementById('signup-form');
      if (!signupForm) return;
      
      signupForm.addEventListener('submit', function(e) {
        // Get the submit button
        const submitBtn = signupForm.querySelector('button[type="submit"]');
        
        // Watch for when the button text changes back to "Sign Up" (indicating completion)
    </script>
    <script src="js/a2p-fix-direct.js"></script>
    <script src="../../improved_hamburger_fix.js"></script>
</body>
</html>
