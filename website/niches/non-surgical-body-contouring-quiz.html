<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Body Contouring Clinic Growth Quiz | TurnClicksToClients</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Ensure body matches site's general feel if not already covered by style.css */
        body {
            font-family: 'Lato', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f4f4f4; /* Match main site background */
        }
        /* Quiz specific container */
        .quiz-page-container {
            padding-top: 20px; /* Space below sticky header */
            padding-bottom: 40px;
        }
        .quiz-container {
            max-width: 850px; /* Wider for 3 blocks in a row more easily */
            margin: 20px auto;
            padding: 30px 40px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            text-align: center;
        }

        .quiz-hook h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: clamp(1.8em, 4vw, 2.4em); /* Responsive */
            color: #0056b3; /* Primary dark blue */
            margin-bottom: 0.5em;
        }
        .quiz-hook p.subheadline {
            font-size: clamp(1em, 2vw, 1.15em);
            color: #555;
            margin-bottom: 30px;
            max-width: 650px; /* Adjusted */
            margin-left: auto;
            margin-right: auto;
        }

        /* Benefit Blocks Styling */
        .quiz-benefits-intro {
            margin: 30px 0 40px 0;
            display: flex; /* Changed to flex */
            justify-content: space-between; /* Distribute space */
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            gap: 20px; /* Adjust gap */
            text-align: left;
        }
        .benefit-block {
            background-color: #f9f9f9; /* Light background for blocks */
            padding: 18px; /* Slightly reduced padding */
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            border-left: 4px solid #007bff; /* Accent color - primary blue */
            flex: 1; /* Allow blocks to grow */
            min-width: 230px; /* Minimum width before wrapping */
        }
        .benefit-block:nth-child(2) {
            border-left-color: #28a745; /* Accent color - green */
        }
        .benefit-block:nth-child(3) {
            border-left-color: #ffc107; /* Accent color - yellow */
        }
        .benefit-block h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.15em; /* Slightly reduced */
            color: #333;
            margin-bottom: 8px;
        }
        .benefit-block p {
            font-size: 0.9em; /* Slightly reduced */
            color: #666;
            line-height: 1.5;
        }

        /* Progress Bar Styling */
        .progress-bar-container {
            width: 100%;
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin-bottom: 30px;
            overflow: hidden; /* Ensure inner bar stays contained */
        }
        .progress-bar {
            height: 100%;
            width: 0%; /* Initial width */
            background-color: #28a745; /* Green progress */
            border-radius: 5px;
            transition: width 0.4s ease;
        }

        /* Quiz Area Styling */
        #quiz-area {
            background-color: #fdfdfd; /* Slightly off-white bg */
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 30px;
            margin-top: 20px; /* Space from benefits/hook */
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); /* Subtle inner shadow */
        }

        .quiz-question h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: clamp(1.3em, 3vw, 1.7em);
            color: #2c3e50; /* Darker, rich blue/grey */
            margin-bottom: 30px;
            line-height: 1.4;
        }
        .quiz-answers ul {
            list-style: none;
            padding: 0;
            margin: 0 0 15px 0;
        }
        .quiz-answers li {
            margin-bottom: 12px;
        }
        .answer-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #007bff; /* Primary Blue */
            color: white;
            border: 1px solid #007bff;
            border-radius: 5px;
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
            text-align: left; /* Align text to the left within button */
        }
        .answer-btn:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }
        .answer-btn.selected { /* Style for selected answer if needed */
            background-color: #004085; /* Even darker blue for selection */
            border-color: #00376e;
            color: #fff;
        }

        .quiz-navigation .cta-button { /* This class is from main style.css */
            margin-top: 15px;
        }

        #quiz-result {
            padding: 20px;
            background-color: #e9f5ff;
            border: 1px solid #b8d6f0;
            border-radius: 5px;
            text-align: center;
            margin-top: 20px;
        }
        #quiz-result h3 { color: #0056b3; margin-bottom: 10px;}
        #quiz-result p { color: #333; }

        #lead-capture-form {
            margin-top: 30px;
            padding: 30px;
            background-color: #f0f8ff;
            border-radius: 8px;
            border: 1px solid #cce5ff;
            text-align: left;
        }
        #lead-capture-form h3 {
            font-family: 'Montserrat', sans-serif;
            text-align: center;
            color: #0056b3;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        #lead-capture-form p {
            text-align: center;
            color: #555;
            margin-bottom: 25px;
            font-size: 1.05em;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }
        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="tel"] {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
        }
        .form-group input:focus {
             border-color: #007bff;
             outline: none;
             box-shadow: 0 0 0 2px rgba(0,123,255,.25);
        }
        #lead-capture-form .cta-button {
            width: 100%;
            padding: 12px;
            font-size: 1.2em;
            margin-top: 10px;
            background-color: #28a745;
        }
         #lead-capture-form .cta-button:hover {
            background-color: #1e7e34;
        }
        .privacy-note {
            font-size: 0.8em;
            color: #777;
            text-align: center;
            margin-top: 15px;
        }

        /* Field explanation styling */
        .field-explanation {
            font-size: 0.8em;
            color: #666;
            margin-top: 4px;
            margin-bottom: 0;
            font-style: italic;
        }

    </style>

    <script src="/tracking.js"></script>
      <link rel="stylesheet" href="../../mobile_optimization.css">
</head>
<body>
    <header>
        <nav aria-label="Main Navigation">
            <div class="logo"><a href="../index.html" style="color: inherit; text-decoration: none;">TurnClicksToClients.com</a></div>
            <button class="hamburger" aria-label="Open navigation" aria-expanded="false" aria-controls="main-nav" style="display:none;">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul id="main-nav">
                <li style="margin-right: 8px;"><a href="../index.html">Home</a></li>
                <li style="margin-right: 8px;"><a href="../about.html">About Us</a></li>
                <li class="dropdown-parent" style="margin-right: 8px;">
                    <a href="../index.html#ideal-clients">Clients We Serve <span class="dropdown-arrow">â–¼</span></a>
                    <ul class="dropdown-menu">
                        <li><a href="child-care-centers.html">Child Care Centers</a></li>
                        <li><a href="cosmetic-dentists.html">Cosmetic Dentists</a></li>
                        <li><a href="pmu-artists.html">PMU Artists</a></li>
                        <li><a href="non-surgical-body-contouring.html">Non-Surgical Body Contouring</a></li>
                        <li><a href="weight-loss-clinics.html">Weight Loss Clinics</a></li>
                        <li><a href="high-end-chiropractors.html">High-End Chiropractors</a></li>
                        <li><a href="sleep-apnea-snoring-clinics.html">Sleep Apnea & Snoring Clinics</a></li>
                        <li><a href="hearing-aid-audiology-clinics.html">Hearing Aid & Audiology</a></li>
                        <li><a href="dme-clinics.html">DME Clinics</a></li>
                    </ul>
                </li>
                <li style="margin-right: 8px;"><a href="../index.html#core-offer">Our Offer</a></li>
                <li style="margin-right: 8px;"><a href="../index.html#guarantee">Guarantee</a></li>
                <li><a href="../index.html#cta-contact" class="cta-button nav-cta">Get Started</a></li>
            </ul>
        </nav>
    </header>

    <div class="quiz-page-container">
        <div class="quiz-container">
            <div class="quiz-hook">
                <h1>Sculpt Your Success: The Non-Surgical Body Contouring Clinic Growth Quiz</h1>
                <p class="subheadline">
                    Pinpoint the key areas to supercharge client acquisition, optimize treatment pathways, and scale your body contouring clinic's profitability.
                </p>
            </div>

            <div id="progress-bar-container" class="progress-bar-container" style="display: none;">
                <div id="progress-bar" class="progress-bar"></div>
            </div>

            <div id="quiz-area">
                <div class="quiz-benefits-intro" id="quiz-benefits-intro">
                    <div class="benefit-block">
                        <h3>Attract More High-Value Clients</h3>
                        <p>Learn to consistently draw in clients seeking transformative body contouring treatments.</p>
                    </div>
                    <div class="benefit-block">
                        <h3>Streamline Clinic Operations</h3>
                        <p>Discover efficiencies in consultations, treatment plans, and follow-ups for a smoother client journey.</p>
                    </div>
                    <div class="benefit-block">
                        <h3>Boost Profitability & Scalability</h3>
                        <p>Uncover strategies to increase revenue per client and scale your clinic's impact effectively.</p>
                    </div>
                </div>
                <button class="cta-button" id="start-quiz-btn" onclick="startQuiz()">Start the Quiz &rarr;</button>

                <div id="quiz-question" class="quiz-question" style="display:none;">
                    <h2></h2>
                </div>
                <div id="quiz-answers" class="quiz-answers" style="display:none;">
                    <ul></ul>
                </div>
                <div class="quiz-navigation" style="display:none;">
                    <button id="next-question-btn" class="cta-button" onclick="nextQuestion()" style="display:none;">Next Question</button>
                </div>
            </div>

            <div id="lead-capture-form" style="display:none;">
                <h3>Unlock Your Clinic Growth Insights!</h3>
                <p>Provide your details to receive your personalized Body Contouring Clinic growth diagnosis and key recommendations.</p>
                <form onsubmit="event.preventDefault(); handleLeadSubmit();">
                    <div class="form-group">
                        <label for="firstName">First Name:</label>
                        <input type="text" id="firstName" name="firstName" required>
                        <p class="field-explanation">We're asking so we can personalize your growth plan and recommendations.</p>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name:</label>
                        <input type="text" id="lastName" name="lastName" required>
                        <p class="field-explanation">We're asking to create your complete profile in our system.</p>
                    </div>
                    <div class="form-group">
                        <label for="businessName">Clinic Name:</label>
                        <input type="text" id="businessName" name="businessName" required>
                        <p class="field-explanation">We're asking so we can tailor our recommendations to your specific body contouring clinic.</p>
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" required>
                        <p class="field-explanation">We're asking so we can send you your personalized growth plan and follow-up resources.</p>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number:</label>
                        <input type="tel" id="phone" name="phone" required>
                        <p class="field-explanation">We're asking so our team can reach out with specific insights about your clinic's growth opportunities.</p>
                    </div>
                    <button type="submit" class="cta-button">See My Clinic Potential!</button>
                </form>
                <p class="privacy-note">We respect your privacy. Your information is kept confidential.</p>
            </div>

            <div id="quiz-result" style="display:none;">
                <h3>Calculating Your Custom Clinic Blueprint...</h3>
                <p>Hang tight, we're tailoring your results.</p>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-main container">
            <div class="footer-column footer-info">
                <h3>TurnClicksToClients.com</h3>
                <p>1309 Coffeen Avenue STE 1200<br>Sheridan Wyoming 82801</p>
                <p>Phone: <a href="tel:+12708181816">(270) 818-1816</a></p>
                <p>Email: <a href="mailto:info@turnclickstoclients.com">info@turnclickstoclients.com</a></p>
            </div>
            <div class="footer-column footer-quick-links">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../about.html">About Us</a></li>
                    <li><a href="../index.html#ideal-clients">Clients We Serve</a></li>
                    <li><a href="../index.html#core-offer">Our Offer</a></li>
                    <li><a href="../index.html#guarantee">Guarantee</a></li>
                    <li><a href="../contact.html">Contact Us</a></li>
                    <li><a href="../privacy-policy.html">Privacy Policy</a></li>
                    <li><a href="../terms-of-service.html">Terms of Service</a></li>
                </ul>
            </div>
            <div class="footer-column footer-niches">
                <h3>Niche Expertise</h3>
                <ul>
                    <li><a href="child-care-centers.html">Child Care Centers</a></li>
                    <li><a href="cosmetic-dentists.html">Cosmetic Dentists</a></li>
                    <li><a href="pmu-artists.html">PMU Artists</a></li>
                    <li><a href="non-surgical-body-contouring.html">Body Contouring</a></li>
                    <li><a href="weight-loss-clinics.html">Weight Loss Clinics</a></li>
                    <li><a href="high-end-chiropractors.html">Chiropractors</a></li>
                    <li><a href="sleep-apnea-snoring-clinics.html">Sleep Apnea Clinics</a></li>
                    <li><a href="hearing-aid-audiology-clinics.html">Audiology Clinics</a></li>
                    <li><a href="dme-clinics.html">DME Clinics</a></li>
                </ul>
            </div>
            <div class="footer-column footer-social">
                <h3>Connect With Us</h3>
                <div class="social-icons">
                    <a href="https://www.linkedin.com/in/aaron-p-813553112/" aria-label="LinkedIn" target="_blank">LinkedIn</a>
                </div>
                <p>Stay updated with our latest insights and offers.</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; <script>document.write(new Date().getFullYear())</script> TurnClicksToClients.com. All rights reserved. | One Client Per City, Per Niche.</p>
        </div>
    </footer>

    <!-- Chat Button and Modal -->
    <div id="chat-widget-button">
        <span>ðŸ’¬</span> Have a ?<br>Click Here To Send Us a Instant Message
    </div>
    <div id="chat-modal" class="modal-hidden">
        <div class="chat-modal-content">
            <div class="chat-modal-header">
                <h2>Start a Conversation</h2>
                <button id="chat-modal-close" class="chat-close-button">&times;</button>
            </div>
            <div class="chat-modal-body">
                <p>
                    <strong>Connect with Our Team Live!</strong><br>
                    Mon-Fri, 10am - 5pm EST: Expect a reply within the hour.<br>
                    After hours & weekends: We'll get back to you first thing next business morning.<br><br>
                    Let us know how we can help your business grow! Please fill out the form below.
                </p>
                <form id="chat-contact-form">
                    <div class="form-group">
                        <label for="chat-industry">Your Industry</label>
                        <select id="chat-industry" name="industry" required>
                            <!-- Options will be populated by script.js -->
                             <option value="" disabled selected>Select your industry...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="chat-name">Full Name</label>
                        <input type="text" id="chat-name" name="name" required>
                    </div>
                     <div class="form-group">
                        <label for="chat-businessName">Business Name</label>
                        <input type="text" id="chat-businessName" name="businessName" required>
                    </div>
                    <div class="form-group">
                        <label for="chat-email">Email Address</label>
                        <input type="email" id="chat-email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="chat-phone">Phone Number</label>
                        <input type="tel" id="chat-phone" name="phone">
                    </div>
                    <div class="form-group">
                        <label for="chat-message">How can we help you?</label>
                        <textarea id="chat-message" name="message" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="cta-button">Send Message</button>
                </form>
                <div id="chat-success-message" style="display: none; text-align: center; padding: 20px;">
                    <h3>Thank You!</h3>
                    <p>Our team has been alerted and will get back to you as soon as possible.</p>
                    <p>You can now close this window.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase Client Initialization
        const SUPABASE_URL = 'https://eumhqssfvkyuepyrtlqj.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV1bWhxc3Nmdmt5dWVweXJ0bHFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY1NjE0MDEsImV4cCI6MjA2MjEzNzQwMX0.w-UzQq1G6GIinBdlIcW34KBSoeaAK-knNs4AvL8ct64';
        let supabaseClient = null;

        // Initialize Supabase client when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            try {
                if (typeof supabase !== 'undefined' && supabase.createClient) {
                    supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    console.log("Supabase client initialized for Non-Surgical Body Contouring Quiz.");
                } else {
                    console.error("Supabase client library (supabase.js) is not loaded for Non-Surgical Body Contouring Quiz.");
                }
            } catch (e) {
                console.error("Error initializing Supabase client for Non-Surgical Body Contouring Quiz:", e.message);
            }
        });

        const niche = 'Non-Surgical Body Contouring';
        const urlParams = new URLSearchParams(window.location.search);
        const sourceParam = urlParams.get('utm_source') || urlParams.get('source') || '';

        let currentQuestionIndex = 0;
        let userAnswers = [];
        let totalScore = 0;
        let quizStarted = false;

        const quizQuestions = [
            {
                question: "How effectively does your clinic currently generate leads for non-surgical body contouring services?",
                answers: [
                    { text: "Primarily reliant on word-of-mouth or general clinic traffic.", score: 1 },
                    { text: "We do some occasional marketing, but lead flow is inconsistent.", score: 2 },
                    { text: "We have active marketing campaigns, but cost per lead is high or quality is low.", score: 3 },
                    { text: "We have a predictable system for generating high-quality leads at a reasonable cost.", score: 4 }
                ]
            },
            {
                question: "How well are your consultation processes converting interested leads into paying clients for body contouring packages?",
                answers: [
                    { text: "Conversion rates are low; many leads don\'t book or purchase.", score: 1 },
                    { text: "It\'s average, but we often struggle with price objections or commitment.", score: 2 },
                    { text: "Good, but we feel we could improve closing rates for higher-value packages.", score: 3 },
                    { text: "Excellent; we have a strong consultation process that effectively converts leads into multi-session clients.", score: 4 }
                ]
            },
            {
                question: "How strong is your clinic\'s online presence and reputation for non-surgical body contouring (e.g., before/after gallery, testimonials, targeted content)?",
                answers: [
                    { text: "Minimal or outdated; doesn\'t effectively showcase our expertise or results.", score: 1 },
                    { text: "Basic; we have some online presence, but it doesn\'t stand out or attract many clients.", score: 2 },
                    { text: "Good; we have a decent portfolio and some positive reviews, but it could be more impactful.", score: 3 },
                    { text: "Excellent; our online presence is a powerful asset, attracting and converting ideal body contouring clients.", score: 4 }
                ]
            },
            {
                question: "How effectively do you educate potential clients about the benefits, process, and realistic outcomes of your specific body contouring technologies?",
                answers: [
                    { text: "Information is basic or mostly provided only during in-person consults.", score: 1 },
                    { text: "We have some website content/brochures, but clients often still have many questions.", score: 2 },
                    { text: "We provide good educational content, but could make it more engaging or accessible.", score: 3 },
                    { text: "We offer comprehensive, easily digestible information through multiple channels, setting clear expectations.", score: 4 }
                ]
            },
            {
                question: "What is your primary business goal for your non-surgical body contouring services in the next 1-3 years?",
                answers: [
                    { text: "To introduce or establish body contouring as a consistent service offering.", score: 1 },
                    { text: "To increase the volume of body contouring clients and overall revenue from these services.", score: 2 },
                    { text: "To become known for specific, highly effective body contouring treatments and attract premium clientele.", score: 3 },
                    { text: "To significantly scale our body contouring operations, possibly adding new technologies or expanding our team/facility.", score: 4 }
                ]
            },
            {
                question: "Every business has them: those 'invisible chains' of costly overhead or tedious manual processes that secretly stifle growth and sanity. What ONE such chain, if broken, would provide the most immediate and profound boost to your business\'s efficiency and your personal peace of mind? *",
                type: "textarea",
                id: "growth_stifler_response_quiz"
            }
        ];

        const quizArea = document.getElementById('quiz-area');
        const quizBenefitsIntro = document.getElementById('quiz-benefits-intro');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const quizQuestionDiv = document.getElementById('quiz-question');
        const quizAnswersDiv = document.getElementById('quiz-answers');
        const quizNavigationDiv = document.querySelector('.quiz-navigation');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const leadCaptureForm = document.getElementById('lead-capture-form');
        const quizResultDiv = document.getElementById('quiz-result');
        const progressBarContainer = document.getElementById('progress-bar-container');
        const progressBar = document.getElementById('progress-bar');

        function determineOutcome(score) {
            if (score <= 7) return "clients";
            if (score <= 14) return "operations";
            return "growth";
        }

        function startQuiz() {
            quizStarted = true;
            quizBenefitsIntro.style.display = 'none';
            startQuizBtn.style.display = 'none';
            quizQuestionDiv.style.display = 'block';
            quizAnswersDiv.style.display = 'block';
            quizNavigationDiv.style.display = 'none';
            nextQuestionBtn.style.display = 'none';
            progressBarContainer.style.display = 'block';
            displayQuestion();
        }

        function displayQuestion() {
            if (currentQuestionIndex < quizQuestions.length) {
                const questionData = quizQuestions[currentQuestionIndex];
                const h2 = quizQuestionDiv.querySelector('h2');
                h2.textContent = questionData.question;

                const oldInstruction = quizQuestionDiv.querySelector('p.instruction-text');
                if (oldInstruction) {
                    oldInstruction.remove();
                }

                const answersUl = quizAnswersDiv.querySelector('ul');
                answersUl.innerHTML = '';

                if (questionData.type === "textarea") {
                    const instructionP = document.createElement('p');
                    instructionP.textContent = "Please type your answer below:";
                    instructionP.className = 'instruction-text';
                    instructionP.style.fontSize = '0.9em';
                    instructionP.style.color = '#666';
                    instructionP.style.marginTop = '5px';
                    h2.after(instructionP);

                    // Remove any existing "why we're asking" explanation
                    const existingWhyAskingP = quizQuestionDiv.querySelector('.why-asking-explanation');
                    if (existingWhyAskingP) {
                        existingWhyAskingP.remove();
                    }

                    // Add "why we're asking" explanation
                    const whyAskingP = document.createElement('p');
                    whyAskingP.className = 'why-asking-explanation'; // Add a class for easy identification
                    whyAskingP.innerHTML = "<strong>Why we're asking:</strong> We want to understand your specific challenges so we can tailor our recommendations to address your most pressing needs and help you achieve faster results with your body contouring clinic.";
                    whyAskingP.style.fontSize = '0.85em';
                    whyAskingP.style.color = '#555';
                    whyAskingP.style.backgroundColor = '#f8f9fa';
                    whyAskingP.style.padding = '10px';
                    whyAskingP.style.borderRadius = '4px';
                    whyAskingP.style.marginTop = '10px';
                    whyAskingP.style.marginBottom = '15px';
                    whyAskingP.style.borderLeft = '3px solid #007bff';
                    instructionP.after(whyAskingP);

                    const li = document.createElement('li');
                    const textarea = document.createElement('textarea');
                    textarea.id = questionData.id;
                    textarea.name = questionData.id;
                    textarea.rows = 4;
                    textarea.style.width = '100%';
                    textarea.style.padding = '10px';
                    textarea.style.borderColor = '#ccc';
                    textarea.style.borderRadius = '4px';
                    textarea.required = true;
                    li.appendChild(textarea);
                    answersUl.appendChild(li);

                    nextQuestionBtn.textContent = "Next";
                    nextQuestionBtn.onclick = handleTextareaAnswer;
                    quizNavigationDiv.style.display = 'block';
                    nextQuestionBtn.style.display = 'inline-block';

                } else {
                    const instructionP = document.createElement('p');
                    instructionP.textContent = "Select your answer below:";
                    instructionP.className = 'instruction-text';
                    instructionP.style.fontSize = '0.9em';
                    instructionP.style.color = '#666';
                    instructionP.style.marginTop = '5px';
                    h2.after(instructionP);

                    // Remove any existing "why we're asking" explanation
                    const existingWhyAskingP = quizQuestionDiv.querySelector('.why-asking-explanation');
                    if (existingWhyAskingP) {
                        existingWhyAskingP.remove();
                    }

                    // Add "why we're asking" explanation with specific reasons based on question index
                    const whyAskingP = document.createElement('p');
                    whyAskingP.className = 'why-asking-explanation'; // Add a class for easy identification
                    let whyText = "";

                    // Customize the explanation based on the question
                    switch(currentQuestionIndex) {
                        case 0:
                            whyText = "We're asking because lead generation effectiveness directly impacts your clinic's growth potential. Your answer helps us identify if enhancing your lead generation could be a key opportunity for your practice.";
                            break;
                        case 1:
                            whyText = "We're asking because consultation conversion rates significantly affect your clinic's revenue. Your answer helps us determine if improving your consultation process could increase your client acquisition.";
                            break;
                        case 2:
                            whyText = "We're asking because your online presence and reputation directly impact client trust and acquisition. Your answer helps us assess if enhancing your digital presence could be a growth lever for your clinic.";
                            break;
                        case 3:
                            whyText = "We're asking because client retention and package sales are often hidden profit centers in body contouring clinics. Your answer helps us identify if optimizing these areas could boost your revenue.";
                            break;
                        case 4:
                            whyText = "We're asking because your growth objectives influence which strategies will be most effective for your clinic. Your answer helps us tailor our recommendations to your specific ambitions.";
                            break;
                        case 5:
                            whyText = "We're asking because your technology mix directly impacts your competitive advantage and client results. Your answer helps us understand if upgrading your equipment should be a priority in your growth plan.";
                            break;
                        case 6:
                            whyText = "We're asking because staff training directly impacts client satisfaction and treatment outcomes. Your answer helps us determine if enhancing your team's skills could improve your clinic's performance.";
                            break;
                        case 7:
                            whyText = "We're asking because pricing and packaging strategies significantly affect your clinic's profitability. Your answer helps us identify if optimizing your pricing approach could increase your revenue.";
                            break;
                        case 8:
                            whyText = "We're asking because client education and expectation management directly impact satisfaction and referrals. Your answer helps us assess if improving your client education could boost your clinic's growth.";
                            break;
                        case 9:
                            whyText = "We're asking because client tracking and follow-up systems are often key differentiators between high and average-performing clinics. Your answer helps us determine if enhancing these systems could improve your results.";
                            break;
                        default:
                            whyText = "We're asking to better understand your body contouring clinic and provide more tailored recommendations for growth.";
                    }

                    whyAskingP.innerHTML = "<strong>Why we're asking:</strong> " + whyText;
                    whyAskingP.style.fontSize = '0.85em';
                    whyAskingP.style.color = '#555';
                    whyAskingP.style.backgroundColor = '#f8f9fa';
                    whyAskingP.style.padding = '10px';
                    whyAskingP.style.borderRadius = '4px';
                    whyAskingP.style.marginTop = '10px';
                    whyAskingP.style.marginBottom = '15px';
                    whyAskingP.style.borderLeft = '3px solid #007bff';
                    instructionP.after(whyAskingP);

                    questionData.answers.forEach((answer) => {
                        const li = document.createElement('li');
                        const button = document.createElement('button');
                        button.classList.add('answer-btn');
                        button.textContent = answer.text;
                        button.onclick = () => selectAnswer(answer.score, button);
                        li.appendChild(button);
                        answersUl.appendChild(li);
                    });
                    quizNavigationDiv.style.display = 'none';
                    nextQuestionBtn.style.display = 'none';
                }
                updateProgressBar();
            } else {
                showLeadCaptureForm();
            }
        }

        function handleTextareaAnswer() {
            const questionData = quizQuestions[currentQuestionIndex];
            const textarea = document.getElementById(questionData.id);
            if (textarea && textarea.value.trim() !== "") {
                userAnswers[currentQuestionIndex] = textarea.value.trim();
                nextQuestion();
            } else {
                alert("Please provide an answer to this question.");
            }
        }

        function selectAnswer(score, selectedButton) {
            const buttons = quizAnswersDiv.querySelectorAll('.answer-btn');
            buttons.forEach(btn => btn.classList.remove('selected'));
            selectedButton.classList.add('selected');
            userAnswers[currentQuestionIndex] = score;
            setTimeout(nextQuestion, 500);
        }

        function nextQuestion() {
            const currentQuestionData = quizQuestions[currentQuestionIndex];
            if (currentQuestionData.type !== "textarea" && userAnswers[currentQuestionIndex] === undefined) {
                alert("Please select an answer before proceeding.");
                return;
            }

            currentQuestionIndex++;
            if (currentQuestionIndex < quizQuestions.length) {
                displayQuestion();
            } else {
                showLeadCaptureForm();
            }
        }

        function updateProgressBar() {
            const progress = (currentQuestionIndex / quizQuestions.length) * 100;
            progressBar.style.width = progress + '%';
        }

        function showLeadCaptureForm() {
            quizQuestionDiv.style.display = 'none';
            quizAnswersDiv.style.display = 'none';
            quizNavigationDiv.style.display = 'none';
            progressBarContainer.style.display = 'none';
            leadCaptureForm.style.display = 'block';
            totalScore = userAnswers.reduce((acc, score) => acc + (score || 0), 0);
            console.log("Final Score: ", totalScore);
        }

        async function handleLeadSubmit() {
            console.log("Starting lead submission process...");

            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const businessName = document.getElementById('businessName').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();

            let growth_stifler_response = "";
            const growthStiflerQuestionIndex = quizQuestions.findIndex(q => q.type === "textarea");
            if (growthStiflerQuestionIndex !== -1 && userAnswers[growthStiflerQuestionIndex]) {
                growth_stifler_response = userAnswers[growthStiflerQuestionIndex];
            }

            if (!firstName || !lastName || !businessName || !email || !phone) {
                alert("Please fill in all required fields in the form.");
                return;
            }

            if (growthStiflerQuestionIndex !== -1 && !userAnswers[growthStiflerQuestionIndex]) {
                 alert("Please ensure all quiz questions, including the open-ended one, are answered.");
                 return;
            }

            console.log("Form validation passed, preparing data...");

            if (leadCaptureForm) leadCaptureForm.style.display = 'none';
            if (quizResultDiv) {
                quizResultDiv.style.display = 'block';
                quizResultDiv.querySelector('h3').textContent = "Calculating Your Results...";
                quizResultDiv.querySelector('p').textContent = "Please wait a moment while we tailor your insights.";
            }

            const detailedQuizAnswers = userAnswers.map((answerData, index) => {
                const questionData = quizQuestions[index];
                if (questionData.type === "textarea") {
                    return {
                        question: questionData.question,
                        answer: answerData,
                        score: null
                    };
                }
                const selectedAnswerObject = questionData.answers.find(ans => ans.score === answerData);
                return {
                    question: questionData.question,
                    answer: selectedAnswerObject ? selectedAnswerObject.text : "N/A - Score not found",
                    score: answerData
                };
            });

            const primaryOutcomeHint = determineOutcome(totalScore);

            const submissionData = {
                first_name: firstName,
                last_name: lastName,
                business_name: businessName,
                email: email,
                phone: phone,
                growth_stifler_response: growth_stifler_response,
                total_score: totalScore,
                niche: niche,
                quiz_answers: detailedQuizAnswers,
                primary_outcome_hint: primaryOutcomeHint,
                source: sourceParam || 'organic',
                submitted_at: new Date().toISOString(),
            };

            console.log("Submission data prepared:", submissionData);

            let dbErrorMessage = null;
            if (!supabaseClient) {
                console.error("Supabase client is not initialized!");
                dbErrorMessage = 'Supabase client not initialized';
            } else {
                try {
                    console.log("Attempting to insert data into Supabase...");
                    const { data, error } = await supabaseClient
                        .from('tctc_quiz_submission')
                        .insert([submissionData])
                        .select();

                    if (error) {
                        console.error('Non-Surgical Body Contouring Quiz: Error inserting data into Supabase:', error);
                        dbErrorMessage = error.message || 'Unknown DB Error';
                    } else {
                        console.log('Non-Surgical Body Contouring Quiz: Data successfully inserted into Supabase:', data);
                        // INVOKE THE EDGE FUNCTION TO SEND TO SLACK
                        try {
                            console.log('Non-Surgical Body Contouring Quiz: Attempting to invoke quiz-slack-notify Edge Function with data:', submissionData);
                            const { data: funcData, error: funcError } = await supabaseClient.functions.invoke('quiz-slack-notify', {
                                body: submissionData // Pass the same submissionData
                            });

                            if (funcError) {
                                console.error('Non-Surgical Body Contouring Quiz: Error invoking quiz-slack-notify Edge Function:', funcError);
                            } else {
                                console.log('Non-Surgical Body Contouring Quiz: quiz-slack-notify Edge Function invoked successfully:', funcData);
                            }
                        } catch (invokeCatchError) {
                            console.error('Non-Surgical Body Contouring Quiz: Exception caught when trying to invoke Edge Function:', invokeCatchError);
                        }
                    }
                } catch (e) {
                    console.error('Non-Surgical Body Contouring Quiz: Exception during Supabase insert:', e);
                    dbErrorMessage = e.message || 'DB Insert Exception';
                }
            }

            console.log("Proceeding with redirection...");
            determineOutcomeAndRedirect(firstName, lastName, businessName, totalScore, supabaseClient, dbErrorMessage, sourceParam, dbErrorMessage);
        }

        async function determineOutcomeAndRedirect(firstName, lastName, businessName, totalScore, supabaseClient, dbError, sourceParam, supabaseInsertError) {
            const encodedFirstName = encodeURIComponent(firstName);
            const encodedLastName = encodeURIComponent(lastName);
            const encodedBusinessName = encodeURIComponent(businessName);
            const baseParams = `firstName=${encodedFirstName}&lastName=${encodedLastName}&businessName=${encodedBusinessName}&score=${totalScore}`;
            const sourceAndDbErrorParams = `${sourceParam ? `&source=${encodeURIComponent(sourceParam)}` : ''}&track_source=quiz${dbError ? `&dbError=${encodeURIComponent(supabaseInsertError?.message || 'Unknown error')}` : ''}`;

            // Determine the outcome bucket based on the score
            const outcome = determineOutcome(totalScore);
            const scoreBucket = outcome; // patients, practice, or growth

            // Determine which awareness variant to show based on score distribution
            let awarenessVariant;
            if (scoreBucket === "patients") {
                // Lower scores within this bucket get problem variant, higher get solution variant, etc.
                if (totalScore <= 5) {
                    awarenessVariant = "b-problem"; // Problem Aware
                } else if (totalScore <= 6) {
                    awarenessVariant = "a-solution"; // Solution Aware
                } else {
                    awarenessVariant = "c-most-aware"; // Most Aware
                }
            }
            else if (scoreBucket === "practice") {
                if (totalScore <= 10) {
                    awarenessVariant = "b-problem"; // Problem Aware
                } else if (totalScore <= 12) {
                    awarenessVariant = "a-solution"; // Solution Aware
                } else {
                    awarenessVariant = "c-most-aware"; // Most Aware
                }
            }
            else { // growth
                if (totalScore <= 16) {
                    awarenessVariant = "b-problem"; // Problem Aware
                } else if (totalScore <= 18) {
                    awarenessVariant = "a-solution"; // Solution Aware
                } else {
                    awarenessVariant = "c-most-aware"; // Most Aware
                }
            }

            // Construct the new URL with bucket and variant
            const url = `../quiz-applications/non-surgical-body-contouring/${scoreBucket}/non-surgical-body-contouring-${scoreBucket}-variant-${awarenessVariant}.html${baseParams ? '?' + baseParams : '?'}${sourceAndDbErrorParams}&bucket=${scoreBucket}&variant=${awarenessVariant}`;

            // Track the redirection in Supabase before redirecting
            if (supabaseClient) {
                try {
                    const { data, error } = await supabaseClient
                        .from('tctc_quiz_redirections')
                        .insert([{
                            user_first_name: firstName,
                            user_last_name: lastName,
                            user_business_name: businessName,
                            quiz_score: totalScore,
                            outcome_bucket: scoreBucket,
                            awareness_variant: awarenessVariant,
                            redirect_url: url,
                            source: sourceParam || 'organic',
                            redirected_at: new Date().toISOString()
                        }]);

                    if (error) {
                        console.error('Error tracking non-surgical body contouring redirection:', error);
                    } else {
                        console.log('Non-surgical body contouring redirection tracking successful:', data);
                    }
                } catch (e) {
                    console.error('Exception during non-surgical body contouring redirection tracking:', e);
                }
            }

            // Redirect regardless of tracking success
            console.log("Non-Surgical Body Contouring: Redirecting to:", url);
            window.location.href = url;
        }

        // Assign functions to window object for HTML onclick attributes
        window.startQuiz = startQuiz;
        window.handleLeadSubmit = handleLeadSubmit;

    </script>
    <script src="../script.js"></script>
    <script src="../tracking.js"></script>
    <script src="../tracking-enhanced.js"></script>
</body>
</html>