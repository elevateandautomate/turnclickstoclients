<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmetic Dentist Growth Quiz | TurnClicksToClients</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Ensure body matches site\'s general feel if not already covered by style.css */
        body {
            font-family: \'Lato\', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f4f4f4; /* Match main site background */
        }
        /* Quiz specific container */
        .quiz-page-container {
            padding-top: 20px; /* Space below sticky header */
            padding-bottom: 40px;
        }
        .quiz-container {
            max-width: 850px; /* Wider for 3 blocks in a row more easily */
            margin: 20px auto;
            padding: 30px 40px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            text-align: center;
        }

        .quiz-hook h1 {
            font-family: \'Montserrat\', sans-serif;
            font-size: clamp(1.8em, 4vw, 2.4em); /* Responsive */
            color: #0056b3; /* Primary dark blue */
            margin-bottom: 0.5em;
        }
        .quiz-hook p.subheadline {
            font-size: clamp(1em, 2vw, 1.15em);
            color: #555;
            margin-bottom: 30px;
            max-width: 650px; /* Adjusted */
            margin-left: auto;
            margin-right: auto;
        }

        /* Benefit Blocks Styling */
        .quiz-benefits-intro {
            margin: 30px 0 40px 0;
            display: flex; /* Changed to flex */
            justify-content: space-between; /* Distribute space */
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            gap: 20px; /* Adjust gap */
            text-align: left;
        }
        .benefit-block {
            background-color: #f9f9f9; /* Light background for blocks */
            padding: 18px; /* Slightly reduced padding */
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            border-left: 4px solid #007bff; /* Accent color - primary blue */
            flex: 1; /* Allow blocks to grow */
            min-width: 230px; /* Minimum width before wrapping */
        }
        .benefit-block:nth-child(2) {
            border-left-color: #28a745; /* Accent color - green */
        }
        .benefit-block:nth-child(3) {
            border-left-color: #ffc107; /* Accent color - yellow */
        }
        .benefit-block h3 {
            font-family: \'Montserrat\', sans-serif;
            font-size: 1.15em; /* Slightly reduced */
            color: #333;
            margin-bottom: 8px;
        }
        .benefit-block p {
            font-size: 0.9em; /* Slightly reduced */
            color: #666;
            line-height: 1.5;
        }

        /* Progress Bar Styling */
        .progress-bar-container {
            width: 100%;
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin-bottom: 30px;
            overflow: hidden; /* Ensure inner bar stays contained */
        }
        .progress-bar {
            height: 100%;
            width: 0%; /* Initial width */
            background-color: #28a745; /* Green progress */
            border-radius: 5px;
            transition: width 0.4s ease;
        }

        /* Quiz Area Styling */
        #quiz-area {
            background-color: #fdfdfd; /* Slightly off-white bg */
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 30px;
            margin-top: 20px; /* Space from benefits/hook */
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); /* Subtle inner shadow */
        }

        .quiz-question h2 {
            font-family: \'Montserrat\', sans-serif;
            font-size: clamp(1.3em, 3vw, 1.7em);
            color: #2c3e50; /* Darker, rich blue/grey */
            margin-bottom: 30px;
            line-height: 1.4;
        }
        .quiz-answers ul {
            list-style: none;
            padding: 0;
            margin: 0 0 15px 0;
        }
        .quiz-answers li {
            margin-bottom: 12px;
        }
        .answer-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #007bff; /* Primary Blue */
            color: white;
            border: 1px solid #007bff;
            border-radius: 5px;
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
            text-align: left; /* Align text to the left within button */
        }
        .answer-btn:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }
        .answer-btn.selected { /* Style for selected answer if needed */
            background-color: #004085; /* Even darker blue for selection */
            border-color: #00376e;
            color: #fff;
        }

        .quiz-navigation .cta-button { /* This class is from main style.css */
            margin-top: 15px;
            /* background-color: #28a745; Green for next - already in style.css */
        }
        /* .quiz-navigation .cta-button:hover {
            background-color: #1e7e34;
        } */

        #quiz-result { /* Styling for the temporary result display */
            padding: 20px;
            background-color: #e9f5ff;
            border: 1px solid #b8d6f0;
            border-radius: 5px;
            text-align: center;
            margin-top: 20px;
        }
        #quiz-result h3 { color: #0056b3; margin-bottom: 10px;}
        #quiz-result p { color: #333; }

        /* Lead Capture Form Styling */
        #lead-capture-form {
            margin-top: 30px;
            padding: 30px;
            background-color: #f0f8ff; /* Light blue background */
            border-radius: 8px;
            border: 1px solid #cce5ff;
            text-align: left;
        }
        #lead-capture-form h3 {
            font-family: \'Montserrat\', sans-serif;
            text-align: center;
            color: #0056b3;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        #lead-capture-form p {
            text-align: center;
            color: #555;
            margin-bottom: 25px;
            font-size: 1.05em;
        }
        .form-group {
            margin-bottom: 18px; /* Increased spacing between form groups */
        }
        .form-group label {
            display: block;
            margin-bottom: 6px; /* Space between label and input */
            font-weight: 600;
            color: #333;
            font-size: 0.95em; /* Slightly larger label */
        }
        .form-group label span { /* Style for the asterisk */
            color: #dc3545; /* Red color for asterisk */
            margin-left: 2px;
        }
        #lead-capture-form input[type="text"],
        #lead-capture-form input[type="email"],
        #lead-capture-form input[type="tel"] {
            width: 100%;
            padding: 12px 15px; /* Increased padding for a better feel */
            border: 1px solid #ced4da; /* Standard bootstrap-like border color */
            border-radius: 5px; /* Slightly more rounded corners */
            font-size: 1em;
            box-sizing: border-box; /* Important for width calculation */
        }
        #lead-capture-form input:focus { /* More prominent focus style */
             border-color: #007bff;
             outline: none;
             box-shadow: 0 0 0 3px rgba(0,123,255,.25); /* Slightly larger shadow */
        }
        /* Ensure button is styled via the .cta-button class from style.css or add specific here if needed */
        #lead-capture-form button[type="button"] {
            width: 100%;
            padding: 12px 20px;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 10px; /* Space above button */
            background-color: #28a745; /* Green submit */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
         #lead-capture-form button[type="button"]:hover {
            background-color: #218838; /* Darker green on hover */
        }
        .privacy-note {
            font-size: 0.8em;
            color: #777;
            text-align: center;
            margin-top: 15px;
        }

    </style>
</head>
<body>
    <!-- Standard Site Header -->
    <header>
        <nav>
            <div class="logo"><a href="../index.html">TurnClicksToClients.com</a></div>
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="../about.html">About Us</a></li>
                <li class="dropdown-parent">
                    <a href="../index.html#ideal-clients">Clients We Serve <span class="dropdown-arrow">â–¼</span></a>
                    <ul class="dropdown-menu">
                        <li><a href="child-care-centers.html">Child Care Centers</a></li>
                        <li><a href="cosmetic-dentists.html">Cosmetic Dentists</a></li>
                        <li><a href="pmu-artists.html">PMU Artists</a></li>
                        <li><a href="non-surgical-body-contouring.html">Non-Surgical Body Contouring</a></li>
                        <li><a href="weight-loss-clinics.html">Weight Loss Clinics</a></li>
                        <li><a href="high-end-chiropractors.html">High-End Chiropractors</a></li>
                        <li><a href="sleep-apnea-snoring-clinics.html">Sleep Apnea & Snoring Clinics</a></li>
                        <li><a href="hearing-aid-audiology-clinics.html">Hearing Aid & Audiology</a></li>
                        <li><a href="dme-clinics.html">DME Clinics</a></li>
                    </ul>
                </li>
                <li><a href="../index.html#core-offer">Our Offer</a></li>
                <li><a href="../index.html#pricing">Pricing</a></li>
                <li><a href="../index.html#guarantee">Guarantee</a></li>
                <li><a href="../index.html#cta-contact" class="cta-button nav-cta">Get Started</a></li>
            </ul>
        </nav>
    </header>

    <div class="quiz-page-container">
        <div class="quiz-container">
            <div class="quiz-hook">
                <h1>Unlock Your Cosmetic Practice's Full Potential: Take the 2-Minute Growth Quiz</h1>
                <p class="subheadline">
                    Discover the hidden bottlenecks in your patient attraction and practice management. Get a personalized diagnosis and actionable insights to elevate your Cosmetic Dentistry practice.
                </p>
            </div>

            <!-- Progress Bar Container - will be displayed above quiz-area by JS after first question -->
            <div id="progress-bar-container" class="progress-bar-container" style="display: none;">
                <div id="progress-bar" class="progress-bar"></div>
            </div>

            <div id="quiz-area">
                <!-- Initial Benefit Blocks - Will be hidden after quiz starts -->
                <div class="quiz-benefits-intro" id="quiz-benefits-intro">
                    <div class="benefit-block">
                        <h3>Pinpoint Growth Levers</h3>
                        <p>Identify specific areas in your patient journey and practice operations that can be optimized for significant growth.</p>
                    </div>
                    <div class="benefit-block">
                        <h3>Attract More Ideal Patients</h3>
                        <p>Understand how to consistently attract high-value patients seeking the cosmetic procedures you specialize in.</p>
                    </div>
                    <div class="benefit-block">
                        <h3>Boost Practice Efficiency</h3>
                        <p>Uncover strategies to streamline workflows, improve team performance, and enhance overall practice profitability.</p>
                    </div>
                </div>
                <button class="cta-button" id="start-quiz-btn" onclick="startQuiz()">Start the Quiz &rarr;</button>
                
                <!-- Questions will be loaded here by JavaScript -->
                <div id="quiz-question" class="quiz-question" style="display:none;">
                    <h2></h2> <!-- Question text will be set here -->
                </div>
                <div id="quiz-answers" class="quiz-answers" style="display:none;">
                    <ul>
                        <!-- Answer buttons will be generated here -->
                    </ul>
                </div>
                <div class="quiz-navigation" style="display:none;">
                    <button id="next-question-btn" class="cta-button" style="display:none;">Next Question</button>
                </div>
            </div>
            
            <div id="lead-capture-form" class="lead-capture-form" style="display:none;">
                <h2>Almost there! Let's see your results.</h2>
                <p>Please provide your details below to view your personalized growth plan.</p>
                <form id="quizLeadForm">
                    <div class="form-group">
                        <label for="firstName">First Name<span>*</span></label>
                        <input type="text" id="firstName" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name<span>*</span></label>
                        <input type="text" id="lastName" name="lastName" required>
                    </div>
                    <div class="form-group">
                        <label for="businessName">Business Name<span>*</span></label>
                        <input type="text" id="businessName" name="businessName" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email<span>*</span></label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number<span>*</span></label>
                        <input type="tel" id="phone" name="phone" required>
                    </div>
                    <button type="button" onclick="handleLeadSubmit()">See My Results & Get My Plan</button>
                </form>
                <p class="form-thank-you" id="formThankYou" style="display:none;">Thank you! Analyzing your results...</p>
            </div>

            <div id="quiz-result" class="quiz-result" style="display:none;">
                <h3>Calculating Your Results...</h3>
                <p>Please wait a moment.</p>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-main container">
            <div class="footer-info">
                <h3 style="font-size: 1.5em;">TurnClicksToClients.com</h3>
                <p>1309 Coffeen Avenue STE 1200<br>Sheridan Wyoming 82801</p>
                <p>Phone: <a href="tel:+12708181816">(270) 818-1816</a></p>
                <p>Email: <a href="mailto:info@turnclickstoclients.com">info@turnclickstoclients.com</a></p>
            </div>
            <div class="footer-quick-links">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../about.html">About Us</a></li>
                    <li><a href="../index.html#core-offer">Our Offer</a></li>
                    <li><a href="../index.html#pricing">Pricing</a></li>
                    <li><a href="../index.html#guarantee">Guarantee</a></li>
                    <li><a href="../index.html#ideal-clients">Clients We Serve</a></li>
                </ul>
            </div>
            <div class="footer-niches">
                <h4>Our Niche Expertise</h4>
                <ul>
                    <li><a href="child-care-centers.html">Child Care Centers</a></li>
                    <li><a href="cosmetic-dentists.html">Cosmetic Dentists</a></li>
                    <li><a href="pmu-artists.html">PMU Artists</a></li>
                    <li><a href="non-surgical-body-contouring.html">Non-Surgical Body Contouring</a></li>
                    <li><a href="weight-loss-clinics.html">Weight Loss Clinics</a></li>
                    <li><a href="high-end-chiropractors.html">High-End Chiropractors</a></li>
                    <li><a href="sleep-apnea-snoring-clinics.html">Sleep Apnea & Snoring Clinics</a></li>
                    <li><a href="hearing-aid-audiology-clinics.html">Hearing Aid & Audiology</a></li>
                    <li><a href="dme-clinics.html">DME Clinics</a></li>
                </ul>
            </div>
            <div class="footer-social">
                <h4>Connect With Us</h4>
                <a href="https://www.linkedin.com/in/aaron-p-813553112/" aria-label="LinkedIn" target="_blank" rel="noopener noreferrer">
                    LinkedIn
                </a>
                <p>Stay updated with our latest insights and offers.</p>
            </div>
        </div>
        <div class="footer-bottom text-center">
            <p>&copy; <script>document.write(new Date().getFullYear())</script> TurnClicksToClients.com. All rights reserved. | Only one client per city.</p>
        </div>
    </footer>

    <!-- Chat Button and Modal -->
    <div id="chat-widget-button">
        <span>ðŸ’¬</span> Have a ?<br>Click Here To Send Us a Instant Message
    </div>
    <div id="chat-modal" class="modal-hidden">
        <div class="chat-modal-content">
            <div class="chat-modal-header">
                <h2>Start a Conversation</h2>
                <button id="chat-modal-close" class="chat-close-button">&times;</button>
            </div>
            <div class="chat-modal-body">
                <p>
                    <strong>Connect with Our Team Live!</strong><br>
                    Mon-Fri, 10am - 5pm EST: Expect a reply within the hour.<br>
                    After hours & weekends: We'll get back to you first thing next business morning.<br><br>
                    Let us know how we can help your business grow! Please fill out the form below.
                </p>
                <form id="chat-contact-form">
                    <div class="form-group">
                        <label for="chat-industry">Your Industry:</label>
                        <select id="chat-industry" name="industry" required>
                            <option value="" disabled selected>Select your industry...</option>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="chat-name">Full Name:</label>
                        <input type="text" id="chat-name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="chat-businessName">Business Name:</label>
                        <input type="text" id="chat-businessName" name="businessName" required>
                    </div>
                    <div class="form-group">
                        <label for="chat-email">Email Address:</label>
                        <input type="email" id="chat-email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="chat-phone">Phone Number:</label>
                        <input type="tel" id="chat-phone" name="phone">
                    </div>
                    <div class="form-group">
                        <label for="chat-message">How can we help you?</label>
                        <textarea id="chat-message" name="message" rows="4" required></textarea>
                    </div>
                    <button type="submit" class="cta-button secondary chat-submit-button">Send Message</button>
                </form>
                <div id="chat-success-message" style="display: none; text-align: center; padding: 20px;">
                    <h3>Thank You!</h3>
                    <p>Our team has been alerted and will get back to you as soon as possible.</p>
                    <p>You can now close this window.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase Client Initialization - Standardized
        const SUPABASE_URL = 'https://eumhqssfvkyuepyrtlqj.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV1bWhxc3Nmdmt5dWVweXJ0bHFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY1NjE0MDEsImV4cCI6MjA2MjEzNzQwMX0.w-UzQq1G6GIinBdlIcW34KBSoeaAK-knNs4AvL8ct64';
        let supabaseClient = null;

        // Initialize Supabase client when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            try {
                if (typeof supabase !== 'undefined' && supabase.createClient) {
                    supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    console.log("Supabase client initialized for Cosmetic Dentists Quiz.");
                } else {
                    console.error("Supabase client library (supabase.js) is not loaded for Cosmetic Dentists Quiz.");
                }
            } catch (e) {
                console.error("Error initializing Supabase client for Cosmetic Dentists Quiz:", e.message);
            }
        });

        const niche = 'Cosmetic Dentists';
        const urlParams = new URLSearchParams(window.location.search);
        // Keep improved source param logic, but use consistent variable name
        const sourceParam = urlParams.get('utm_source') || urlParams.get('source') || ''; 

        let currentQuestionIndex = 0;
        let userAnswers = [];
        let totalScore = 0;
        let quizStarted = false;

        // Simplified Quiz Questions - Placeholder for Cosmetic Dentists (Ensure this is appropriate)
        const quizQuestions = [
            {
                question: "How effectively does your practice utilize high-quality before & after photos and patient testimonials in your marketing and patient consultations?",
                answers: [
                    { text: "Minimally; we don't have a systematic way to collect or showcase them.", score: 1 },
                    { text: "Somewhat; we have some photos/testimonials but don't use them consistently or strategically.", score: 2 },
                    { text: "Well; we regularly feature them on our website/social media and in consultations.", score: 3 },
                    { text: "Expertly; they are a cornerstone of our marketing and a key tool for demonstrating value to prospective patients.", score: 4 }
                ]
            },
            {
                question: "How would you describe your patient experience for high-value cosmetic procedures (e.g., veneers, smile makeovers, full mouth reconstructions)?",
                answers: [
                    { text: "Standard; similar to general dentistry appointments.", score: 1 },
                    { text: "Comfortable; we try to make it pleasant, but it's not a highly differentiated 'premium' experience.", score: 2 },
                    { text: "Premium; we offer enhanced comfort, personalized attention, and amenities that make patients feel valued.", score: 3 },
                    { text: "Luxury/Concierge; every detail is curated to provide an exceptional, memorable, and exclusive experience from start to finish.", score: 4 }
                ]
            },
            {
                question: "How proactive is your practice in following up with patients who have expressed interest in cosmetic treatments but haven't proceeded?",
                answers: [
                    { text: "Not very; we mostly wait for them to re-engage.", score: 1 },
                    { text: "Occasionally; we might send a general reminder or follow-up if we remember.", score: 2 },
                    { text: "Systematically; we have a process for timely follow-ups and providing additional information or consultations.", score: 3 },
                    { text: "Strategically; we use a multi-touch follow-up sequence tailored to their specific interests and concerns, often including financing options.", score: 4 }
                ]
            },
            {
                question: "How well-defined and communicated is your practice's unique selling proposition (USP) for cosmetic dentistry? (i.e., What makes you the clear choice over other dentists?)",
                answers: [
                    { text: "Not clearly defined or communicated; we're seen as a general dental practice that also does cosmetic work.", score: 1 },
                    { text: "Somewhat defined; we mention our cosmetic services, but our distinct advantages aren't always clear to patients.", score: 2 },
                    { text: "Clearly defined; our team understands our USP, and it's communicated in our marketing materials.", score: 3 },
                    { text: "Powerfully defined and consistently communicated; our USP is compelling, differentiates us significantly, and is evident in every patient touchpoint.", score: 4 }
                ]
            },
            {
                question: "What is your practice's primary growth goal related to cosmetic dentistry for the next 1-3 years?",
                answers: [
                    { text: "Maintaining current cosmetic patient flow.", score: 1 },
                    { text: "Gradually increasing the number of cosmetic cases.", score: 2 },
                    { text: "Significantly boosting revenue from high-value cosmetic procedures.", score: 3 },
                    { text: "Becoming the leading cosmetic dentist in our area, known for specific advanced treatments or exceptional results.", score: 4 }
                ]
            },
            // New "Growth-Stifler" question
            {
                question: "Every business has them: those 'invisible chains' of costly overhead or tedious manual processes that secretly stifle growth and sanity. What ONE such chain, if broken, would provide the most immediate and profound boost to your business\'s efficiency and your personal peace of mind? *",
                type: "textarea", // Identify this as a special question type
                id: "growth_stifler_response_quiz" // Unique ID for the textarea
            }
        ];

        const quizArea = document.getElementById('quiz-area');
        const quizBenefitsIntro = document.getElementById('quiz-benefits-intro');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const quizQuestionDiv = document.getElementById('quiz-question');
        const quizAnswersDiv = document.getElementById('quiz-answers');
        const quizNavigationDiv = document.querySelector('.quiz-navigation');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const leadCaptureForm = document.getElementById('lead-capture-form');
        const quizResultDiv = document.getElementById('quiz-result');
        const progressBarContainer = document.getElementById('progress-bar-container');
        const progressBar = document.getElementById('progress-bar');

        function determineOutcome(score) {
            // Generic outcomes, align with application page naming
            if (score <= 7) return "patients"; // or "acquisition"
            if (score <= 14) return "practice"; // or "operations"
            return "growth"; // or "scalability"
        }

        function startQuiz() {
            quizStarted = true;
            if (quizBenefitsIntro) quizBenefitsIntro.style.display = 'none';
            if (startQuizBtn) startQuizBtn.style.display = 'none';
            if (quizQuestionDiv) quizQuestionDiv.style.display = 'block';
            if (quizAnswersDiv) quizAnswersDiv.style.display = 'block';
            if (quizNavigationDiv) quizNavigationDiv.style.display = 'none';
            if (nextQuestionBtn) nextQuestionBtn.style.display = 'none';
            if (progressBarContainer) progressBarContainer.style.display = 'block';
            displayQuestion();
        }

        function displayQuestion() {
            if (currentQuestionIndex < quizQuestions.length) {
                const questionData = quizQuestions[currentQuestionIndex];
                const h2 = quizQuestionDiv.querySelector('h2');
                h2.textContent = questionData.question;

                const oldInstruction = quizQuestionDiv.querySelector('p.instruction-text');
                if (oldInstruction) {
                    oldInstruction.remove();
                }

                const answersUl = quizAnswersDiv.querySelector('ul');
                answersUl.innerHTML = ''; // Clear previous answers or textarea

                if (questionData.type === "textarea") {
                    const instructionP = document.createElement('p');
                    instructionP.textContent = "Please type your answer below:";
                    instructionP.className = 'instruction-text';
                    instructionP.style.fontSize = '0.9em';
                    instructionP.style.color = '#666';
                    instructionP.style.marginTop = '5px';
                    h2.after(instructionP);

                    const li = document.createElement('li');
                    const textarea = document.createElement('textarea');
                    textarea.id = questionData.id;
                    textarea.name = questionData.id;
                    textarea.rows = 4;
                    textarea.style.width = '100%'; // Basic styling
                    textarea.style.padding = '10px';
                    textarea.style.borderColor = '#ccc';
                    textarea.style.borderRadius = '4px';
                    textarea.required = true; // Make it required
                    li.appendChild(textarea);
                    answersUl.appendChild(li);

                    // Modify Next button behavior for textarea
                    nextQuestionBtn.textContent = "Next";
                    nextQuestionBtn.onclick = handleTextareaAnswer; 
                    quizNavigationDiv.style.display = 'block'; // Show navigation for next button
                    nextQuestionBtn.style.display = 'inline-block'; // Show next button

                } else {
                    const instructionP = document.createElement('p');
                    instructionP.textContent = "Select your answer below:";
                    instructionP.className = 'instruction-text';
                    instructionP.style.fontSize = '0.9em';
                    instructionP.style.color = '#666';
                    instructionP.style.marginTop = '5px';
                    h2.after(instructionP);

                    questionData.answers.forEach((answer) => {
                        const li = document.createElement('li');
                        const button = document.createElement('button');
                        button.classList.add('answer-btn');
                        button.textContent = answer.text;
                        button.onclick = () => selectAnswer(answer.score, button);
                        li.appendChild(button);
                        answersUl.appendChild(li);
                    });
                    quizNavigationDiv.style.display = 'none'; // Hide nav for multiple choice
                    nextQuestionBtn.style.display = 'none'; // Hide next button for multiple choice (auto-advance)
                }
                updateProgressBar();
            } else {
                showLeadCaptureForm();
            }
        }

        function handleTextareaAnswer() {
            const questionData = quizQuestions[currentQuestionIndex];
            const textarea = document.getElementById(questionData.id);
            if (textarea && textarea.value.trim() !== "") {
                userAnswers[currentQuestionIndex] = textarea.value.trim(); // Store the text answer
                nextQuestion();
            } else {
                alert("Please provide an answer to this question.");
            }
        }
        
        function selectAnswer(score, selectedButton) {
            const buttons = quizAnswersDiv ? quizAnswersDiv.querySelectorAll('.answer-btn') : [];
            buttons.forEach(btn => btn.classList.remove('selected'));
            selectedButton.classList.add('selected');
            userAnswers[currentQuestionIndex] = score; 
            setTimeout(nextQuestion, 500);
        }

        function nextQuestion() {
            const currentQuestionData = quizQuestions[currentQuestionIndex];
            if (currentQuestionData.type !== "textarea" && userAnswers[currentQuestionIndex] === undefined) {
                alert("Please select an answer before proceeding.");
                return;
            }

            currentQuestionIndex++;
            if (currentQuestionIndex < quizQuestions.length) {
                displayQuestion();
            } else {
                showLeadCaptureForm();
            }
        }
        
        function updateProgressBar() {
            const progress = (currentQuestionIndex / quizQuestions.length) * 100;
            if (progressBar) progressBar.style.width = progress + '%';
        }

        function showLeadCaptureForm() {
            if (quizQuestionDiv) quizQuestionDiv.style.display = 'none';
            if (quizAnswersDiv) quizAnswersDiv.style.display = 'none';
            if (quizNavigationDiv) quizNavigationDiv.style.display = 'none';
            if (progressBarContainer) progressBarContainer.style.display = 'none';
            if (leadCaptureForm) leadCaptureForm.style.display = 'block';
            totalScore = userAnswers.reduce((acc, score) => acc + (score || 0), 0);
            console.log("Final Score: ", totalScore);
        }

        async function handleLeadSubmit() {
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const businessName = document.getElementById('businessName').value.trim(); 
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            
            let growth_stifler_response = "";
            const growthStiflerQuestionIndex = quizQuestions.findIndex(q => q.type === "textarea");
            if (growthStiflerQuestionIndex !== -1 && userAnswers[growthStiflerQuestionIndex]) {
                growth_stifler_response = userAnswers[growthStiflerQuestionIndex];
            }

            if (!firstName || !lastName || !businessName || !email || !phone) {
                alert("Please fill in all required fields in the form.");
                return;
            }
            
            if (growthStiflerQuestionIndex !== -1 && !userAnswers[growthStiflerQuestionIndex]) {
                 alert("Please ensure all quiz questions, including the open-ended one, are answered.");
                 return;
            }

            leadCaptureForm.style.display = 'none';
            if (quizResultDiv) {
                quizResultDiv.style.display = 'block';
                quizResultDiv.querySelector('h3').textContent = "Calculating Your Results...";
                quizResultDiv.querySelector('p').textContent = "Please wait a moment while we tailor your insights.";
            }

            const detailedQuizAnswers = userAnswers.map((answerData, index) => {
                const questionData = quizQuestions[index];
                if (questionData.type === "textarea") {
                    return {
                        question: questionData.question,
                        answer: answerData, 
                        score: null 
                    };
                }
                const selectedAnswerObject = questionData.answers.find(ans => ans.score === answerData);
                return {
                    question: questionData.question,
                    answer: selectedAnswerObject ? selectedAnswerObject.text : "N/A - Score not found",
                    score: answerData
                };
            });

            const primaryOutcomeHint = determineOutcome(totalScore);

            const submissionData = {
                first_name: firstName,
                last_name: lastName,
                business_name: businessName,
                email: email,
                growth_stifler_response: growth_stifler_response,
                phone: phone,
                total_score: totalScore,
                niche: niche,
                quiz_answers: detailedQuizAnswers,
                primary_outcome_hint: primaryOutcomeHint,
                source: sourceParam || 'organic',
                submitted_at: new Date().toISOString(),
            };

            console.log("Submission data prepared:", submissionData);

            let dbErrorMessage = null;
            if (!supabaseClient) {
                console.error("Supabase client is not initialized!");
                dbErrorMessage = 'Supabase client not initialized';
            } else {
                try {
                    console.log("Attempting to insert data into Supabase...");
                    const { data, error } = await supabaseClient
                        .from('tctc_quiz_submission')
                        .insert([submissionData])
                        .select();
                    
                    if (error) {
                        console.error('Cosmetic Dentists Quiz: Error inserting data into Supabase:', error);
                        dbErrorMessage = error.message || 'Unknown DB Error';
                    } else {
                        console.log('Cosmetic Dentists Quiz: Data successfully inserted into Supabase:', data);
                        // INVOKE THE EDGE FUNCTION TO SEND TO SLACK
                        try {
                            console.log('Cosmetic Dentists Quiz: Attempting to invoke quiz-slack-notify Edge Function with data:', submissionData);
                            const { data: funcData, error: funcError } = await supabaseClient.functions.invoke('quiz-slack-notify', {
                                body: submissionData // Pass the same submissionData
                            });

                            if (funcError) {
                                console.error('Cosmetic Dentists Quiz: Error invoking quiz-slack-notify Edge Function:', funcError);
                            } else {
                                console.log('Cosmetic Dentists Quiz: quiz-slack-notify Edge Function invoked successfully:', funcData);
                            }
                        } catch (invokeCatchError) {
                            console.error('Cosmetic Dentists Quiz: Exception caught when trying to invoke Edge Function:', invokeCatchError);
                        }
                    }
                } catch (e) {
                    console.error('Cosmetic Dentists Quiz: Exception during Supabase insert:', e);
                    dbErrorMessage = e.message || 'DB Insert Exception';
                }
            }

            determineOutcomeAndRedirect(firstName, lastName, businessName, dbErrorMessage);
        }

        function determineOutcomeAndRedirect(firstName, lastName, businessName, dbErrorMessage) {
            const encodedFirstName = encodeURIComponent(firstName);
            const encodedLastName = encodeURIComponent(lastName);
            const encodedBusinessName = encodeURIComponent(businessName); // Practice Name
            let url = '';
            const baseParams = `firstName=${encodedFirstName}&lastName=${encodedLastName}&businessName=${encodedBusinessName}&score=${totalScore}`;
            const sourceAndDbErrorParams = `${sourceParam ? `&source=${encodeURIComponent(sourceParam)}` : ''}${dbErrorMessage ? `&dbError=${encodeURIComponent(dbErrorMessage)}` : ''}`;

            const outcome = determineOutcome(totalScore); // Use the outcome from determineOutcome

            // Adjust application page names as needed
            if (outcome === "patients") { 
                url = `../quiz-applications/cosmetic-dentists-foundation-application.html?${baseParams}${sourceAndDbErrorParams}`;
            } else if (outcome === "practice") { 
                url = `../quiz-applications/cosmetic-dentists-scaling-application.html?${baseParams}${sourceAndDbErrorParams}`;
            } else { // growth
                url = `../quiz-applications/cosmetic-dentists-growth-application.html?${baseParams}${sourceAndDbErrorParams}`;
            }
            console.log("Cosmetic Dentists: Redirecting to:", url);
            window.location.href = url;
        }

        // Remove redundant DOMContentLoaded wrapper as functions are assigned to window or handled by HTML event attributes.

        // Assign to window object if functions are called from HTML onclick attributes.
        window.startQuiz = startQuiz;
        window.handleLeadSubmit = handleLeadSubmit; // Called from form onsubmit
    </script>

    <script src="../script.js"></script>
</body>
</html> 