<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmetic Dentist Growth Quiz | TurnClicksToClients</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Ensure body matches site\'s general feel if not already covered by style.css */
        body {
            font-family: \'Lato\', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f4f4f4; /* Match main site background */
        }
        /* Quiz specific container */
        .quiz-page-container {
            padding-top: 20px; /* Space below sticky header */
            padding-bottom: 40px;
        }
        .quiz-container {
            max-width: 850px; /* Wider for 3 blocks in a row more easily */
            margin: 20px auto;
            padding: 30px 40px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            text-align: center;
        }

        .quiz-hook h1 {
            font-family: \'Montserrat\', sans-serif;
            font-size: clamp(1.8em, 4vw, 2.4em); /* Responsive */
            color: #0056b3; /* Primary dark blue */
            margin-bottom: 0.5em;
        }
        .quiz-hook p.subheadline {
            font-size: clamp(1em, 2vw, 1.15em);
            color: #555;
            margin-bottom: 30px;
            max-width: 650px; /* Adjusted */
            margin-left: auto;
            margin-right: auto;
        }

        /* Benefit Blocks Styling */
        .quiz-benefits-intro {
            margin: 30px 0 40px 0;
            display: flex; /* Changed to flex */
            justify-content: space-between; /* Distribute space */
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            gap: 20px; /* Adjust gap */
            text-align: left;
        }
        .benefit-block {
            background-color: #f9f9f9; /* Light background for blocks */
            padding: 18px; /* Slightly reduced padding */
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            border-left: 4px solid #007bff; /* Accent color - primary blue */
            flex: 1; /* Allow blocks to grow */
            min-width: 230px; /* Minimum width before wrapping */
        }
        .benefit-block:nth-child(2) {
            border-left-color: #28a745; /* Accent color - green */
        }
        .benefit-block:nth-child(3) {
            border-left-color: #ffc107; /* Accent color - yellow */
        }
        .benefit-block h3 {
            font-family: \'Montserrat\', sans-serif;
            font-size: 1.15em; /* Slightly reduced */
            color: #333;
            margin-bottom: 8px;
        }
        .benefit-block p {
            font-size: 0.9em; /* Slightly reduced */
            color: #666;
            line-height: 1.5;
        }

        /* Progress Bar Styling */
        .progress-bar-container {
            width: 100%;
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin-bottom: 30px;
            overflow: hidden; /* Ensure inner bar stays contained */
        }
        .progress-bar {
            height: 100%;
            width: 0%; /* Initial width */
            background-color: #28a745; /* Green progress */
            border-radius: 5px;
            transition: width 0.4s ease;
        }

        /* Quiz Area Styling */
        #quiz-area {
            background-color: #fdfdfd; /* Slightly off-white bg */
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 30px;
            margin-top: 20px; /* Space from benefits/hook */
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); /* Subtle inner shadow */
        }

        .quiz-question h2 {
            font-family: \'Montserrat\', sans-serif;
            font-size: clamp(1.3em, 3vw, 1.7em);
            color: #2c3e50; /* Darker, rich blue/grey */
            margin-bottom: 30px;
            line-height: 1.4;
        }
        .quiz-answers ul {
            list-style: none;
            padding: 0;
            margin: 0 0 15px 0;
        }
        .quiz-answers li {
            margin-bottom: 12px;
        }
        .answer-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #007bff; /* Primary Blue */
            color: white;
            border: 1px solid #007bff;
            border-radius: 5px;
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
            text-align: left; /* Align text to the left within button */
        }
        .answer-btn:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }
        .answer-btn.selected { /* Style for selected answer if needed */
            background-color: #004085; /* Even darker blue for selection */
            border-color: #00376e;
            color: #fff;
        }

        .quiz-navigation .cta-button { /* This class is from main style.css */
            margin-top: 15px;
            /* background-color: #28a745; Green for next - already in style.css */
        }
        /* .quiz-navigation .cta-button:hover {
            background-color: #1e7e34;
        } */

        #quiz-result { /* Styling for the temporary result display */
            padding: 20px;
            background-color: #e9f5ff;
            border: 1px solid #b8d6f0;
            border-radius: 5px;
            text-align: center;
            margin-top: 20px;
        }
        #quiz-result h3 { color: #0056b3; margin-bottom: 10px;}
        #quiz-result p { color: #333; }

        /* Lead Capture Form Styling */
        #lead-capture-form {
            margin-top: 30px;
            padding: 30px;
            background-color: #f0f8ff; /* Light blue background */
            border-radius: 8px;
            border: 1px solid #cce5ff;
            text-align: left;
        }
        #lead-capture-form h3 {
            font-family: \'Montserrat\', sans-serif;
            text-align: center;
            color: #0056b3;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        #lead-capture-form p {
            text-align: center;
            color: #555;
            margin-bottom: 25px;
            font-size: 1.05em;
        }
        .form-group {
            margin-bottom: 18px; /* Increased spacing between form groups */
        }
        .form-group label {
            display: block;
            margin-bottom: 6px; /* Space between label and input */
            font-weight: 600;
            color: #333;
            font-size: 0.95em; /* Slightly larger label */
        }
        .form-group label span { /* Style for the asterisk */
            color: #dc3545; /* Red color for asterisk */
            margin-left: 2px;
        }
        #lead-capture-form input[type="text"],
        #lead-capture-form input[type="email"],
        #lead-capture-form input[type="tel"] {
            width: 100%;
            padding: 12px 15px; /* Increased padding for a better feel */
            border: 1px solid #ced4da; /* Standard bootstrap-like border color */
            border-radius: 5px; /* Slightly more rounded corners */
            font-size: 1em;
            box-sizing: border-box; /* Important for width calculation */
        }
        #lead-capture-form input:focus { /* More prominent focus style */
             border-color: #007bff;
             outline: none;
             box-shadow: 0 0 0 3px rgba(0,123,255,.25); /* Slightly larger shadow */
        }
        /* Ensure button is styled via the .cta-button class from style.css or add specific here if needed */
        #lead-capture-form button[type="button"] {
            width: 100%;
            padding: 12px 20px;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 10px; /* Space above button */
            background-color: #28a745; /* Green submit */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
         #lead-capture-form button[type="button"]:hover {
            background-color: #218838; /* Darker green on hover */
        }
        .privacy-note {
            font-size: 0.8em;
            color: #777;
            text-align: center;
            margin-top: 15px;
        }

        /* Field explanation styling */
        .field-explanation {
            font-size: 0.8em;
            color: #666;
            margin-top: 4px;
            margin-bottom: 0;
            font-style: italic;
        }

    </style>

    <script src="/tracking.js"></script>
      <link rel="stylesheet" href="../mobile_optimization.css">
    <link rel="stylesheet" href="../hamburger_fix.css">
    <link rel="stylesheet" href="../chat_widget_improvements.css">
    <link rel="stylesheet" href="../hamburger_clickable_fix.css">
</head>
<body>
    <!-- Standard Site Header -->
    <header>
        <nav aria-label="Main Navigation">
            <div class="logo"><a href="../index.html" style="color: inherit; text-decoration: none;">TurnClicksToClients.com</a></div>
            <button class="hamburger" aria-label="Open navigation" aria-expanded="false" aria-controls="main-nav" style="display:none;">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul id="main-nav">
                <li style="margin-right: 8px;"><a href="../index.html">Home</a></li>
                <li style="margin-right: 8px;"><a href="../about.html">About Us</a></li>
                <li class="dropdown-parent" style="margin-right: 8px;">
                    <a href="../index.html#ideal-clients">Clients We Serve <span class="dropdown-arrow">â–¼</span></a>
                    <ul class="dropdown-menu">
                        <li><a href="child-care-centers.html">Child Care Centers</a></li>
                        <li><a href="cosmetic-dentists.html">Cosmetic Dentists</a></li>
                        <li><a href="pmu-artists.html">PMU Artists</a></li>
                        <li><a href="non-surgical-body-contouring.html">Non-Surgical Body Contouring</a></li>
                        <li><a href="weight-loss-clinics.html">Weight Loss Clinics</a></li>
                        <li><a href="high-end-chiropractors.html">High-End Chiropractors</a></li>
                        <li><a href="sleep-apnea-snoring-clinics.html">Sleep Apnea & Snoring Clinics</a></li>
                        <li><a href="hearing-aid-audiology-clinics.html">Hearing Aid & Audiology</a></li>
                        <li><a href="dme-clinics.html">DME Clinics</a></li>
                    </ul>
                </li>
                <li style="margin-right: 8px;"><a href="../index.html#core-offer">Our Offer</a></li>
                <li style="margin-right: 8px;"><a href="../index.html#guarantee">Guarantee</a></li>
                <li><a href="../index.html#cta-contact" class="cta-button nav-cta">Get Started</a></li>
            </ul>
        </nav>
    </header>

    <div class="quiz-page-container">
        <div class="quiz-container">
            <div class="quiz-hook">
                <h1>Unlock Your Cosmetic Practice's Full Potential: Take the 2-Minute Growth Quiz</h1>
                <p class="subheadline">
                    Discover the hidden bottlenecks in your patient attraction and practice management. Get a personalized diagnosis and actionable insights to elevate your Cosmetic Dentistry practice.
                </p>
            </div>

            <!-- Progress Bar Container - will be displayed above quiz-area by JS after first question -->
            <div id="progress-bar-container" class="progress-bar-container" style="display: none;">
                <div id="progress-bar" class="progress-bar"></div>
            </div>

            <div id="quiz-area">
                <!-- Initial Benefit Blocks - Will be hidden after quiz starts -->
                <div class="quiz-benefits-intro" id="quiz-benefits-intro">
                    <div class="benefit-block">
                        <h3>Pinpoint Growth Levers</h3>
                        <p>Identify specific areas in your patient journey and practice operations that can be optimized for significant growth.</p>
                    </div>
                    <div class="benefit-block">
                        <h3>Attract More Ideal Patients</h3>
                        <p>Understand how to consistently attract high-value patients seeking the cosmetic procedures you specialize in.</p>
                    </div>
                    <div class="benefit-block">
                        <h3>Boost Practice Efficiency</h3>
                        <p>Uncover strategies to streamline workflows, improve team performance, and enhance overall practice profitability.</p>
                    </div>
                </div>
                <button class="cta-button" id="start-quiz-btn" onclick="startQuiz()">Start the Quiz &rarr;</button>

                <!-- Questions will be loaded here by JavaScript -->
                <div id="quiz-question" class="quiz-question" style="display:none;">
                    <h2></h2> <!-- Question text will be set here -->
                </div>
                <div id="quiz-answers" class="quiz-answers" style="display:none;">
                    <ul>
                        <!-- Answer buttons will be generated here -->
                    </ul>
                </div>
                <div class="quiz-navigation" style="display:none;">
                    <button id="next-question-btn" class="cta-button" style="display:none;">Next Question</button>
                </div>
            </div>

            <div id="lead-capture-form" class="lead-capture-form" style="display:none;">
                <h2>Almost there! Let's see your results.</h2>
                <p>Please provide your details below to view your personalized growth plan.</p>
                <form id="quizLeadForm">
                    <div class="form-group">
                        <label for="firstName">First Name<span>*</span></label>
                        <input type="text" id="firstName" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name<span>*</span></label>
                        <input type="text" id="lastName" name="lastName" required>
                    </div>
                    <div class="form-group">
                        <label for="businessName">Business Name<span>*</span></label>
                        <input type="text" id="businessName" name="businessName" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email<span>*</span></label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number<span>*</span></label>
                        <input type="tel" id="phone" name="phone" required>
                    </div>
                    <button type="button" onclick="handleLeadSubmit()">See My Results & Get My Plan</button>
                </form>
                <p class="form-thank-you" id="formThankYou" style="display:none;">Thank you! Analyzing your results...</p>
            </div>

            <div id="quiz-result" class="quiz-result" style="display:none;">
                <h3>Calculating Your Results...</h3>
                <p>Please wait a moment.</p>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-main container">
            <div class="footer-info">
                <h3 style="font-size: 1.5em;">TurnClicksToClients.com</h3>
                <p>1309 Coffeen Avenue STE 1200<br>Sheridan Wyoming 82801</p>
                <p>Phone: <a href="tel:+12708181816">(270) 818-1816</a></p>
                <p>Email: <a href="mailto:info@turnclickstoclients.com">info@turnclickstoclients.com</a></p>
            </div>
            <div class="footer-quick-links">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../about.html">About Us</a></li>
                    <li><a href="../index.html#core-offer">Our Offer</a></li>
                    <li><a href="../index.html#guarantee">Guarantee</a></li>
                    <li><a href="../index.html#ideal-clients">Clients We Serve</a></li>
                </ul>
            </div>
            <div class="footer-niches">
                <h4>Our Niche Expertise</h4>
                <ul>
                    <li><a href="child-care-centers.html">Child Care Centers</a></li>
                    <li><a href="cosmetic-dentists.html">Cosmetic Dentists</a></li>
                    <li><a href="pmu-artists.html">PMU Artists</a></li>
                    <li><a href="non-surgical-body-contouring.html">Non-Surgical Body Contouring</a></li>
                    <li><a href="weight-loss-clinics.html">Weight Loss Clinics</a></li>
                    <li><a href="high-end-chiropractors.html">High-End Chiropractors</a></li>
                    <li><a href="sleep-apnea-snoring-clinics.html">Sleep Apnea & Snoring Clinics</a></li>
                    <li><a href="hearing-aid-audiology-clinics.html">Hearing Aid & Audiology</a></li>
                    <li><a href="dme-clinics.html">DME Clinics</a></li>
                </ul>
            </div>
            <div class="footer-social">
                <h4>Connect With Us</h4>
                <a href="https://www.linkedin.com/in/aaron-p-813553112/" aria-label="LinkedIn" target="_blank" rel="noopener noreferrer">
                    LinkedIn
                </a>
                <p>Stay updated with our latest insights and offers.</p>
            </div>
        </div>
        <div class="footer-bottom text-center">
            <p>&copy; <script>document.write(new Date().getFullYear())</script> TurnClicksToClients.com. All rights reserved. | Only one client per city.</p>
        </div>
    </footer>

    <!-- Chat Button and Modal -->
    <div id="chat-widget-button">
        <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg></span> Chat
    </div>
    <div id="chat-modal" class="modal-hidden">
        <div class="chat-modal-content">
            <div class="chat-modal-header">
                <h2>Start a Conversation</h2>
                <button id="chat-modal-close" class="chat-close-button">&times;</button>
            </div>
            <div class="chat-modal-body">
                <p>
                    <strong>Connect with Our Team Live!</strong><br>
                    Mon-Fri, 10am - 5pm EST: Expect a reply within the hour.<br>
                    After hours & weekends: We'll get back to you first thing next business morning.<br><br>
                    Let us know how we can help your business grow! Please fill out the form below.
                </p>
                <form id="chat-contact-form">
                    <div class="form-group">
                        <label for="chat-industry">Your Industry:</label>
                        <select id="chat-industry" name="industry" required>
                            <option value="" disabled selected>Select your industry...</option>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="chat-name">Full Name:</label>
                        <input type="text" id="chat-name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="chat-businessName">Business Name:</label>
                        <input type="text" id="chat-businessName" name="businessName" required>
                    </div>
                    <div class="form-group">
                        <label for="chat-email">Email Address:</label>
                        <input type="email" id="chat-email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="chat-phone">Phone Number:</label>
                        <input type="tel" id="chat-phone" name="phone">
                    </div>
                    <div class="form-group">
                        <label for="chat-message">How can we help you?</label>
                        <textarea id="chat-message" name="message" rows="4" required></textarea>
                    </div>
                    <button type="submit" class="cta-button secondary chat-submit-button">Send Message</button>
                </form>
                <div id="chat-success-message" style="display: none; text-align: center; padding: 20px;">
                    <h3>Thank You!</h3>
                    <p>Our team has been alerted and will get back to you as soon as possible.</p>
                    <p>You can now close this window.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase Client Initialization - Standardized
        const SUPABASE_URL = 'https://eumhqssfvkyuepyrtlqj.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV1bWhxc3Nmdmt5dWVweXJ0bHFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY1NjE0MDEsImV4cCI6MjA2MjEzNzQwMX0.w-UzQq1G6GIinBdlIcW34KBSoeaAK-knNs4AvL8ct64';
        let supabaseClient = null;

        // Initialize Supabase client when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            try {
                if (typeof supabase !== 'undefined' && supabase.createClient) {
                    supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    console.log("Supabase client initialized for Cosmetic Dentists Quiz.");
                } else {
                    console.error("Supabase client library (supabase.js) is not loaded for Cosmetic Dentists Quiz.");
                }
            } catch (e) {
                console.error("Error initializing Supabase client for Cosmetic Dentists Quiz:", e.message);
            }
        });

        const niche = 'Cosmetic Dentists';
        const urlParams = new URLSearchParams(window.location.search);
        // Keep improved source param logic, but use consistent variable name
        const sourceParam = urlParams.get('utm_source') || urlParams.get('source') || '';

        let currentQuestionIndex = 0;
        let userAnswers = [];
        let totalScore = 0;
        let quizStarted = false;

        // Comprehensive Quiz Questions for Cosmetic Dentists
        const quizQuestions = [
            {
                question: "How effectively does your practice utilize high-quality before & after photos and patient testimonials in your marketing and patient consultations?",
                answers: [
                    { text: "Minimally; we don't have a systematic way to collect or showcase them.", score: 1 },
                    { text: "Somewhat; we have some photos/testimonials but don't use them consistently or strategically.", score: 2 },
                    { text: "Well; we regularly feature them on our website/social media and in consultations.", score: 3 },
                    { text: "Expertly; they are a cornerstone of our marketing and a key tool for demonstrating value to prospective patients.", score: 4 }
                ]
            },
            {
                question: "How would you describe your patient experience for high-value cosmetic procedures (e.g., veneers, smile makeovers, full mouth reconstructions)?",
                answers: [
                    { text: "Standard; similar to general dentistry appointments.", score: 1 },
                    { text: "Comfortable; we try to make it pleasant, but it's not a highly differentiated 'premium' experience.", score: 2 },
                    { text: "Premium; we offer enhanced comfort, personalized attention, and amenities that make patients feel valued.", score: 3 },
                    { text: "Luxury/Concierge; every detail is curated to provide an exceptional, memorable, and exclusive experience from start to finish.", score: 4 }
                ]
            },
            {
                question: "How proactive is your practice in following up with patients who have expressed interest in cosmetic treatments but haven't proceeded?",
                answers: [
                    { text: "Not very; we mostly wait for them to re-engage.", score: 1 },
                    { text: "Occasionally; we might send a general reminder or follow-up if we remember.", score: 2 },
                    { text: "Systematically; we have a process for timely follow-ups and providing additional information or consultations.", score: 3 },
                    { text: "Strategically; we use a multi-touch follow-up sequence tailored to their specific interests and concerns, often including financing options.", score: 4 }
                ]
            },
            {
                question: "How well-defined and communicated is your practice's unique selling proposition (USP) for cosmetic dentistry? (i.e., What makes you the clear choice over other dentists?)",
                answers: [
                    { text: "Not clearly defined or communicated; we're seen as a general dental practice that also does cosmetic work.", score: 1 },
                    { text: "Somewhat defined; we mention our cosmetic services, but our distinct advantages aren't always clear to patients.", score: 2 },
                    { text: "Clearly defined; our team understands our USP, and it's communicated in our marketing materials.", score: 3 },
                    { text: "Powerfully defined and consistently communicated; our USP is compelling, differentiates us significantly, and is evident in every patient touchpoint.", score: 4 }
                ]
            },
            {
                question: "What is your practice's primary growth goal related to cosmetic dentistry for the next 1-3 years?",
                answers: [
                    { text: "Maintaining current cosmetic patient flow.", score: 1 },
                    { text: "Gradually increasing the number of cosmetic cases.", score: 2 },
                    { text: "Significantly boosting revenue from high-value cosmetic procedures.", score: 3 },
                    { text: "Becoming the leading cosmetic dentist in our area, known for specific advanced treatments or exceptional results.", score: 4 }
                ]
            },
            // Additional questions for more comprehensive assessment
            {
                question: "How effectively does your practice utilize digital marketing channels to attract cosmetic dentistry patients?",
                answers: [
                    { text: "Minimally; we have little to no digital marketing strategy specifically for cosmetic services.", score: 1 },
                    { text: "Basic; we have some online presence but it's not strategically targeted at cosmetic patients.", score: 2 },
                    { text: "Good; we actively manage digital campaigns focused on cosmetic services with decent results.", score: 3 },
                    { text: "Excellent; we have a comprehensive digital strategy that consistently brings in qualified cosmetic patients.", score: 4 }
                ]
            },
            {
                question: "How would you rate your practice's case presentation process for high-value cosmetic treatments?",
                answers: [
                    { text: "Basic; we typically just explain the treatment options verbally.", score: 1 },
                    { text: "Moderate; we use some visual aids but our presentation process isn't highly refined.", score: 2 },
                    { text: "Good; we have a structured presentation process with quality visuals and materials.", score: 3 },
                    { text: "Excellent; we have a sophisticated, multi-step presentation process with digital smile design, high-quality visuals, and emotional connection points.", score: 4 }
                ]
            },
            {
                question: "How effectively does your practice track and analyze key performance metrics for your cosmetic dentistry services?",
                answers: [
                    { text: "Minimally; we don't separately track metrics for cosmetic services.", score: 1 },
                    { text: "Somewhat; we track basic revenue figures but don't analyze detailed metrics.", score: 2 },
                    { text: "Well; we track several metrics and regularly review performance data.", score: 3 },
                    { text: "Very effectively; we have comprehensive tracking of all cosmetic service metrics and use data to drive decisions.", score: 4 }
                ]
            },
            {
                question: "How would you describe your team's training and expertise in supporting cosmetic dentistry patients?",
                answers: [
                    { text: "Minimal specialized training; our team handles cosmetic patients the same as general dentistry.", score: 1 },
                    { text: "Basic; some team members have additional training but it's not comprehensive.", score: 2 },
                    { text: "Good; our team has received specific training on cosmetic patient communication and care.", score: 3 },
                    { text: "Excellent; our entire team is extensively trained in cosmetic patient psychology, communication, and delivering an exceptional experience.", score: 4 }
                ]
            },
            {
                question: "How effectively does your practice handle treatment financing options for cosmetic procedures?",
                answers: [
                    { text: "Minimally; we mention financing is available if patients ask about it.", score: 1 },
                    { text: "Somewhat; we offer basic financing options but don't proactively present them.", score: 2 },
                    { text: "Well; we present financing options as part of our standard treatment presentation.", score: 3 },
                    { text: "Very effectively; we have multiple financing solutions and expertly integrate them into our case presentation to overcome financial barriers.", score: 4 }
                ]
            },
            // New "Growth-Stifler" question
            {
                question: "Every business has them: those 'invisible chains' of costly overhead or tedious manual processes that secretly stifle growth and sanity. What ONE such chain, if broken, would provide the most immediate and profound boost to your business\'s efficiency and your personal peace of mind? *",
                type: "textarea", // Identify this as a special question type
                id: "growth_stifler_response_quiz" // Unique ID for the textarea
            }
        ];

        const quizArea = document.getElementById('quiz-area');
        const quizBenefitsIntro = document.getElementById('quiz-benefits-intro');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const quizQuestionDiv = document.getElementById('quiz-question');
        const quizAnswersDiv = document.getElementById('quiz-answers');
        const quizNavigationDiv = document.querySelector('.quiz-navigation');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const leadCaptureForm = document.getElementById('lead-capture-form');
        const quizResultDiv = document.getElementById('quiz-result');
        const progressBarContainer = document.getElementById('progress-bar-container');
        const progressBar = document.getElementById('progress-bar');

        function determineOutcome(score) {
            // Match actual folder structure in quiz-applications/cosmetic-dentistry
            if (score <= 7) return "foundation";
            if (score <= 14) return "growth";
            return "scaling";
        }

        function startQuiz() {
            quizStarted = true;
            if (quizBenefitsIntro) quizBenefitsIntro.style.display = 'none';
            if (startQuizBtn) startQuizBtn.style.display = 'none';
            if (quizQuestionDiv) quizQuestionDiv.style.display = 'block';
            if (quizAnswersDiv) quizAnswersDiv.style.display = 'block';
            if (quizNavigationDiv) quizNavigationDiv.style.display = 'none';
            if (nextQuestionBtn) nextQuestionBtn.style.display = 'none';
            if (progressBarContainer) progressBarContainer.style.display = 'block';
            displayQuestion();
        }

        function displayQuestion() {
            if (currentQuestionIndex < quizQuestions.length) {
                const questionData = quizQuestions[currentQuestionIndex];
                const h2 = quizQuestionDiv.querySelector('h2');
                h2.textContent = questionData.question;

                const oldInstruction = quizQuestionDiv.querySelector('p.instruction-text');
                if (oldInstruction) {
                    oldInstruction.remove();
                }

                const answersUl = quizAnswersDiv.querySelector('ul');
                answersUl.innerHTML = ''; // Clear previous answers or textarea

                if (questionData.type === "textarea") {
                    const instructionP = document.createElement('p');
                    instructionP.textContent = "Please type your answer below:";
                    instructionP.className = 'instruction-text';
                    instructionP.style.fontSize = '0.9em';
                    instructionP.style.color = '#666';
                    instructionP.style.marginTop = '5px';
                    h2.after(instructionP);

                    // Remove any existing "why we're asking" explanation
                    const existingWhyAskingP = quizQuestionDiv.querySelector('.why-asking-explanation');
                    if (existingWhyAskingP) {
                        existingWhyAskingP.remove();
                    }

                    // Add "why we're asking" explanation
                    const whyAskingP = document.createElement('p');
                    whyAskingP.className = 'why-asking-explanation'; // Add a class for easy identification
                    whyAskingP.innerHTML = "<strong>Why we're asking:</strong> We want to understand your specific challenges so we can tailor our recommendations to address your most pressing needs and help you achieve faster results.";
                    whyAskingP.style.fontSize = '0.85em';
                    whyAskingP.style.color = '#555';
                    whyAskingP.style.backgroundColor = '#f8f9fa';
                    whyAskingP.style.padding = '10px';
                    whyAskingP.style.borderRadius = '4px';
                    whyAskingP.style.marginTop = '10px';
                    whyAskingP.style.marginBottom = '15px';
                    whyAskingP.style.borderLeft = '3px solid #007bff';
                    instructionP.after(whyAskingP);

                    const li = document.createElement('li');
                    const textarea = document.createElement('textarea');
                    textarea.id = questionData.id;
                    textarea.name = questionData.id;
                    textarea.rows = 4;
                    textarea.style.width = '100%'; // Basic styling
                    textarea.style.padding = '10px';
                    textarea.style.borderColor = '#ccc';
                    textarea.style.borderRadius = '4px';
                    textarea.required = true; // Make it required
                    li.appendChild(textarea);
                    answersUl.appendChild(li);

                    // Modify Next button behavior for textarea
                    nextQuestionBtn.textContent = "Next";
                    nextQuestionBtn.onclick = handleTextareaAnswer;
                    quizNavigationDiv.style.display = 'block'; // Show navigation for next button
                    nextQuestionBtn.style.display = 'inline-block'; // Show next button

                } else {
                    const instructionP = document.createElement('p');
                    instructionP.textContent = "Select your answer below:";
                    instructionP.className = 'instruction-text';
                    instructionP.style.fontSize = '0.9em';
                    instructionP.style.color = '#666';
                    instructionP.style.marginTop = '5px';
                    h2.after(instructionP);

                    // Remove any existing "why we're asking" explanation
                    const existingWhyAskingP = quizQuestionDiv.querySelector('.why-asking-explanation');
                    if (existingWhyAskingP) {
                        existingWhyAskingP.remove();
                    }

                    // Add "why we're asking" explanation with specific reasons based on question index
                    const whyAskingP = document.createElement('p');
                    whyAskingP.className = 'why-asking-explanation'; // Add a class for easy identification
                    let whyText = "";

                    // Customize the explanation based on the question
                    switch(currentQuestionIndex) {
                        case 0:
                            whyText = "We're asking because effective use of visual proof is one of the strongest predictors of cosmetic dentistry success. Your answer helps us understand if this is a growth opportunity for your practice.";
                            break;
                        case 1:
                            whyText = "We're asking because the patient experience directly impacts case acceptance rates and referrals. Your answer helps us identify if enhancing your patient experience could boost your practice growth.";
                            break;
                        case 2:
                            whyText = "We're asking because follow-up systems often represent the biggest revenue opportunity in cosmetic practices. Your answer helps us determine if this is a key area for improvement.";
                            break;
                        case 3:
                            whyText = "We're asking because a clear USP is essential for standing out in competitive markets. Your answer helps us assess if refining your positioning could accelerate your growth.";
                            break;
                        case 4:
                            whyText = "We're asking because your growth goals influence which strategies will be most effective for your practice. Your answer helps us tailor our recommendations to your specific ambitions.";
                            break;
                        case 5:
                            whyText = "We're asking because digital marketing effectiveness directly impacts your new patient acquisition. Your answer helps us identify if your marketing approach needs optimization.";
                            break;
                        case 6:
                            whyText = "We're asking because case presentation quality dramatically affects case acceptance rates. Your answer helps us determine if enhancing your presentation process could increase conversions.";
                            break;
                        case 7:
                            whyText = "We're asking because data-driven decision making is a key differentiator between high and average-performing practices. Your answer helps us assess your analytical capabilities.";
                            break;
                        case 8:
                            whyText = "We're asking because team training directly impacts patient experience and case acceptance. Your answer helps us identify if staff development could be a growth lever for your practice.";
                            break;
                        case 9:
                            whyText = "We're asking because financing options can remove the biggest barrier to case acceptance. Your answer helps us determine if improving your financing approach could increase conversions.";
                            break;
                        default:
                            whyText = "We're asking to better understand your practice and provide more tailored recommendations for growth.";
                    }

                    whyAskingP.innerHTML = "<strong>Why we're asking:</strong> " + whyText;
                    whyAskingP.style.fontSize = '0.85em';
                    whyAskingP.style.color = '#555';
                    whyAskingP.style.backgroundColor = '#f8f9fa';
                    whyAskingP.style.padding = '10px';
                    whyAskingP.style.borderRadius = '4px';
                    whyAskingP.style.marginTop = '10px';
                    whyAskingP.style.marginBottom = '15px';
                    whyAskingP.style.borderLeft = '3px solid #007bff';
                    instructionP.after(whyAskingP);

                    questionData.answers.forEach((answer) => {
                        const li = document.createElement('li');
                        const button = document.createElement('button');
                        button.classList.add('answer-btn');
                        button.textContent = answer.text;
                        button.onclick = () => selectAnswer(answer.score, button);
                        li.appendChild(button);
                        answersUl.appendChild(li);
                    });
                    quizNavigationDiv.style.display = 'none'; // Hide nav for multiple choice
                    nextQuestionBtn.style.display = 'none'; // Hide next button for multiple choice (auto-advance)
                }
                updateProgressBar();
            } else {
                showLeadCaptureForm();
            }
        }

        function handleTextareaAnswer() {
            const questionData = quizQuestions[currentQuestionIndex];
            const textarea = document.getElementById(questionData.id);
            if (textarea && textarea.value.trim() !== "") {
                userAnswers[currentQuestionIndex] = textarea.value.trim(); // Store the text answer
                nextQuestion();
            } else {
                alert("Please provide an answer to this question.");
            }
        }

        function selectAnswer(score, selectedButton) {
            const buttons = quizAnswersDiv ? quizAnswersDiv.querySelectorAll('.answer-btn') : [];
            buttons.forEach(btn => btn.classList.remove('selected'));
            selectedButton.classList.add('selected');
            userAnswers[currentQuestionIndex] = score;
            setTimeout(nextQuestion, 500);
        }

        function nextQuestion() {
            const currentQuestionData = quizQuestions[currentQuestionIndex];
            if (currentQuestionData.type !== "textarea" && userAnswers[currentQuestionIndex] === undefined) {
                alert("Please select an answer before proceeding.");
                return;
            }

            currentQuestionIndex++;
            if (currentQuestionIndex < quizQuestions.length) {
                displayQuestion();
            } else {
                showLeadCaptureForm();
            }
        }

        function updateProgressBar() {
            const progress = (currentQuestionIndex / quizQuestions.length) * 100;
            if (progressBar) progressBar.style.width = progress + '%';
        }

        function showLeadCaptureForm() {
            if (quizQuestionDiv) quizQuestionDiv.style.display = 'none';
            if (quizAnswersDiv) quizAnswersDiv.style.display = 'none';
            if (quizNavigationDiv) quizNavigationDiv.style.display = 'none';
            if (progressBarContainer) progressBarContainer.style.display = 'none';
            if (leadCaptureForm) leadCaptureForm.style.display = 'block';
            totalScore = userAnswers.reduce((acc, score) => acc + (typeof score === 'number' ? score : 0), 0);
            console.log("Final Score: ", totalScore);
        }

        async function handleLeadSubmit() {
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const businessName = document.getElementById('businessName').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();

            let growth_stifler_response = "";
            const growthStiflerQuestionIndex = quizQuestions.findIndex(q => q.type === "textarea");
            if (growthStiflerQuestionIndex !== -1 && userAnswers[growthStiflerQuestionIndex]) {
                growth_stifler_response = userAnswers[growthStiflerQuestionIndex];
            }

            if (!firstName || !lastName || !businessName || !email || !phone) {
                alert("Please fill in all required fields in the form.");
                return;
            }

            if (growthStiflerQuestionIndex !== -1 && !userAnswers[growthStiflerQuestionIndex]) {
                 alert("Please ensure all quiz questions, including the open-ended one, are answered.");
                 return;
            }

            leadCaptureForm.style.display = 'none';
            if (quizResultDiv) {
                quizResultDiv.style.display = 'block';
                quizResultDiv.querySelector('h3').textContent = "Calculating Your Results...";
                quizResultDiv.querySelector('p').textContent = "Please wait a moment while we tailor your insights.";
            }

            const detailedQuizAnswers = userAnswers.map((answerData, index) => {
                const questionData = quizQuestions[index];
                if (questionData.type === "textarea") {
                    return {
                        question: questionData.question,
                        answer: answerData,
                        score: null
                    };
                }
                const selectedAnswerObject = questionData.answers.find(ans => ans.score === answerData);
                return {
                    question: questionData.question,
                    answer: selectedAnswerObject ? selectedAnswerObject.text : "N/A - Score not found",
                    score: answerData
                };
            });

            const primaryOutcomeHint = determineOutcome(totalScore);

            const submissionData = {
                first_name: firstName,
                last_name: lastName,
                business_name: businessName,
                email: email,
                growth_stifler_response: growth_stifler_response,
                phone: phone,
                total_score: totalScore,
                niche: niche,
                quiz_answers: detailedQuizAnswers,
                primary_outcome_hint: primaryOutcomeHint,
                source: sourceParam || 'organic',
                submitted_at: new Date().toISOString(),
            };

            console.log("Submission data prepared:", submissionData);

            let dbErrorMessage = null;
            if (!supabaseClient) {
                console.error("Supabase client is not initialized!");
                dbErrorMessage = 'Supabase client not initialized';
            } else {
                try {
                    console.log("Attempting to insert data into Supabase...");
                    const { data, error } = await supabaseClient
                        .from('tctc_quiz_submission')
                        .insert([submissionData])
                        .select();

                    if (error) {
                        console.error('Cosmetic Dentists Quiz: Error inserting data into Supabase:', error);
                        dbErrorMessage = error.message || 'Unknown DB Error';
                    } else {
                        console.log('Cosmetic Dentists Quiz: Data successfully inserted into Supabase:', data);
                        // INVOKE THE EDGE FUNCTION TO SEND TO SLACK
                        try {
                            console.log('Cosmetic Dentists Quiz: Attempting to invoke quiz-slack-notify Edge Function with data:', submissionData);
                            const { data: funcData, error: funcError } = await supabaseClient.functions.invoke('quiz-slack-notify', {
                                body: submissionData // Pass the same submissionData
                            });

                            if (funcError) {
                                console.error('Cosmetic Dentists Quiz: Error invoking quiz-slack-notify Edge Function:', funcError);
                            } else {
                                console.log('Cosmetic Dentists Quiz: quiz-slack-notify Edge Function invoked successfully:', funcData);
                            }
                        } catch (invokeCatchError) {
                            console.error('Cosmetic Dentists Quiz: Exception caught when trying to invoke Edge Function:', invokeCatchError);
                        }
                    }
                } catch (e) {
                    console.error('Cosmetic Dentists Quiz: Exception during Supabase insert:', e);
                    dbErrorMessage = e.message || 'DB Insert Exception';
                }
            }

            determineOutcomeAndRedirect(firstName, lastName, businessName, totalScore, supabaseClient, dbErrorMessage, sourceParam, dbErrorMessage);
        }

        async function determineOutcomeAndRedirect(firstName, lastName, businessName, totalScore, supabaseClient, dbError, sourceParam, supabaseInsertError) {
            const encodedFirstName = encodeURIComponent(firstName);
            const encodedLastName = encodeURIComponent(lastName);
            const encodedBusinessName = encodeURIComponent(businessName);
            const baseParams = `firstName=${encodedFirstName}&lastName=${encodedLastName}&businessName=${encodedBusinessName}&score=${totalScore}`;
            const sourceAndDbErrorParams = `${sourceParam ? `&source=${encodeURIComponent(sourceParam)}` : ''}&track_source=quiz${dbError ? `&dbError=${encodeURIComponent(supabaseInsertError?.message || 'Unknown error')}` : ''}`;

            // Determine the outcome bucket based on the score
            const outcome = determineOutcome(totalScore);
            const scoreBucket = outcome; // foundation, growth, or scaling

            // Determine which awareness variant to show based on score distribution
            let awarenessVariant;
            if (scoreBucket === "foundation") {
                // Lower scores within this bucket get problem variant, higher get solution variant, etc.
                if (totalScore <= 5) {
                    awarenessVariant = "b-problem"; // Problem Aware
                } else if (totalScore <= 6) {
                    awarenessVariant = "a-solution"; // Solution Aware
                } else {
                    awarenessVariant = "c-most-aware"; // Most Aware
                }
            }
            else if (scoreBucket === "scaling") {
                if (totalScore <= 16) {
                    awarenessVariant = "b-problem"; // Problem Aware
                } else if (totalScore <= 18) {
                    awarenessVariant = "a-solution"; // Solution Aware
                } else {
                    awarenessVariant = "c-most-aware"; // Most Aware
                }
            }
            else { // growth
                if (totalScore <= 10) {
                    awarenessVariant = "b-problem"; // Problem Aware
                } else if (totalScore <= 12) {
                    awarenessVariant = "a-solution"; // Solution Aware
                } else {
                    awarenessVariant = "c-most-aware"; // Most Aware
                }
            }

            // Randomly select one of the three split test variations
            const splitVariation = Math.floor(Math.random() * 3) + 1; // Random number between 1 and 3

            // Debug logging to help troubleshoot
            console.log(`Cosmetic Dentists: Redirecting to ${scoreBucket} bucket, variant: ${awarenessVariant}, split test variation: ${splitVariation}`);

            let url;

            // If it's the solution-aware, problem-aware, or most-aware variant, use the split test variations
            if (awarenessVariant === "a-solution" || awarenessVariant === "b-problem" || awarenessVariant === "c-most-aware") {
                url = `../quiz-applications/cosmetic-dentistry/${scoreBucket}/${scoreBucket}-variant-${awarenessVariant}-split${splitVariation}.html${baseParams ? '?' + baseParams : '?'}${sourceAndDbErrorParams}&bucket=${scoreBucket}&variant=${awarenessVariant}&split=${splitVariation}`;
            } else {
                // For other awareness variants, use the original pages
                url = `../quiz-applications/cosmetic-dentistry/${scoreBucket}/${scoreBucket}-variant-${awarenessVariant}.html${baseParams ? '?' + baseParams : '?'}${sourceAndDbErrorParams}&bucket=${scoreBucket}&variant=${awarenessVariant}`;
            }

            // Track the redirection in Supabase before redirecting
            if (supabaseClient) {
                try {
                    const { data, error } = await supabaseClient
                        .from('tctc_quiz_redirections')
                        .insert([{
                            user_first_name: firstName,
                            user_last_name: lastName,
                            user_business_name: businessName,
                            quiz_score: totalScore,
                            outcome_bucket: scoreBucket,
                            awareness_variant: awarenessVariant,
                            split_variation: (awarenessVariant === "a-solution" || awarenessVariant === "b-problem" || awarenessVariant === "c-most-aware") ? splitVariation : null,
                            redirect_url: url,
                            source: sourceParam || 'organic',
                            redirected_at: new Date().toISOString()
                        }]);

                    if (error) {
                        console.error('Error tracking cosmetic dentists redirection:', error);
                    } else {
                        console.log('Cosmetic dentists redirection tracking successful:', data);
                    }
                } catch (e) {
                    console.error('Exception during cosmetic dentists redirection tracking:', e);
                }
            }

            // Redirect regardless of tracking success
            console.log("Cosmetic Dentists: Redirecting to:", url);
            window.location.href = url;
        }

        // Remove redundant DOMContentLoaded wrapper as functions are assigned to window or handled by HTML event attributes.

        // Assign to window object if functions are called from HTML onclick attributes.
        window.startQuiz = startQuiz;
        window.handleLeadSubmit = handleLeadSubmit; // Called from form onsubmit
    </script>

    <script src="../script.js"></script>
    <script src="../tracking.js"></script>
    <script src="../tracking-enhanced.js"></script>
    <script src="../hamburger_fix.js"></script>
</body>
</html>
