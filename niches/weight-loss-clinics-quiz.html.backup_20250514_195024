<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weight Loss Clinic Growth Quiz | TurnClicksToClients</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Basic styles copied, ensure consistency with main site */
        body {
            font-family: 'Lato', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f4f4f4;
        }
        .quiz-page-container {
            padding-top: 20px;
            padding-bottom: 40px;
        }
        .quiz-container {
            max-width: 850px;
            margin: 20px auto;
            padding: 30px 40px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            text-align: center;
        }
        .quiz-hook h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: clamp(1.8em, 4vw, 2.4em);
            color: #0056b3;
            margin-bottom: 0.5em;
        }
        .quiz-hook p.subheadline {
            font-size: clamp(1em, 2vw, 1.15em);
            color: #555;
            margin-bottom: 30px;
            max-width: 650px;
            margin-left: auto;
            margin-right: auto;
        }
        .quiz-benefits-intro {
            margin: 30px 0 40px 0;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            text-align: left;
        }
        .benefit-block {
            background-color: #f9f9f9;
            padding: 18px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            border-left: 4px solid #007bff;
            flex: 1;
            min-width: 230px;
        }
        .benefit-block:nth-child(2) { border-left-color: #28a745; }
        .benefit-block:nth-child(3) { border-left-color: #ffc107; }
        .benefit-block h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.15em;
            color: #333;
            margin-bottom: 8px;
        }
        .benefit-block p { font-size: 0.9em; color: #666; line-height: 1.5; }
        .progress-bar-container {
            width: 100%;
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin-bottom: 30px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: #28a745;
            border-radius: 5px;
            transition: width 0.4s ease;
        }
        #quiz-area {
            background-color: #fdfdfd;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .quiz-question h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: clamp(1.3em, 3vw, 1.7em);
            color: #2c3e50;
            margin-bottom: 30px;
            line-height: 1.4;
        }
        .quiz-answers ul { list-style: none; padding: 0; margin: 0 0 15px 0; }
        .quiz-answers li { margin-bottom: 12px; }
        .answer-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #007bff;
            color: white;
            border: 1px solid #007bff;
            border-radius: 5px;
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
            text-align: left;
        }
        .answer-btn:hover { background-color: #0056b3; border-color: #0056b3; }
        .answer-btn.selected { background-color: #004085; border-color: #00376e; color: #fff; }
        .quiz-navigation .cta-button { margin-top: 15px; }
        #quiz-result { padding: 20px; background-color: #e9f5ff; border: 1px solid #b8d6f0; border-radius: 5px; text-align: center; margin-top: 20px; }
        #quiz-result h3 { color: #0056b3; margin-bottom: 10px;}
        #quiz-result p { color: #333; }
        #lead-capture-form {
            margin-top: 30px; padding: 30px; background-color: #f0f8ff; 
            border-radius: 8px; border: 1px solid #cce5ff; text-align: left;
        }
        #lead-capture-form h3 {
            font-family: 'Montserrat', sans-serif; text-align: center; color: #0056b3;
            margin-bottom: 15px; font-size: 1.5em;
        }
        #lead-capture-form p { text-align: center; color: #555; margin-bottom: 25px; font-size: 1.05em; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #333; font-size: 0.9em; }
        .form-group input[type="text"], .form-group input[type="email"], .form-group input[type="tel"] {
            width: 100%; padding: 10px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em;
        }
        .form-group input:focus { border-color: #007bff; outline: none; box-shadow: 0 0 0 2px rgba(0,123,255,.25);}
        #lead-capture-form .cta-button { width: 100%; padding: 12px; font-size: 1.2em; margin-top: 10px; background-color: #28a745; }
        #lead-capture-form .cta-button:hover { background-color: #1e7e34; }
        .privacy-note { font-size: 0.8em; color: #777; text-align: center; margin-top: 15px; }
    </style>

    <script src="/tracking.js"></script>
  </head>
<body>
    <header>
        <nav aria-label="Main Navigation">
            <div class="logo"><a href="../index.html" style="color: inherit; text-decoration: none;">TurnClicksToClients.com</a></div>
            <button class="hamburger" aria-label="Open navigation" aria-expanded="false" aria-controls="main-nav" style="display:none;">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul id="main-nav">
                <li><a href="../index.html">Home</a></li>
                <li><a href="../about.html">About Us</a></li>
                <li class="dropdown-parent">
                    <a href="../index.html#ideal-clients">Clients We Serve <span class="dropdown-arrow">â–¼</span></a>
                    <ul class="dropdown-menu">
                        <li><a href="child-care-centers.html">Child Care Centers</a></li>
                        <li><a href="cosmetic-dentists.html">Cosmetic Dentists</a></li>
                        <li><a href="pmu-artists.html">PMU Artists</a></li>
                        <li><a href="non-surgical-body-contouring.html">Non-Surgical Body Contouring</a></li>
                        <li><a href="weight-loss-clinics.html">Weight Loss Clinics</a></li>
                        <li><a href="high-end-chiropractors.html">High-End Chiropractors</a></li>
                        <li><a href="sleep-apnea-snoring-clinics.html">Sleep Apnea & Snoring Clinics</a></li>
                        <li><a href="hearing-aid-audiology-clinics.html">Hearing Aid & Audiology</a></li>
                        <li><a href="dme-clinics.html">DME Clinics</a></li>
                    </ul>
                </li>
                <li><a href="../index.html#core-offer">Our Offer</a></li>
                <li><a href="../index.html#pricing">Pricing</a></li>
                <li><a href="../index.html#guarantee">Guarantee</a></li>
                <li><a href="#cta-contact-niche" class="cta-button nav-cta">Book a Call</a></li>
            </ul>
        </nav>
    </header>

    <div class="quiz-page-container">
        <div class="quiz-container">
            <div class="quiz-hook">
                <h1>Transform More Lives: The Weight Loss Clinic Growth Quiz</h1>
                <p class="subheadline">
                    Identify bottlenecks in patient acquisition, program effectiveness, and clinic operations to help more people achieve their weight loss goals and scale your clinic's impact.
                </p>
            </div>

            <div id="progress-bar-container" class="progress-bar-container" style="display: none;">
                <div id="progress-bar" class="progress-bar"></div>
            </div>

            <div id="quiz-area">
                <div class="quiz-benefits-intro" id="quiz-benefits-intro">
                    <div class="benefit-block">
                        <h3>Attract Committed Patients</h3>
                        <p>Learn to consistently enroll patients who are truly ready for a transformative weight loss journey.</p>
                    </div>
                    <div class="benefit-block">
                        <h3>Optimize Program Delivery</h3>
                        <p>Discover ways to enhance your program's effectiveness, patient adherence, and long-term success stories.</p>
                    </div>
                    <div class="benefit-block">
                        <h3>Scale Your Clinic's Reach</h3>
                        <p>Uncover strategies to expand your clinic's capacity and help a greater number of people achieve healthier lives.</p>
                    </div>
                </div>
                <button class="cta-button" id="start-quiz-btn" onclick="startQuiz()">Start the Quiz &rarr;</button>
                
                <div id="quiz-question" class="quiz-question" style="display:none;">
                    <h2></h2>
                </div>
                <div id="quiz-answers" class="quiz-answers" style="display:none;">
                    <ul></ul>
                </div>
                <div class="quiz-navigation" style="display:none;">
                    <button id="next-question-btn" class="cta-button" onclick="nextQuestion()" style="display:none;">Next Question</button>
                </div>
            </div>
            
            <div id="lead-capture-form" style="display:none;">
                <h3>Unlock Your Clinic Growth Insights!</h3>
                <p>Provide your details to receive your personalized Weight Loss Clinic growth diagnosis and key recommendations.</p>
                <form onsubmit="event.preventDefault(); handleLeadSubmit();">
                    <div class="form-group">
                        <label for="firstName">First Name:</label>
                        <input type="text" id="firstName" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name:</label>
                        <input type="text" id="lastName" name="lastName" required>
                    </div>
                    <div class="form-group">
                        <label for="businessName">Clinic Name:</label>
                        <input type="text" id="businessName" name="businessName" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number:</label>
                        <input type="tel" id="phone" name="phone" required>
                    </div>
                    <button type="submit" class="cta-button">See My Clinic Potential!</button>
                </form>
                <p class="privacy-note">We respect your privacy. Your information is kept confidential.</p>
            </div>

            <div id="quiz-result" style="display:none;">
                <h3>Calculating Your Custom Clinic Blueprint...</h3>
                <p>Please wait while we prepare your personalized insights.</p>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-main container">
            <div class="footer-column footer-info">
                <h3>TurnClicksToClients.com</h3>
                <p>1309 Coffeen Avenue STE 1200<br>Sheridan Wyoming 82801</p>
                <p>Phone: <a href="tel:+12708181816">(270) 818-1816</a></p>
                <p>Email: <a href="mailto:info@turnclickstoclients.com">info@turnclickstoclients.com</a></p>
            </div>
            <div class="footer-column footer-quick-links">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../about.html">About Us</a></li>
                    <li><a href="../index.html#ideal-clients">Clients We Serve</a></li>
                    <li><a href="../index.html#core-offer">Our Offer</a></li>
                    <li><a href="../index.html#pricing">Pricing</a></li>
                    <li><a href="../index.html#guarantee">Guarantee</a></li>
                    <li><a href="../contact.html">Contact Us</a></li>
                    <li><a href="../privacy-policy.html">Privacy Policy</a></li>
                    <li><a href="../terms-of-service.html">Terms of Service</a></li>
                </ul>
            </div>
            <div class="footer-column footer-niches">
                <h3>Niche Expertise</h3>
                <ul>
                    <li><a href="child-care-centers.html">Child Care Centers</a></li>
                    <li><a href="cosmetic-dentists.html">Cosmetic Dentists</a></li>
                    <li><a href="pmu-artists.html">PMU Artists</a></li>
                    <li><a href="non-surgical-body-contouring.html">Body Contouring</a></li>
                    <li><a href="weight-loss-clinics.html">Weight Loss Clinics</a></li>
                    <li><a href="high-end-chiropractors.html">Chiropractors</a></li>
                    <li><a href="sleep-apnea-snoring-clinics.html">Sleep Apnea Clinics</a></li>
                    <li><a href="hearing-aid-audiology-clinics.html">Audiology Clinics</a></li>
                    <li><a href="dme-clinics.html">DME Clinics</a></li>
                </ul>
            </div>
            <div class="footer-column footer-social">
                <h3>Connect With Us</h3>
                <div class="social-icons">
                     <a href="https://www.linkedin.com/in/aaron-p-813553112/" aria-label="LinkedIn" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="24" height="24" fill="currentColor"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.5 0-39.8 27-39.8 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg></a>
                </div>
                <p>Stay updated with our latest insights and offers.</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; <script>document.write(new Date().getFullYear())</script> TurnClicksToClients.com. All rights reserved. | One Client Per City, Per Niche.</p>
        </div>
    </footer>

    <!-- Chat Modal 3 -->
    <div id="chat-widget-button">
        <span>ðŸ’¬</span> Have a ?<br>Click Here To Send Us a Instant Message
    </div>
    <div id="chat-modal" class="modal-hidden">
        <div class="chat-modal-content">
            <div class="chat-modal-header">
                <h2>Start a Conversation</h2>
                <button id="chat-modal-close" class="chat-close-button">&times;</button>
            </div>
            <div class="chat-modal-body">
                <p>
                    <strong>Connect with Our Team Live!</strong><br>
                    Mon-Fri, 10am - 5pm EST: Expect a reply within the hour.<br>
                    After hours & weekends: We'll get back to you first thing next business morning.<br><br>
                    Let us know how we can help your business grow! Please fill out the form below.
                </p>
                <form id="chat-contact-form">
                    <div class="form-group">
                        <label for="chat-industry">Your Industry</label>
                        <select id="chat-industry" name="industry" required>
                            <option value="" disabled selected>Select your industry...</option>
                            <!-- Options will be populated by script.js -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="chat-name">Full Name</label>
                        <input type="text" id="chat-name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="chat-businessName">Business Name</label>
                        <input type="text" id="chat-businessName" name="businessName" required>
                    </div>
                    <div class="form-group">
                        <label for="chat-email">Email Address</label>
                        <input type="email" id="chat-email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="chat-phone">Phone Number</label>
                        <input type="tel" id="chat-phone" name="phone">
                    </div>
                    <div class="form-group">
                        <label for="chat-message">How can we help you?</label>
                        <textarea id="chat-message" name="message" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="cta-button">Send Message</button>
                </form>
                <div id="chat-success-message" style="display: none; text-align: center; padding: 20px;">
                    <h3>Thank You!</h3>
                    <p>Our team has been alerted and will get back to you as soon as possible.</p>
                    <p>You can now close this window.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase Client Initialization
        const SUPABASE_URL = 'https://eumhqssfvkyuepyrtlqj.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV1bWhxc3Nmdmt5dWVweXJ0bHFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY1NjE0MDEsImV4cCI6MjA2MjEzNzQwMX0.w-UzQq1G6GIinBdlIcW34KBSoeaAK-knNs4AvL8ct64';
        let supabaseClient = null;
        document.addEventListener('DOMContentLoaded', function() {
            try {
                if (typeof supabase !== 'undefined' && supabase.createClient) {
                    supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    console.log("Supabase client initialized for Weight Loss Clinics Quiz.");
                } else {
                    console.error("Supabase client library (supabase.js) is not loaded for Weight Loss Clinics Quiz.");
                }
            } catch (e) {
                console.error("Error initializing Supabase client for Weight Loss Clinics Quiz:", e.message);
            }
        });

        const sourceParam = new URLSearchParams(window.location.search).get('source');
        const niche = 'Weight Loss Clinics';

        let currentQuestionIndex = 0;
        let userAnswers = [];
        let totalScore = 0;
        let quizStarted = false;

        const quizQuestions = [
            {
                question: "How consistently does your clinic attract new patients specifically seeking weight loss solutions?",
                answers: [
                    { text: "Inconsistently; lead flow for weight loss programs is unpredictable.", score: 1 },
                    { text: "Somewhat consistently, but we rely heavily on general marketing or word-of-mouth.", score: 2 },
                    { text: "Fairly consistently, but we\'d like to improve lead quality or reduce acquisition costs.", score: 3 },
                    { text: "Very consistently; we have a strong system for attracting qualified weight loss patients.", score: 4 }
                ]
            },
            {
                question: "How effective is your clinic at converting initial consultations or inquiries into enrolled weight loss program participants?",
                answers: [
                    { text: "Low conversion; many interested individuals don\'t end up signing up.", score: 1 },
                    { text: "Moderate; we convert some, but often face challenges with commitment or price sensitivity.", score: 2 },
                    { text: "Good; we have a decent success rate, but could refine our approach for higher-value programs.", score: 3 },
                    { text: "Excellent; our consultation process is highly effective at demonstrating value and securing enrollment.", score: 4 }
                ]
            },
            {
                question: "How would you describe your clinic\'s patient support and accountability systems throughout their weight loss journey?",
                answers: [
                    { text: "Minimal structured support beyond initial program setup.", score: 1 },
                    { text: "We offer some follow-up, but it\'s not always systematic or personalized.", score: 2 },
                    { text: "We have good support mechanisms (e.g., regular check-ins, resources), but could improve long-term engagement.", score: 3 },
                    { text: "Comprehensive and proactive; we provide robust support, accountability, and motivation to ensure patient success.", score: 4 }
                ]
            },
            {
                question: "How well does your clinic differentiate its weight loss programs from competitors (e.g., gyms, online programs, other clinics)?",
                answers: [
                    { text: "Not well; we don\'t have a clear unique selling proposition for our weight loss services.", score: 1 },
                    { text: "Somewhat; we highlight some unique aspects, but it may not be compelling enough.", score: 2 },
                    { text: "Good; we effectively communicate our unique approach and benefits to prospective patients.", score: 3 },
                    { text: "Excellent; our programs are clearly differentiated, making us a preferred choice for our target audience.", score: 4 }
                ]
            },
            {
                question: "What is your primary growth objective for your clinic\'s weight loss services in the next 1-3 years?",
                answers: [
                    { text: "To maintain current patient volume and service offerings.", score: 1 },
                    { text: "To moderately increase the number of weight loss patients and program revenue.", score: 2 },
                    { text: "To significantly expand our weight loss programs, possibly adding new modalities or staff.", score: 3 },
                    { text: "To become a leading, highly reputable weight loss center in our community or region.", score: 4 }
                ]
            },
            {
                question: "Every business has them: those 'invisible chains' of costly overhead or tedious manual processes that secretly stifle growth and sanity. What ONE such chain, if broken, would provide the most immediate and profound boost to your business\'s efficiency and your personal peace of mind? *",
                type: "textarea",
                id: "growth_stifler_response_quiz"
            }
        ];

        const quizArea = document.getElementById('quiz-area');
        const quizBenefitsIntro = document.getElementById('quiz-benefits-intro');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const quizQuestionDiv = document.getElementById('quiz-question');
        const quizAnswersDiv = document.getElementById('quiz-answers');
        const quizNavigationDiv = document.querySelector('.quiz-navigation');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const leadCaptureForm = document.getElementById('lead-capture-form');
        const quizResultDiv = document.getElementById('quiz-result');
        const progressBarContainer = document.getElementById('progress-bar-container');
        const progressBar = document.getElementById('progress-bar');

        function determineOutcome(score) {
            if (score <= 7) return "clients";
            if (score <= 14) return "practice";
            return "growth";
        }

        function startQuiz() {
            quizStarted = true;
            quizBenefitsIntro.style.display = 'none';
            startQuizBtn.style.display = 'none';
            quizQuestionDiv.style.display = 'block';
            quizAnswersDiv.style.display = 'block';
            quizNavigationDiv.style.display = 'none';
            nextQuestionBtn.style.display = 'none';
            progressBarContainer.style.display = 'block';
            displayQuestion();
        }

        function displayQuestion() {
            if (currentQuestionIndex < quizQuestions.length) {
                const questionData = quizQuestions[currentQuestionIndex];
                const h2 = quizQuestionDiv.querySelector('h2');
                h2.textContent = questionData.question;

                const oldInstruction = quizQuestionDiv.querySelector('p.instruction-text');
                if (oldInstruction) {
                    oldInstruction.remove();
                }

                const answersUl = quizAnswersDiv.querySelector('ul');
                answersUl.innerHTML = ''; 

                if (questionData.type === "textarea") {
                    const instructionP = document.createElement('p');
                    instructionP.textContent = "Please type your answer below:";
                    instructionP.className = 'instruction-text';
                    instructionP.style.fontSize = '0.9em';
                    instructionP.style.color = '#666';
                    instructionP.style.marginTop = '5px';
                    h2.after(instructionP);

                    const li = document.createElement('li');
                    const textarea = document.createElement('textarea');
                    textarea.id = questionData.id;
                    textarea.name = questionData.id;
                    textarea.rows = 4;
                    textarea.style.width = '100%';
                    textarea.style.padding = '10px';
                    textarea.style.borderColor = '#ccc';
                    textarea.style.borderRadius = '4px';
                    textarea.required = true;
                    li.appendChild(textarea);
                    answersUl.appendChild(li);

                    nextQuestionBtn.textContent = "Next";
                    nextQuestionBtn.onclick = handleTextareaAnswer; 
                    quizNavigationDiv.style.display = 'block';
                    nextQuestionBtn.style.display = 'inline-block';

                } else {
                    const instructionP = document.createElement('p');
                    instructionP.textContent = "Select your answer below:";
                    instructionP.className = 'instruction-text';
                    instructionP.style.fontSize = '0.9em';
                    instructionP.style.color = '#666';
                    instructionP.style.marginTop = '5px';
                    h2.after(instructionP);

                    questionData.answers.forEach((answer) => {
                        const li = document.createElement('li');
                        const button = document.createElement('button');
                        button.classList.add('answer-btn');
                        button.textContent = answer.text;
                        button.onclick = () => selectAnswer(answer.score, button);
                        li.appendChild(button);
                        answersUl.appendChild(li);
                    });
                    quizNavigationDiv.style.display = 'none';
                    nextQuestionBtn.style.display = 'none';
                }
                updateProgressBar();
            } else {
                showLeadCaptureForm();
            }
        }

        function handleTextareaAnswer() {
            const questionData = quizQuestions[currentQuestionIndex];
            const textarea = document.getElementById(questionData.id);
            if (textarea && textarea.value.trim() !== "") {
                userAnswers[currentQuestionIndex] = textarea.value.trim();
                nextQuestion();
            } else {
                alert("Please provide an answer to this question.");
            }
        }
        
        function selectAnswer(score, selectedButton) {
            const buttons = quizAnswersDiv.querySelectorAll('.answer-btn');
            buttons.forEach(btn => btn.classList.remove('selected'));
            selectedButton.classList.add('selected');
            userAnswers[currentQuestionIndex] = score;
            setTimeout(nextQuestion, 500);
        }

        function nextQuestion() {
            const currentQuestionData = quizQuestions[currentQuestionIndex];
            if (currentQuestionData.type !== "textarea" && userAnswers[currentQuestionIndex] === undefined) {
                alert("Please select an answer before proceeding.");
                return;
            }

            currentQuestionIndex++;
            if (currentQuestionIndex < quizQuestions.length) {
                displayQuestion();
            } else {
                showLeadCaptureForm();
            }
        }
        
        function updateProgressBar() {
            const progress = (currentQuestionIndex / quizQuestions.length) * 100;
            progressBar.style.width = progress + '%';
        }

        function showLeadCaptureForm() {
            quizQuestionDiv.style.display = 'none';
            quizAnswersDiv.style.display = 'none';
            quizNavigationDiv.style.display = 'none';
            progressBarContainer.style.display = 'none';
            leadCaptureForm.style.display = 'block';
            totalScore = userAnswers.reduce((acc, score) => acc + (score || 0), 0);
            console.log("Final Score: ", totalScore); 
        }

        async function handleLeadSubmit() {
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const businessName = document.getElementById('businessName').value.trim(); 
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            
            let growth_stifler_response = "";
            const growthStiflerQuestionIndex = quizQuestions.findIndex(q => q.type === "textarea");
            if (growthStiflerQuestionIndex !== -1 && userAnswers[growthStiflerQuestionIndex]) {
                growth_stifler_response = userAnswers[growthStiflerQuestionIndex];
            }

            if (!firstName || !lastName || !businessName || !email || !phone) {
                alert("Please fill in all required fields in the form.");
                return;
            }
            
            if (growthStiflerQuestionIndex !== -1 && !userAnswers[growthStiflerQuestionIndex]) {
                 alert("Please ensure all quiz questions, including the open-ended one, are answered.");
                 return;
            }

            leadCaptureForm.style.display = 'none';
            quizResultDiv.style.display = 'block';
            quizResultDiv.querySelector('h3').textContent = "Calculating Your Custom Clinic Blueprint...";
            quizResultDiv.querySelector('p').textContent = "Please wait while we prepare your personalized insights.";

            const detailedQuizAnswers = userAnswers.map((answerData, index) => {
                const questionData = quizQuestions[index];
                if (questionData.type === "textarea") {
                    return {
                        question: questionData.question,
                        answer: answerData, 
                        score: null 
                    };
                }
                const selectedAnswerObject = questionData.answers.find(ans => ans.score === answerData);
                return {
                    question: questionData.question,
                    answer: selectedAnswerObject ? selectedAnswerObject.text : "N/A - Score not found",
                    score: answerData
                };
            });

            const primaryOutcomeHint = determineOutcome(totalScore);

            const submissionData = {
                first_name: firstName,
                last_name: lastName,
                business_name: businessName,
                email: email,
                growth_stifler_response: growth_stifler_response,
                phone: phone,
                niche: niche,
                quiz_answers: detailedQuizAnswers,
                total_score: totalScore,
                primary_outcome_hint: primaryOutcomeHint,
                source: sourceParam || 'organic',
                submitted_at: new Date().toISOString(),
            };

            let dbErrorMessage = null;
            if (supabaseClient) {
                try {
                    const { data, error } = await supabaseClient
                        .from('tctc_quiz_submission')
                        .insert([submissionData])
                        .select();
                    if (error) {
                        console.error('Error inserting data into Supabase:', error);
                        dbErrorMessage = error.message || 'Unknown DB Error';
                    } else {
                        console.log('Data successfully inserted into Supabase:', data);
                        // INVOKE THE EDGE FUNCTION TO SEND TO SLACK
                        try {
                            console.log('Weight Loss Clinics Quiz: Attempting to invoke quiz-slack-notify Edge Function with data:', submissionData);
                            const { data: funcData, error: funcError } = await supabaseClient.functions.invoke('quiz-slack-notify', {
                                body: submissionData // Pass the same submissionData
                            });

                            if (funcError) {
                                console.error('Weight Loss Clinics Quiz: Error invoking quiz-slack-notify Edge Function:', funcError);
                            } else {
                                console.log('Weight Loss Clinics Quiz: quiz-slack-notify Edge Function invoked successfully:', funcData);
                            }
                        } catch (invokeCatchError) {
                            console.error('Weight Loss Clinics Quiz: Exception caught when trying to invoke Edge Function:', invokeCatchError);
                        }
                    }
                } catch (e) {
                    console.error('Exception during Supabase insert:', e);
                    dbErrorMessage = e.message || 'DB Insert Exception';
                }
            } else {
                 console.warn("Supabase client not available. Skipping database insert.");
                 dbErrorMessage = 'Database connection not available';
            }

            determineOutcomeAndRedirect(firstName, lastName, businessName, totalScore, supabaseClient, dbErrorMessage, sourceParam, dbErrorMessage);
        }

        async function determineOutcomeAndRedirect(firstName, lastName, businessName, totalScore, supabaseClient, dbError, sourceParam, supabaseInsertError) {
            const encodedFirstName = encodeURIComponent(firstName);
            const encodedLastName = encodeURIComponent(lastName);
            const encodedBusinessName = encodeURIComponent(businessName);
            const baseParams = `firstName=${encodedFirstName}&lastName=${encodedLastName}&businessName=${encodedBusinessName}&score=${totalScore}`;
            const sourceAndDbErrorParams = `${sourceParam ? `&source=${encodeURIComponent(sourceParam)}` : ''}&track_source=quiz${dbError ? `&dbError=${encodeURIComponent(supabaseInsertError?.message || 'Unknown error')}` : ''}`;
            
            // Determine the outcome bucket based on the score
            const outcome = determineOutcome(totalScore);
            const scoreBucket = outcome; // patients, practice, or growth
            
            // Determine which awareness variant to show based on score distribution
            let awarenessVariant;
            if (scoreBucket === "patients") {
                // Lower scores within this bucket get problem variant, higher get solution variant, etc.
                if (totalScore <= 5) {
                    awarenessVariant = "b-problem"; // Problem Aware
                } else if (totalScore <= 6) {
                    awarenessVariant = "a-solution"; // Solution Aware
                } else {
                    awarenessVariant = "c-most-aware"; // Most Aware
                }
            } 
            else if (scoreBucket === "practice") {
                if (totalScore <= 10) {
                    awarenessVariant = "b-problem"; // Problem Aware
                } else if (totalScore <= 12) {
                    awarenessVariant = "a-solution"; // Solution Aware
                } else {
                    awarenessVariant = "c-most-aware"; // Most Aware
                }
            } 
            else { // growth
                if (totalScore <= 16) {
                    awarenessVariant = "b-problem"; // Problem Aware
                } else if (totalScore <= 18) {
                    awarenessVariant = "a-solution"; // Solution Aware
                } else {
                    awarenessVariant = "c-most-aware"; // Most Aware
                }
            }
            
            // Construct the new URL with bucket and variant
            const url = `../quiz-applications/weight-loss-clinics/${scoreBucket}/weight-loss-patient-variant-${awarenessVariant}.html?${baseParams}&bucket=${scoreBucket}&variant=${awarenessVariant}${sourceAndDbErrorParams}`;
            
            // Track the redirection in Supabase before redirecting
            if (supabaseClient) {
                try {
                    const { data, error } = await supabaseClient
                        .from('tctc_quiz_redirections')
                        .insert([{
                            user_first_name: firstName,
                            user_last_name: lastName,
                            user_business_name: businessName,
                            quiz_score: totalScore,
                            outcome_bucket: scoreBucket,
                            awareness_variant: awarenessVariant,
                            redirect_url: url,
                            source: sourceParam || 'organic',
                            redirected_at: new Date().toISOString()
                        }]);
                    
                    if (error) {
                        console.error('Error tracking weight loss clinics redirection:', error);
                    } else {
                        console.log('Weight loss clinics redirection tracking successful:', data);
                    }
                } catch (e) {
                    console.error('Exception during weight loss clinics redirection tracking:', e);
                }
            }
            
            // Redirect regardless of tracking success
            console.log("Weight Loss Clinics: Redirecting to:", url);
            window.location.href = url;
        }

        window.startQuiz = startQuiz;
        window.nextQuestion = nextQuestion;
        window.handleLeadSubmit = handleLeadSubmit;

    </script>
    <script src="../script.js"></script>
</body>
</html> 